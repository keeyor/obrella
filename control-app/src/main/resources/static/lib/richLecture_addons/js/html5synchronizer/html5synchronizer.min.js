var info,actions,pp,crossDomain_option=!1,global_vid_duration=-1,timeline_width=0,slides_counter=0,time_now=0,timeline_progress_bar_update_flag=1,lock_flag=0,go_to_time_refresh=1,indicator_every_no_secs=900,provider_type="",video_url="",basepath="",number_of_total_slides=0,width_of_presentation_of_synced_slides=0;cuepointsx=[],cuepointsx_m=[],slide_at=[],seek_time=[],slide_order=[];var debug=0,production_mode=1,mode="edit",edit_marker_on=0,webRoot="",presentation_file="",slides_file="",num_of_slides=0,slides_loaded=0;function addToMarkerListSelection(e,t,i,o){var s;div_txt='<div class="marker_selections" id="marker_selection_'+e+'"></div>',null!==t?(title_on_load_tooltip=t,t=truncate(t,25,"..."),s='<div class="active_slide_title_div" id="active_slide_title_div_'+e+'" title="'+title_on_load_tooltip+'">'+t+"</div>"):(title_on_load_tooltip=t,t=truncate($(".active img").attr("title"),25,"..."),s='<div class="active_slide_title_div" id="active_slide_title_div_'+e+'" title="'+title_on_load_tooltip+'">'+t+"</div>");var n='<input type="text" id="active_slide_time_div_'+e+'" disabled value="'+secondsTimeSpanToHMS(e)+'" class="active_slide_time_div"></input>';button_for_edit='<button type="button" title="'+language.s1+'" id="edit_row_from_marker_list_'+e+'" class="edit_row_from_marker_list" onclick="actions.edit_slide_period('+e+',event)"></button>',button_for_goto='<button type="button" title="'+language.s2+'" id="goto_row_from_marker_list_'+e+'" class="goto_row_from_marker_list" onclick="actions.seek('+e+')"></button>',button_for_delete='<button type="button" title="'+language.s3+'" id="remove_row_from_marker_list_'+e+'" class="remove_row_from_marker_list" onclick="actions.remove_slide_period('+e+')"></button>',buttons_marker_div=e>=global_vid_duration?'<div class="buttons_marker_div">'+button_for_edit+'<button type="button" class="goto_row_from_marker_list_inactive"></button>'+button_for_delete+"</div>":'<div class="buttons_marker_div">'+button_for_edit+button_for_goto+button_for_delete+"</div>","after"==o?$(div_txt).html(s+n+buttons_marker_div+'<div style="clear:both"></div>').hide().insertAfter($(i)).show("slow"):"before"==o?$(div_txt).html(s+n+buttons_marker_div+'<div style="clear:both"></div>').hide().insertBefore($(i)).show("slow"):$(div_txt).html(s+n+buttons_marker_div+'<div style="clear:both"></div>').hide().appendTo($("#marker_list_content")).show("slow"),$(".edit_row_from_marker_list").hover(function(){$(this).css("opacity",1)},function(){$(this).css("opacity",.4)}),$(".goto_row_from_marker_list").hover(function(){$(this).css("opacity",1)},function(){$(this).css("opacity",.4)}),$(".remove_row_from_marker_list").hover(function(){$(this).css("opacity",1)},function(){$(this).css("opacity",.4)}),e>=global_vid_duration?($("#marker_selection_"+e).addClass("marker_selection_outside"),$("#marker_selection_"+e).mouseenter(function(){$(this).addClass("marker_selection_outside_highlight")}),$("#marker_selection_"+e).mouseleave(function(){$(".marker_selections").removeClass("marker_selection_outside_highlight")})):($("#marker_selection_"+e).mouseenter(function(){timeline_bar_mention_start=Math.round(e/global_vid_duration*timeline_width),cuepointsx.indexOf(1e3*e)==cuepointsx.length-1||cuepointsx.indexOf(1e3*e)<cuepointsx.length-1&&cuepointsx[cuepointsx.indexOf(1e3*e)+1]>=1e3*global_vid_duration?timeline_bar_mention_end=timeline_width:timeline_bar_mention_end=Math.round(parseInt(cuepointsx[cuepointsx.indexOf(1e3*e)+1]/1e3)/global_vid_duration*timeline_width),new_width=timeline_bar_mention_end-timeline_bar_mention_start,$(".marker_selections").removeClass("highlight_marker_row"),$(".marked_area").width("2px"),$("#timeline_bar_"+e).width(new_width+"px"),$(this).addClass("highlight_marker_row")}),$("#marker_selection_"+e).mouseleave(function(){$(".marker_selections").removeClass("highlight_marker_row"),$(".marked_area").width("2px")}))}function removeMarkerListSelection(e){$("#marker_selection_"+e).fadeOut("slow",function(){$(this).remove()})}function addSlideOnTimelineBar(e){if(e>global_vid_duration)return!1;timeline_bar_start=Math.round(e/global_vid_duration*timeline_width),$('<div class="marked_area" id="timeline_bar_'+e+'" title="'+secondsTimeSpanToHMS(e)+'"></div>').animate({left:timeline_bar_start+"px",width:"2px"}).appendTo($(".timeline"))}function removeSlideOnTimelineBar(e){if(e>global_vid_duration)return!1;$("#timeline_bar_"+e).hide("slow",function(){$(this).remove()})}function read_slides_XML(){var e=0;$.ajax({type:"GET",url:slides_file,dataType:"xml",crossDomain:crossDomain_option,cache:!1,success:function(t){basepath=$(t).find("basepath").text(),$(t).find("slide").each(function(){var t=$(this).find("url").text(),o=(t=basepath+t).lastIndexOf("/");url_for_scroll_bar=t.substr(0,o+1)+"small/"+t.substr(o+1);var s=$(this).find("time").text(),n=$(this).find("title").text();n.length||(n=language.s4),$('<div class="scroll-content-item"></div>').html('<img src="'+url_for_scroll_bar+'" title="'+(e+1)+" "+n+'" ><div class="scroll-content-img-number">'+(e+1)+"</div>").appendTo($(".scroll-content")),slide_order[e]=t,times=s.split(",");for(let o=0;o<times.length;o++)if(-1!==(s=convert_hh_mm_ss_format(times[o]))){for(cuepointsx.push(1e3*s),seek_time[t]>=0?seek_time[t]>1e3*s&&(seek_time[t]=1e3*s):seek_time[t]=1e3*s,slide_at[1e3*s]=t,min_diff=36e6,min_diff_index=-1,time_to_inverstigate=1e3*s,i=0;i<cuepointsx.length;i++)cut_diff=Math.abs(time_to_inverstigate-cuepointsx[i]),cut_diff>0&&cut_diff<min_diff&&(min_diff=cut_diff,min_diff_index=i,time_to_inverstigate>cuepointsx[i]?min_diff_order="after":min_diff_order="before");min_diff_index>=0?addToMarkerListSelection(s,e+1+" "+n,"#marker_selection_"+parseInt(cuepointsx[min_diff_index]/1e3,10),min_diff_order):addToMarkerListSelection(s,e+1+" "+n),addSlideOnTimelineBar(s),cuepointsx=cuepointsx.sort(function(e,t){return e-t}),$(".scroll-content-img-number:eq("+e+")").addClass("slide_synced")}e++,num_of_slides++});for(let e=0;e<cuepointsx.length;e++){let t,i=parseInt((cuepointsx[e]/1e3).toString(),10);t=e<cuepointsx.length-1?parseInt((cuepointsx[e+1]/1e3).toString(),10):global_vid_duration;let o=cuepointsx[e],s=slide_at[o];cuepointsx_m.addCue(new window.VTTCue(i,t,s))}if(debug&&(console.log("SLIDE CUE"),void 0!==cuepointsx_m.cues))for(let e=0;e<cuepointsx_m.cues.length;e++){let t=cuepointsx_m.cues[e];console.log("cue:"+e+"   start:"+t.startTime+"("+secondsTimeSpanToHMS(t.startTime)+")     end:"+t.endTime+"("+secondsTimeSpanToHMS(t.endTime)+" text: "+t.text+" )")}var o;width_of_presentation_of_synced_slides=$(".presentation_of_work_done").width()+parseInt($(".presentation_of_work_done").css("paddingLeft"),10)+parseInt($(".presentation_of_work_done").css("paddingRight"),10),number_of_total_slides=e,$(".number_of_total_slides").html(number_of_total_slides),refresh_presentation_of_synced_slides(),o=$(".scroll-content-item"),total_img_width=o.width(),total_img_width+=parseInt(o.css("paddingLeft"),10)+parseInt(o.css("paddingRight"),10),total_img_width+=parseInt(o.css("marginLeft"),10)+parseInt(o.css("marginRight"),10),scroll_area_img_width=total_img_width*num_of_slides,scroll_area_img_width+=4,$(".scroll-content").css("width",scroll_area_img_width+"px"),debug&&(info.innerHTML="Scroll are for thumbenails has width "+scroll_area_img_width+"px"),$(".scroll-content-item img").click(function(){var e=$(this).attr("src");if(e=e.replace("small/",""),0==edit_marker_on)if("edit"==mode){var t=$("#active_slide img");t.css("opacity",.3),t.attr("src",e).fadeTo("normal",1),slide_to_be_loaded=$(".scroll-content-item img").index(this),set_active_img($(this))}else if($.inArray(e,slide_at)>=0){slide_to_be_loaded=$(".scroll-content-item img").index(this),set_active_img($(this));var i=$(this).attr("src");i=i.replace("small/","");var o=seek_time[i]/1e3;getVideo().currentTime=o}}).filter(":first").click(),$(".scroll-content-item img").dblclick(function(){var e=$(this).attr("src");if(e=e.replace("small/",""),0==edit_marker_on&&"edit"==mode){var t=$("#active_slide img");t.css("opacity",.3),t.attr("src",e).fadeTo("normal",1),slide_to_be_loaded=$(".scroll-content-item img").index(this),set_active_img($(this)),actions.synchronize()}}),slides_loaded=1}})}function refresh_presentation_of_synced_slides(){setTimeout(function(){num_of_syncs=$(".slide_synced").size(),$(".number_of_synced_slides").html(num_of_syncs);var e=parseInt(num_of_syncs/number_of_total_slides*width_of_presentation_of_synced_slides,10);$(".presentation_of_work_done_background").width(e),num_of_syncs_outside_vid=$(".marker_selection_outside").size(),num_of_syncs_outside_vid>0?$(".number_of_synced_slides_outside_vid").html('(<img src="'+webRoot+'/resources/richLecture_addons/css/images_synchronizer/AttentionIcon.png" class="outside_slides_attention_mark"></img>'+num_of_syncs_outside_vid+")"):$(".number_of_synced_slides_outside_vid").html("")},1e3)}function truncate(e,t,i){return e.length>t&&(e=(e=e.substring(0,t+1)).substring(0,Math.min(e.length,e.lastIndexOf(" "))),e+=i),e}function reformat_date(e){var t=e.split("-");return t[2]+"-"+t[1]+"-"+t[0]}function read_parameters_XML(){$(".scroll-region").hide(),$.ajax({type:"GET",url:presentation_file,dataType:"xml",crossDomain:crossDomain_option,cache:!1,success:function(e){logo=$(e).find("logo").text(),title=$(e).find("title:first").text(),$(document).attr("title",title),title=truncate(title,55,"..."),date_txt=reformat_date($(e).find("date").text()),provider_type=$(e).find("provider").text(),video_url=$(e).find("resource[format=MP4]").text(),global_vid_duration=convert_hh_mm_ss_format($(e).find("duration").text()),$('<div class="header-item"></div>').html(title+" | "+date_txt).prependTo($(".header")),$('<div class="header-logo-item-separator"></div>').prependTo($(".header")),$('<div class="header-logo"><img src="'+logo+'"></img></div>').prependTo($(".header"))},complete:function(){init_HTML5(),timeline_progress_bar(),read_slides_XML();var e=setInterval(function(){1==slides_loaded&&(clearInterval(e),$(".scroll-region").show(),$("#dvLoading").hide())},200)}})}function scroll(){$(".scroll-fwd").on("click",function(){var e,t=parseInt($(".scroll-pane").width()/total_img_width,10);t*=total_img_width,e=$(".scroll-pane").scrollLeft()+t,$(".scroll-pane").stop(),$(".scroll-pane").animate({scrollLeft:e})}),$(".scroll-bwd").on("click",function(){var e,t=parseInt($(".scroll-pane").width()/total_img_width,10);t*=total_img_width,e=$(".scroll-pane").scrollLeft()-t,$(".scroll-pane").stop(),$(".scroll-pane").animate({scrollLeft:e})})}function set_active_img(e){var t=slide_to_be_loaded*total_img_width-total_img_width;$(".scroll-content-item").removeClass("active"),$(e).parent().addClass("active"),setTimeout(function(){$(".scroll-pane").animate({scrollLeft:t})},500)}function define_actions(){actions={mute:function(){getVideo().muted?($(".player_mute").css("background","url("+webRoot+"/resources/richLecture_addons/css/images_synchronizer/unmute-large.png) no-repeat"),getVideo().muted=!1,getVideo().volume=.5):($(".player_mute").css("background","url("+webRoot+"/resources/richLecture_addons/css/images_synchronizer/mute-large.png) no-repeat"),getVideo().muted=!0)},voldown:function(){curr_vol=getVideo().volume,curr_vol-.1<=0?getVideo().volume=0:getVideo().volume=curr_vol-.1},volup:function(){curr_vol=getVideo().volume,curr_vol+.1>1?getVideo().volume=1:getVideo().volume=curr_vol+.1},play:function(){toggle_play()},stop:function(){getVideo().paused=!0,$(".player_play").css("background","url("+webRoot+"/resources/richLecture_addons/css/images_synchronizer/play-large.png) no-repeat")},seek:function(e){if("edit"===mode){var t=slide_at[1e3*e];slide_to_be_loaded=slide_order.indexOf(t),$(".scroll-content-item img:eq("+slide_to_be_loaded+")").click()}getVideo().currentTime=e-5>0?e-5:e},go_to_time:function(){var e=$(".go_to_field").val(),t=convert_hh_mm_ss_format(e),i=e.split(":");8==e.length&&t<global_vid_duration&&3==i.length&&2==i[0].length&&2==i[1].length&&2==i[2].length&&$.isNumeric(i[0])&&$.isNumeric(i[1])&&$.isNumeric(i[2])&&i[0]<60&&i[1]<60&&i[2]<60&&(getVideo().currentTime=t)},synchronize:function(e){var t=0;if(null==e&&(e=Math.round(getVideo().currentTime),t=1),time_to_inverstigate=1e3*e,-1!=cuepointsx.indexOf(1e3*e))return alert(language.s5),!1;var o=$(".active .scroll-content-img-number").html()-1,s=slide_order[o];let n;cuepointsx.push(1e3*e),seek_time[s]>=0&&null!=seek_time[s]?seek_time[s]>1e3*e&&(seek_time[s]=1e3*e):seek_time[s]=1e3*e,slide_at[1e3*e]=s,cuepointsx_m.addCue(new window.VTTCue(e,global_vid_duration,s));let _,r=!1;if(void 0!==cuepointsx_m.cues)for(let t=0;t<cuepointsx_m.cues.length;t++)if((_=cuepointsx_m.cues[t]).startTime===e){r=!0,n=t;break}if(r){if(n<cuepointsx_m.cues.length-1){let e=cuepointsx_m.cues[n+1];e.text!==_.text?_.endTime=e.startTime:_.endTime=e.endTime}if(n>0){let e=cuepointsx_m.cues[n-1];e.text!==_.text?e.endTime=_.startTime:(e.endTime=_.endTime,cuepointsx_m.removeCue(_))}}if(debug&&(console.log("SLIDE CUE AFTER SYNC OF:"+n),void 0!==cuepointsx_m.cues))for(let e=0;e<cuepointsx_m.cues.length;e++){let t=cuepointsx_m.cues[e];console.log("cue:"+e+"   start:"+t.startTime+"("+secondsTimeSpanToHMS(t.startTime)+")     end:"+t.endTime+"("+secondsTimeSpanToHMS(t.endTime)+" text: "+t.text+" )")}if(cuepointsx=cuepointsx.sort(function(e,t){return e-t}),updated_index_time_to_investigate=cuepointsx.indexOf(time_to_inverstigate),cuepointsx.length>=updated_index_time_to_investigate+1&&slide_at[cuepointsx[updated_index_time_to_investigate]]==slide_at[cuepointsx[updated_index_time_to_investigate+1]]&&actions.remove_slide_period(parseInt(cuepointsx[updated_index_time_to_investigate+1]/1e3)),updated_index_time_to_investigate-1>=0&&slide_at[cuepointsx[updated_index_time_to_investigate]]==slide_at[cuepointsx[updated_index_time_to_investigate-1]])return cuepointsx.splice(updated_index_time_to_investigate,1),slide_at[time_to_inverstigate]=null,!1;for(min_diff=36e6,min_diff_index=-1,i=0;i<cuepointsx.length;i++)cut_diff=Math.abs(time_to_inverstigate-cuepointsx[i]),cut_diff>0&&cut_diff<min_diff&&(min_diff=cut_diff,min_diff_index=i,time_to_inverstigate>cuepointsx[i]?min_diff_order="after":min_diff_order="before");min_diff_index>=0?addToMarkerListSelection(e,null,"#marker_selection_"+parseInt(cuepointsx[min_diff_index]/1e3,10),min_diff_order):addToMarkerListSelection(e,null),$("#marker_list_content").stop(),$("#marker_selection_"+e).offset().top>$("#marker_list_content").offset().top+$("#marker_list_content").scrollTop()&&0==t?$("#marker_list_content").animate({scrollTop:$("#marker_selection_"+e).offset().top-$("#marker_list_content").offset().top+$("#marker_list_content").scrollTop()-23}):$("#marker_list_content").animate({scrollTop:$("#marker_selection_"+e).offset().top-$("#marker_list_content").offset().top+$("#marker_list_content").scrollTop()}),addSlideOnTimelineBar(e),$(".scroll-content-img-number:eq("+o+")").addClass("slide_synced"),refresh_presentation_of_synced_slides(),$(".save_btn").prop("disabled",!1),$(".save_btn").css("opacity","1")},synchronize_and_go:function(){var e=actions.synchronize(),t=$(".active .scroll-content-img-number").html();slide_order.length>t&&0!=e&&$(".scroll-content-img-number:eq("+t+")").parent().find("img").click()},go_to_unsynced_slide:function(){$(".scroll-content-img-number:not(.slide_synced):first").parent().find("img").click()},edit_slide_period:function(e,t){if("edit"==mode){var i=slide_at[1e3*e];slide_to_be_loaded=slide_order.indexOf(i),$(".scroll-content-item img:eq("+slide_to_be_loaded+")").click()}if(t.shiftKey){getVideo().pause=!0,$("#slide_selected_for_shifting").html($(".scroll-content-item img:eq("+slide_to_be_loaded+")").parent().find("div").html());var o=Math.round(getVideo().currentTime),s=o-e;return $("#shift_time_diff").val(s),$("#shift_time_start").val(secondsTimeSpanToHMS(o)),$("#shift_time_diff").on("change input keyup propertychange",function(){if($.isNumeric($(this).val())&&parseInt(e+parseInt($(this).val(),10),10)>=0&&parseInt(e+parseInt($(this).val(),10),10)<global_vid_duration){if($(this).removeClass("shift_time_validation"),$("#shift_time_start").removeClass("shift_time_validation"),$("#shift_time_start").val(secondsTimeSpanToHMS(parseInt(e+parseInt($(this).val(),10),10))),$("#shift_attention").hide(),$("#shift_time_diff").val()<0)for(var t=0;t<cuepointsx.length&&!(cuepointsx[t]>=1e3*parseInt(e,10));t++)cuepointsx[t]>=1e3*parseInt(e+parseInt($(this).val(),10),10)&&cuepointsx[t]<1e3*parseInt(e,10)&&$("#shift_attention").show()}else $(this).addClass("shift_time_validation"),$("#shift_time_start").addClass("shift_time_validation"),$("#shift_time_start").val("~"),$("#shift_attention").hide()}),$("#shift_time_start").on("change input keyup propertychange",function(){var t=$(this).val(),i=$(this).val().split(":");if(8==t.length&&3==i.length&&convert_hh_mm_ss_format(t)>=0&&convert_hh_mm_ss_format(t)<global_vid_duration&&2==i[0].length&&2==i[1].length&&2==i[2].length&&$.isNumeric(i[0])&&$.isNumeric(i[1])&&$.isNumeric(i[2])&&i[0]<60&&i[1]<60&&i[2]<60){if($(this).removeClass("shift_time_validation"),$("#shift_time_diff").removeClass("shift_time_validation"),$("#shift_time_diff").val(parseInt(convert_hh_mm_ss_format($(this).val())-e,10)),$("#shift_attention").hide(),$("#shift_time_diff").val()<0)for(var o=0;o<cuepointsx.length&&!(cuepointsx[o]>=1e3*parseInt(e,10));o++)cuepointsx[o]>=1e3*parseInt(e+parseInt($("#shift_time_diff").val(),10),10)&&cuepointsx[o]<1e3*parseInt(e,10)&&$("#shift_attention").show()}else $(this).addClass("shift_time_validation"),$("#shift_time_diff").addClass("shift_time_validation"),$("#shift_time_diff").val("~"),$("#shift_attention").hide()}),$("#shift_slides").dialog({autoOpen:!1,height:200,width:700,resizable:!1,modal:!0,resizable:!1,draggable:!0,position:{my:"center",at:"top+200",of:window},buttons:[{text:language.s8,click:function(){var t=$("#shift_time_diff").val(),i=$("#shift_time_start").val();if("~"==t||"~"==i)return alert(language.s10),!1;if(0==t)return $(this).dialog("close"),!1;if(t<0)for(var o=0;o<cuepointsx.length&&!(cuepointsx[o]>=1e3*parseInt(e,10));o++)cuepointsx[o]>=1e3*parseInt(parseInt(e,10)+parseInt(t,10),10)&&cuepointsx[o]<1e3*parseInt(e,10)&&(actions.remove_slide_period(cuepointsx[o]/1e3),o--);var s=[],n=[];s.push(e),n.push(slide_order.indexOf(slide_at[1e3*e])),$("#marker_selection_"+e).nextAll(".marker_selections").each(function(){var e=parseInt($(this).attr("id").replace("marker_selection_",""),10);s.push(e),n.push(slide_order.indexOf(slide_at[1e3*e]))}),actions.remove_slide_period(e),$("#marker_selection_"+e).nextAll(".marker_selections").each(function(){var e=parseInt($(this).attr("id").replace("marker_selection_",""),10);actions.remove_slide_period(e)});for(o=s.length-1;o>=0;o--)$(".scroll-content-item").removeClass("active"),$(".scroll-content-item img:eq("+n[o]+")").parent().addClass("active"),actions.synchronize(parseInt(s[o],10)+parseInt(t,10));$(".scroll-content-item").removeClass("active"),$(".scroll-content-item img:eq("+n[0]+")").parent().addClass("active"),$(this).dialog("close")}},{text:language.s9,click:function(){$(this).dialog("close")}}],close:function(){$(this).dialog("close")}}),$("#shift_slides").dialog("open"),!1}edit_marker_on=1;var n=$(".save_btn").prop("disabled"),_=$(".save_btn").css("opacity");$(".save_btn").prop("disabled",!0),$(".save_btn").css("opacity","0.5"),$("button").prop("disabled",!0),$("button").css("opacity","0.2"),$("#active_slide_time_div_"+e).prop("disabled",!1),$("#active_slide_time_div_"+e).addClass("borderEditTime"),$("#active_slide_time_div_"+e).focus();var r=$("#active_slide_time_div_"+e).val(),a=convert_hh_mm_ss_format(r);$("#active_slide_time_div_"+e).bind("keyup",function(t){if(13==t.keyCode){var i=$("#active_slide_time_div_"+e).val(),o=convert_hh_mm_ss_format(i),s=i.split(":");if(a!=o)if(8==i.length&&o<global_vid_duration&&3==s.length)if(2==s[0].length&&2==s[1].length&&2==s[2].length&&$.isNumeric(s[0])&&$.isNumeric(s[1])&&$.isNumeric(s[2]))if(s[0]<60&&s[1]<60&&s[2]<60){if(!(cuepointsx.indexOf(1e3*o)>=0))return actions.remove_slide_period(e),actions.synchronize(o),refresh_presentation_of_synced_slides(),edit_marker_on=0,$("#active_slide_time_div_"+e).removeClass("borderEditTime"),$("button").prop("disabled",!1),$("button").css("opacity","0.4"),$(".go_to_unsynced_slide").prop("disabled",!1),$(".go_to_unsynced_slide").css("opacity","1"),$(".sync_button").prop("disabled",!1),$(".sync_button").css("opacity","1"),$(".sync_and_go_button").prop("disabled",!1),$(".sync_and_go_button").css("opacity","1"),$(".edit_mode_btn").css("opacity","1"),$(".preview_mode_btn").css("opacity","1"),$(".save_btn").prop("disabled",!1),$(".save_btn").css("opacity","1"),$("#active_slide_time_div_"+e).unbind("keyup"),!1;alert(language.s5),$("#active_slide_time_div_"+e).val(r)}else $("#active_slide_time_div_"+e).val(r);else $("#active_slide_time_div_"+e).val(r);else $("#active_slide_time_div_"+e).val(r);else $("#active_slide_time_div_"+e).val(r);$("#active_slide_time_div_"+e).prop("disabled",!0),$("#active_slide_time_div_"+e).removeClass("borderEditTime"),edit_marker_on=0,$("button").prop("disabled",!1),$("button").css("opacity","0.4"),$(".go_to_unsynced_slide").prop("disabled",!1),$(".go_to_unsynced_slide").css("opacity","1"),$(".sync_button").prop("disabled",!1),$(".sync_button").css("opacity","1"),$(".sync_and_go_button").prop("disabled",!1),$(".sync_and_go_button").css("opacity","1"),$(".edit_mode_btn").css("opacity","1"),$(".preview_mode_btn").css("opacity","1"),$(".save_btn").prop("disabled",n),$(".save_btn").css("opacity",_),$("#active_slide_time_div_"+e).unbind("keyup")}else 27==t.keyCode&&($("#active_slide_time_div_"+e).val(r),$("#active_slide_time_div_"+e).prop("disabled",!0),$("#active_slide_time_div_"+e).removeClass("borderEditTime"),edit_marker_on=0,$("button").prop("disabled",!1),$("button").css("opacity","0.4"),$(".go_to_unsynced_slide").prop("disabled",!1),$(".go_to_unsynced_slide").css("opacity","1"),$(".sync_button").prop("disabled",!1),$(".sync_button").css("opacity","1"),$(".sync_and_go_button").prop("disabled",!1),$(".sync_and_go_button").css("opacity","1"),$(".edit_mode_btn").css("opacity","1"),$(".preview_mode_btn").css("opacity","1"),$(".save_btn").prop("disabled",n),$(".save_btn").css("opacity",_),$("#active_slide_time_div_"+e).unbind("keyup"))})},remove_slide_period:function(e){let t=e;if(e*=1e3,cuepointsx_second_index=cuepointsx.indexOf(e),-1==cuepointsx_second_index)return!1;cuepointsx.splice(cuepointsx_second_index,1);var o=slide_at[e],s=slide_order.indexOf(o);let n;slide_at[e]=null;let _=!1;if(void 0!==cuepointsx_m.cues)for(let e=0;e<cuepointsx_m.cues.length;e++){if(cuepointsx_m.cues[e].startTime===t){_=!0,n=e;break}}if(_){let e,t;debug&&console.log("CUE INDEX TO REMOVE:"+n),n>0&&(e=cuepointsx_m.cues[n-1]),n<cuepointsx_m.cues.length-1&&(t=cuepointsx_m.cues[n+1]),void 0!==e&&void 0!==t&&(e.endTime=t.startTime-1),void 0!==e&&void 0===t&&(e.endTime=global_vid_duration),debug&&console.log("removing Sync Cue:"+n+"  from curepointsx_m"),cuepointsx_m.removeCue(cuepointsx_m.cues[n])}if(debug){console.log("SLIDE CUE AFTER REMOVAL OF:"+n);for(let e=0;e<cuepointsx_m.cues.length;e++){let t=cuepointsx_m.cues[e];console.log("cue:"+e+"   start:"+t.startTime+"("+secondsTimeSpanToHMS(t.startTime)+")     end:"+t.endTime+"("+secondsTimeSpanToHMS(t.endTime)+" text: "+t.text+" )")}}if(seek_time[o]==e)if(cuepointsx_second_index==cuepointsx.length)seek_time[o]=null;else for(i=cuepointsx_second_index;i<cuepointsx.length;i++){if(o==slide_at[cuepointsx[i]]){seek_time[o]=cuepointsx[i];break}seek_time[o]=null}removeMarkerListSelection(parseInt(e/1e3,10)),removeSlideOnTimelineBar(parseInt(e/1e3,10)),null==seek_time[o]&&$(".scroll-content-img-number:eq("+s+")").removeClass("slide_synced"),cuepointsx_second_index>0&&cuepointsx_second_index<cuepointsx.length&&slide_at[cuepointsx[cuepointsx_second_index]]==slide_at[cuepointsx[cuepointsx_second_index-1]]&&actions.remove_slide_period(parseInt(cuepointsx[cuepointsx_second_index]/1e3,10)),refresh_presentation_of_synced_slides(),$(".save_btn").prop("disabled",!1),$(".save_btn").css("opacity","1")},activate_preview_mode:function(){actions.seek(Math.round(getVideo().currentTime)),getVideo().paused=!1,$(".preview_mode_btn").prop("disabled",!0),$(".preview_mode_btn").addClass("preview_mode_on"),$(".edit_mode_btn").prop("disabled",!1),$(".edit_mode_btn").removeClass("edit_mode_on"),$(".go_to_unsynced_slide").prop("disabled",!0),$(".go_to_unsynced_slide").css("opacity","0.5"),$(".sync_button").prop("disabled",!0),$(".sync_button").css("opacity","0.2"),$(".sync_and_go_button").prop("disabled",!0),$(".sync_and_go_button").css("opacity","0.2"),$(".edit_row_from_marker_list").prop("disabled",!0),$(".edit_row_from_marker_list").css("opacity","0.2"),$(".remove_row_from_marker_list").prop("disabled",!0),$(".remove_row_from_marker_list").css("opacity","0.2"),mode="preview"},activate_edit_mode:function(){$(".preview_mode_btn").prop("disabled",!1),$(".preview_mode_btn").removeClass("preview_mode_on"),$(".edit_mode_btn").prop("disabled",!0),$(".edit_mode_btn").addClass("edit_mode_on"),$(".go_to_unsynced_slide").prop("disabled",!1),$(".go_to_unsynced_slide").css("opacity","1"),$(".sync_button").prop("disabled",!1),$(".sync_button").css("opacity","1"),$(".sync_and_go_button").prop("disabled",!1),$(".sync_and_go_button").css("opacity","1"),$(".edit_row_from_marker_list").prop("disabled",!1),$(".edit_row_from_marker_list").css("opacity","0.4"),$(".remove_row_from_marker_list").prop("disabled",!1),$(".remove_row_from_marker_list").css("opacity","0.4"),mode="edit"},fast_seek:function(e){time_now=Math.round(getVideo().currentTime),getVideo().currentTime="fwd"==e?time_now+5>=global_vid_duration?global_vid_duration:time_now+5:time_now-5<=0?0:time_now-5},send_json:function(){var e=[],t=[];for(i=0;i<slide_order.length;i++){for(flag_slide_no_found=0,j=0;j<cuepointsx.length;j++)cuepointsx_time_save=cuepointsx[j],slide_order[i]==slide_at[cuepointsx_time_save]&&(e.push(slide_order[i]),t.push(secondsTimeSpanToHMS(parseInt(cuepointsx_time_save/1e3,10))),flag_slide_no_found=1);0==flag_slide_no_found&&(e.push(slide_order[i]),t.push(-1))}for(i=0;i<e.length;i++)e[i]=e[i].replace(basepath,"");for(i=0;i<e.length-1;i++)e[i]==e[i+1]&&(t[i]=t[i]+","+t[i+1],e.splice(i+1,1),t.splice(i+1,1),i--);urls_json=JSON.stringify({urls:e}),times_json=JSON.stringify({times:t}),initial_duration_json=JSON.stringify({initial_duration:secondsTimeSpanToHMS(global_vid_duration)}),total_json=urls_json.concat(times_json),total_json=total_json.replace("}{",","),total_json=total_json.concat(initial_duration_json),total_json=total_json.replace("}{",","),0===production_mode?($(".save_btn").prop("disabled",!0),$(".save_btn").css("opacity","0.5")):($(".save_btn").prop("disabled",!0),$(".save_btn").css("opacity","0.5"),$.ajax({url:slides_file,type:"POST",contentType:"application/json; charset=utf-8",dataType:"html",crossDomain:crossDomain_option,data:total_json,cache:!1,processData:!1,success:function(e){"1"!==e?("4"===e?alert(language.s14):"5"===e?alert(language.s15):"2"===e?alert(language.s11):"3"===e?alert(language.s12):"23"===e?alert(language.s13):alert(language.s6),$(".save_btn").prop("disabled",!1),$(".save_btn").css("opacity","1")):($(".save_btn").prop("disabled",!0),$(".save_btn").css("opacity","0.5"))},error:function(){alert(language.s6),$(".save_btn").prop("disabled",!1),$(".save_btn").css("opacity","1")}}))},zoom_active_slide:function(){$(".enlarged_active_slide").html('<div class="b-close">Close</div>'),active_slide_src=$("#active_slide img").attr("src"),$(".enlarged_active_slide").bPopup({content:"image",contentContainer:".enlarged_active_slide",loadUrl:active_slide_src,closeClass:".b-close"})}}}function convert_hh_mm_ss_format(e){var t=e.split(":"),i=0,o=0,s=0;return 1==t.length&&(s=parseFloat(t[0])),2==t.length&&(o=parseFloat(t[0]),s=parseFloat(t[1])),3==t.length&&(i=parseFloat(t[0]),o=parseFloat(t[1]),s=parseFloat(t[2])),Math.round(s+60*o+3600*i)}function secondsTimeSpanToHMS(e){var t=Math.floor(e/3600);e-=3600*t;var i=Math.floor(e/60);return(t<10?"0"+t:t)+":"+(i<10?"0"+i:i)+":"+((e-=60*i)<10?"0"+e:e)}function secondsTimeSpanToHM(e){var t=Math.floor(e/3600);e-=3600*t;var i=Math.floor(e/60);return t+"h"+i+"m"+((e-=60*i)>0?e+"s":"")}function timeline_progress_bar(){var e=parseInt(global_vid_duration/indicator_every_no_secs),t=parseInt(global_vid_duration/60);for(i=0;i<=t;i++)left_pos=Math.round(60*i/global_vid_duration*timeline_width),i%5?$('<div class="minute_period"></div>').css({left:+left_pos+"px"}).appendTo($(".timeline")):$('<div class="five_minute_period"></div>').css({left:+left_pos+"px"}).appendTo($(".timeline"));for(i=0;i<=e;i++)left_pos=Math.round(i*indicator_every_no_secs/global_vid_duration*timeline_width),$('<div class="quarter_period"></div>').html('<div class="quarter_period_time">'+secondsTimeSpanToHMS(i*indicator_every_no_secs)+"</div>").css({left:+left_pos+"px"}).appendTo($(".timeline")),i==e&&timeline_width-left_pos<60&&$(".quarter_period_time").html("");$('<div class="quarter_period"></div>').html('<div class="quarter_period_time">'+secondsTimeSpanToHMS(global_vid_duration)+"</div>").css({left:+(timeline_width-1)+"px"}).appendTo($(".timeline")),setInterval(function(){1===timeline_progress_bar_update_flag&&(lock_flag=1,time_now=getVideo().currentTime,position_on_timeline_bar=Math.round(time_now/global_vid_duration*timeline_width),$(".timeline_progress_position_time").html(secondsTimeSpanToHMS(Math.round(time_now))),$(".timeline_progress_position").animate({left:position_on_timeline_bar+"px"},{duration:100,queue:!1}),1===go_to_time_refresh&&$(".go_to_field").val(secondsTimeSpanToHMS(Math.round(time_now))),setTimeout(function(){return!1},100),lock_flag=0)},1e3)}function go_to_field_func(){$(".go_to_field").click(function(){go_to_time_refresh=0}),$(".go_to_field").focus(function(){go_to_time_refresh=0}),$(".go_to_field").select(function(){go_to_time_refresh=0}),$(".go_to_field").focusout(function(){go_to_time_refresh=1}),$(".go_to_field").bind("keyup",function(e){13==e.keyCode?(actions.go_to_time(),go_to_time_refresh=1):go_to_time_refresh=27==e.keyCode?1:0})}function getRootWebSitePath(){var e=document.location.toString(),t=e.indexOf("/",e.indexOf("://")+3),i=e.substring(0,t)+"/",o=e.indexOf("/",e.indexOf(i)+i.length);return e.substring(0,o)}function toggle_play(){!1===document._video.paused?(getVideo().pause(),$(".player_play").css("background","url("+webRoot+"/resources/richLecture_addons/css/images_editor/play-large.png) no-repeat"),debug&&(info.innerHTML="video paused")):(getVideo().play(),$(".player_play").css("background","url("+webRoot+"/resources/richLecture_addons/css/images_editor/pause-large.png) no-repeat"),debug&&(info.innerHTML="video resumed"))}function onSeek(){if("preview"===mode){curr_time=1e3*Math.round(getVideo().currentTime),curr_time+=1,total_num_of_slides=cuepointsx.length;for(var e=0;e<total_num_of_slides;e++){if(curr_time>=cuepointsx[total_num_of_slides-1]){slide_to_be_loaded=slide_order.indexOf(slide_at[cuepointsx[total_num_of_slides-1]]);break}if(cuepointsx[e]<=curr_time&&curr_time<cuepointsx[e+1]){slide_to_be_loaded=slide_order.indexOf(slide_at[cuepointsx[e]]);break}}debug&&(info.innerHTML="onSeek:  current time at "+Math.round(getVideo().currentTime)+" slide "+slide_to_be_loaded+" "+slide_order[slide_to_be_loaded]);var t=slide_order[slide_to_be_loaded],i=$("#active_slide img");i.css("opacity",.3),i.attr("src",t).fadeTo("normal",1),set_active_img($(".scroll-content-item img:eq("+slide_to_be_loaded+")"))}}$(document).ready(function(){webRoot=getRootWebSitePath(),$(".save_btn").css("background","url("+webRoot+"/resources/richLecture_addons/css/images_synchronizer/saveButton-"+language.selectedLang+".png) no-repeat"),0==production_mode?(presentation_file="presentation.xml",slides_file="slideSync.xml"):"http://localhost/rlecture"==webRoot||"http://195.134.115.253:8080/rlecture"==webRoot||"http://node-241.med.uoa.gr:8080/rlecture"==webRoot?(presentation_file="http://195.134.115.253:8080/dmms/services/presentation/",slides_file="http://195.134.115.253:8080/dmms/services/slides/"):(presentation_file=webRoot+"/services/presentation/",slides_file=webRoot+"/services/slides/"),timeline_width=1210,info=document.getElementById("info"),define_actions(),scroll(),1==production_mode&&(vid_lecture_id=window.location.search.replace("?rid=",""),-1!=vid_lecture_id.indexOf("&")&&(window.location.href=window.location.search.replace(window.location.href.substring(window.location.href.indexOf("&")),"")),presentation_file+=vid_lecture_id,slides_file+=vid_lecture_id),read_parameters_XML(),$("#marker_list_content").mouseleave(function(){$(".marker_selections").removeClass("highlight_marker_row"),$(".marked_area").width("2px")}),go_to_field_func(),$(window).bind("beforeunload",function(){if(0==$(".save_btn").prop("disabled"))return language.s7}),$(".scroll-pane").mousewheel(function(e,t){this.scrollLeft-=t*total_img_width,e.preventDefault()})});