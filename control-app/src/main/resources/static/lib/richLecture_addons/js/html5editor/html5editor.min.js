let crossDomain_option=!1,cuepoints_c=[],cuepoints_m=[];begin_cut_times=[],end_cut_times=[],cut_end_in_sec=[];let info,actions,pp,provider_type="",video_url="",production_mode=1,presentation_file="",cuts_file="",clips_list_file="",realediting_file="",vid_lecture_id="",webRoot="",debug=0,global_vid_duration=-1,timeline_width=0,cuts_counter=0,time_now=0,timeline_progress_bar_update_flag=1,lock_flag=0,go_to_time_refresh=1,indicator_every_no_secs=900;function reformat_date(e){let t=e.split("-");return t[2]+"-"+t[1]+"-"+t[0]}function read_parameters_XML(){$.ajax({type:"GET",url:presentation_file,dataType:"xml",crossDomain:crossDomain_option,cache:!1,success:function(e){let t=$(e).find("logo").text(),i=$(e).find("title:first").text();$(document).attr("title",i),i=truncate(i,55,"...");let n=reformat_date($(e).find("date").text());provider_type=$(e).find("provider").text(),video_url=$(e).find("resource[format=MP4]").text(),global_vid_duration=convert_hh_mm_ss_format($(e).find("duration").text());let o=$(".header");$('<div class="header-item"></div>').html(i+" | "+n).prependTo(o),$('<div class="header-logo-item-separator"></div>').prependTo(o),$('<div class="header-logo"><img alt="" src="'+t+'" /></div>').prependTo(o)},complete:function(){init_HTML5(),getVideo().load(),timeline_progress_bar_HTML5(),read_cuts_XML()}})}function addToTrimsClipsSelection(e,t,i,n,o){let c=cuts_counter;null!=o&&(cuts_counter=o);let s,_='<div class="trims_clips_presentation" id="trims_clips_'+e+"_"+t+'"></div>',u='<button type="button" title="'+language.e1+'" id="edit_row_from_trims_clips_presentation_'+e+"_"+t+'" class="edit_row_from_trims_clips_presentation" onclick="actions.edit_cut('+e+","+t+')"></button>',r='<button type="button" title="'+language.e2+'" id="play_row_from_trims_clips_presentation_'+e+"_"+t+'" class="play_row_from_trims_clips_presentation" onclick="actions.play_cut('+e+","+t+')"></button>',l='<button type="button" title="'+language.e3+'" id="check_row_from_trims_clips_presentation_'+e+"_"+t+'" class="check_row_from_trims_clips_presentation" onclick="actions.seek('+e+')"></button>';s=0===e?'<button type="button" title="'+language.e4+'" id="remove_row_from_trims_clips_presentation_'+e+"_"+t+'" class="remove_row_from_trims_clips_presentation" onclick="actions.remove_start_video()"></button>':t===global_vid_duration?'<button type="button" title="'+language.e4+'" id="remove_row_from_trims_clips_presentation_'+e+"_"+t+'"    class="remove_row_from_trims_clips_presentation" onclick="actions.remove_end_video()"></button>':"999999999"!==t?'<button type="button" title="'+language.e4+'" id="remove_row_from_trims_clips_presentation_'+e+"_"+t+'" class="remove_row_from_trims_clips_presentation" onclick="actions.remove_cut_period('+cuts_counter+')"></button>':'<button type="button" title="'+language.e4+'" class="remove_row_from_trims_clips_presentation" onclick="actions.remove_incomplete_cut_period('+cuts_counter+')"></button>',0===e?$(_).html(secondsTimeSpanToHMS(e)+" - "+secondsTimeSpanToHMS(t)+u+r+l+s).hide().prependTo($(".userTrimInputs")).fadeIn("slow"):t===global_vid_duration?$(_).html(secondsTimeSpanToHMS(e)+" - "+secondsTimeSpanToHMS(t)+u+r+l+s).hide().appendTo($(".userTrimInputs")).fadeIn("slow"):"999999999"!==t?"after"===n?$(_).html(secondsTimeSpanToHMS(e)+" - "+secondsTimeSpanToHMS(t)+u+r+l+s).hide().insertAfter($(i)).show("slow"):"before"===n?$(_).html(secondsTimeSpanToHMS(e)+" - "+secondsTimeSpanToHMS(t)+u+r+l+s).hide().insertBefore($(i)).show("slow"):$(_).html(secondsTimeSpanToHMS(e)+" - "+secondsTimeSpanToHMS(t)+u+r+l+s).hide().appendTo($(".userClipInputs")).show("slow"):$(_).html(language.e5+secondsTimeSpanToHMS(e)+" - ... "+s).hide().prependTo($(".userClipInputs")).show("slow"),cuts_counter=c;let a=$("#trims_clips_"+e+"_"+t);a.mouseenter(function(){$("#timeline_bar_"+e+"_"+t).addClass("showRegionOnTimeline"),$(this).addClass("trims_clips_presentation_highlight")}),a.mouseleave(function(){$("#timeline_bar_"+e+"_"+t).removeClass("showRegionOnTimeline"),$(this).removeClass("trims_clips_presentation_highlight")})}function removeTrimClipSelection(e,t){$("#trims_clips_"+e+"_"+t).fadeOut("slow",function(){$(this).remove()})}function truncate(e,t,i){return e.length>t&&(e=(e=e.substring(0,t+1)).substring(0,Math.min(e.length,e.lastIndexOf(" "))),e+=i),e}function define_actions(){actions={mute:function(){toggle_mute()},voldown:function(){volume_down()},volup:function(){volume_up()},play:function(){toggle_play()},seek:function(e){getVideo().currentTime=e-5>0?e-5:e},fast_seek:function(e){time_now=Math.round(getVideo().currentTime),getVideo().currentTime="fwd"===e?time_now+5>=global_vid_duration?global_vid_duration:time_now+5:time_now-5<=0?0:time_now-5},edit_cut:function(e,t){let i=$("#edit_selected_period"),n=secondsTimeSpanToHMS(e),o=secondsTimeSpanToHMS(t);i.dialog({autoOpen:!1,resizable:!1,modal:!0,draggable:!1,position:{my:"center",at:"top+200",of:window},buttons:[{text:language.e21,click:function(){let i=!1,n=$("#edit_start_time").val(),o=$("#edit_end_time").val(),c=n.split(":"),s=o.split(":");if(e===convert_hh_mm_ss_format(n)&&t===convert_hh_mm_ss_format(o))return $(this).dialog("close"),!1;8===n.length&&convert_hh_mm_ss_format(n)<global_vid_duration&&3===c.length&&8===o.length&&convert_hh_mm_ss_format(o)<=global_vid_duration&&3===s.length&&2===c[0].length&&2===c[1].length&&2===c[2].length&&$.isNumeric(c[0])&&$.isNumeric(c[1])&&$.isNumeric(c[2])&&2===s[0].length&&2===s[1].length&&2===s[2].length&&$.isNumeric(s[0])&&$.isNumeric(s[1])&&$.isNumeric(s[2])&&c[0]<60&&c[1]<60&&c[2]<60&&s[0]<60&&s[1]<60&&s[2]<60&&(i=!0),i?(i=0===e?actions.set_start_video(convert_hh_mm_ss_format(o)):t===global_vid_duration?actions.set_end_video(convert_hh_mm_ss_format(n)):actions.edit_cut_times(begin_cut_times.indexOf(e),e,t,convert_hh_mm_ss_format(n),convert_hh_mm_ss_format(o)))&&($(this).dialog("close"),getVideo().currentTime=convert_hh_mm_ss_format(o)):alert(language.e6)}},{text:language.e22,click:function(){$(this).dialog("close")}}],close:function(){$(this).dialog("close")}}),$("#edit_start_time").val(n),$("#edit_end_time").val(o),0===e?$("#edit_start_time").prop("disabled",!0):$("#edit_start_time").prop("disabled",!1),t===global_vid_duration?$("#edit_end_time").prop("disabled",!0):$("#edit_end_time").prop("disabled",!1),i.dialog("open")},edit_cut_times:function(e,t,i,n,o){if(0===n)return alert(language.e7),!1;if(n===global_vid_duration)return alert(language.e8),!1;if(o===global_vid_duration)return alert(language.e9),!1;if(o<=n)return alert(language.e10),!1;let c=[];for(let t=0;t<cuepoints_c.length;t++)if(t!==cuepoints_c.indexOf(1e3*begin_cut_times[e])){if(cuepoints_c[t]/1e3<=n&&cut_end_in_sec[cuepoints_c[t]]>=n)return alert(language.e11),!1;if(cuepoints_c[t]/1e3<=o&&cut_end_in_sec[cuepoints_c[t]]>=o)return alert(language.e12),!1;cuepoints_c[t]/1e3>=n&&cut_end_in_sec[cuepoints_c[t]]<=o&&(c.push(t),console.log("found one to remove, with index"+t))}begin_cut_times[e]=n,cuepoints_c[cuepoints_c.indexOf(1e3*t)]=1e3*n,end_cut_times[e]=o;for(let e=0;e<cuepoints_m.cues.length;e++){let t=cuepoints_m.cues[e];console.log("cue:"+e+"   start:"+t.startTime+"  end:"+t.endTime)}for(let e=0;e<cuepoints_m.cues.length;e++){let c=cuepoints_m.cues[e];c.startTime===t&&c.endTime===i&&(console.log(" found target cue to Alter"),c.startTime=n,c.endTime=o)}for(let e=0;e<cuepoints_m.cues.length;e++){let t=cuepoints_m.cues[e];console.log("cue:"+e+"   start:"+t.startTime+"  end:"+t.endTime)}cut_end_in_sec[1e3*t]=null,cut_end_in_sec[1e3*begin_cut_times[e]]=o,removeCutOnTimelineBar(t,i),removeTrimClipSelection(t,i);let s,_=0;for(let e=0;e<c.length;e++)0!==cuepoints_c[c[e-_]]&&(s=begin_cut_times.indexOf(cuepoints_c[c[e-_]]/1e3),removeCutOnTimelineBar(cuepoints_c[c[e-_]]/1e3,cut_end_in_sec[cuepoints_c[c[e-_]]]),removeTrimClipSelection(cuepoints_c[c[e-_]]/1e3,cut_end_in_sec[cuepoints_c[c[e-_]]]),cut_end_in_sec[cuepoints_c[c[e-_]]]=null,begin_cut_times[s]=null,end_cut_times[s]=null,cuepoints_c.splice(c[e-_],1),_++);addCutOnTimelineBar(begin_cut_times[e],end_cut_times[e]);let u,r,l=36e4,a=-1;for(let t=0;t<begin_cut_times.length;t++)(u=Math.abs(begin_cut_times[e]-begin_cut_times[t]))>0&&u<l&&null!=begin_cut_times[t]&&(l=u,a=t,r=begin_cut_times[e]>begin_cut_times[t]?"after":"before");a>=0?addToTrimsClipsSelection(begin_cut_times[e],end_cut_times[e],"#trims_clips_"+begin_cut_times[a]+"_"+end_cut_times[a],r,e):addToTrimsClipsSelection(begin_cut_times[e],end_cut_times[e],null,null,e);let d=$(".send_json_button");return d.prop("disabled",!1),d.css("opacity","1"),!0},play_cut:function(e,t){let i=$(".play_cut_section");getVideo().paused=!0,i.html('<div class="b-close">Close</div>');$("#active_slide img").attr("src");i.bPopup({content:"iframe",iframeAttr:'width="616px" height="390px"',contentContainer:".play_cut_section",loadUrl:webRoot+"/admin/editor_play_cut?id="+video_url+"&duration="+global_vid_duration+"&start="+e+"&end="+t+"&provider="+provider_type,closeClass:".b-close"})},go_to_time:function(){let e=$(".go_to_field").val(),t=convert_hh_mm_ss_format(e),i=e.split(":");8===e.length&&t<global_vid_duration&&3===i.length&&2===i[0].length&&2===i[1].length&&2===i[2].length&&$.isNumeric(i[0])&&$.isNumeric(i[1])&&$.isNumeric(i[2])&&i[0]<60&&i[1]<60&&i[2]<60&&(getVideo().currentTime=e)},set_start_video:function(e){null==e&&(e=Math.round(getVideo().currentTime));const t=cuepoints_c.indexOf(0);if(0===e)return alert(language.e13),!1;if(e===global_vid_duration)return alert(language.e14),!1;for(let i=0;i<cuepoints_c.length;i++)if(i===t){if(cut_end_in_sec[0]===e)return!1}else if(cuepoints_c[i]/1e3<=e)return alert(language.e15),!1;let i=$(".set_start_button"),n=$(".send_json_button");i.prop("disabled",!0),i.css("opacity","0.4"),n.prop("disabled",!1),n.css("opacity","1");return-1!==t?(removeCutOnTimelineBar(cuepoints_c[t],cut_end_in_sec[0]),removeTrimClipSelection(cuepoints_c[t],cut_end_in_sec[0]),cut_end_in_sec[0]=e,cuepoints_c[t]=0):(cut_end_in_sec[0]=e,cuepoints_c.push(0),debug&&(info.innerHTML="Trim Start:: Start:0--\x3eEnd:"+e),cuepoints_m.addCue(new window.VTTCue(0,e,"trim start"))),addCutOnTimelineBar(0,e),addToTrimsClipsSelection(0,e),i.prop("disabled",!1),i.css("opacity","1"),!0},remove_start_video:function(){let e=cuepoints_c.indexOf(0);if(-1!==e){removeCutOnTimelineBar(cuepoints_c[e],cut_end_in_sec[1e3*cuepoints_c[e]]),removeTrimClipSelection(cuepoints_c[e],cut_end_in_sec[1e3*cuepoints_c[e]]),cut_end_in_sec[1e3*cuepoints_c[e]]=null,cuepoints_c.splice(e,1);for(let e=0;e<cuepoints_m.cues.length;e++){if(0===cuepoints_m.cues[e].startTime){m_index=e;break}}-1!==m_index&&(console.log("removing start trim with index:"+m_index+"  from curepoints_m"),cuepoints_m.removeCue(cuepoints_m.cues[m_index]));let t=$(".send_json_button");t.prop("disabled",!1),t.css("opacity","1")}},set_end_video:function(e){null==e&&(e=Math.round(getVideo().currentTime));const t=global_vid_duration,i=cut_end_in_sec.indexOf(t);if(e===global_vid_duration)return alert(language.e16),!1;if(0===e)return alert(language.e17),!1;if(i/1e3===e)return!1;for(let t=0;t<cuepoints_c.length;t++)if(t!==cuepoints_c.indexOf(i)){if(cuepoints_c[t]/1e3>=e)return alert(language.e18),!1;if(cuepoints_c[t]/1e3<=e&&cut_end_in_sec[cuepoints_c[t]]>=e)return alert(language.e19),!1}let n=$(".set_end_button"),o=$(".send_json_button");n.prop("disabled",!0),n.css("opacity","0.4"),o.prop("disabled",!1),o.css("opacity","1");let c=e;if(-1!==i){const e=Math.round(cuepoints_c.indexOf(i));removeCutOnTimelineBar(cuepoints_c[e]/1e3,cut_end_in_sec[i]),removeTrimClipSelection(cuepoints_c[e]/1e3,cut_end_in_sec[i]),cut_end_in_sec[i]=null,cuepoints_c.splice(e,1)}return cut_end_in_sec[1e3*c]=t,cuepoints_c.push(1e3*c),debug&&(info.innerHTML="Trim End:: Start:"+c+">End:"+global_vid_duration),cuepoints_m.addCue(new window.VTTCue(c,global_vid_duration,"trim end")),addCutOnTimelineBar(c,t),addToTrimsClipsSelection(c,t),n.prop("disabled",!1),n.css("opacity","1"),!0},remove_end_video:function(){let e=cut_end_in_sec.indexOf(global_vid_duration);if(-1!==e){let t=Math.round(cuepoints_c.indexOf(e));removeCutOnTimelineBar(cuepoints_c[t]/1e3,cut_end_in_sec[e]),removeTrimClipSelection(cuepoints_c[t]/1e3,cut_end_in_sec[e]),cut_end_in_sec[e]=null,cuepoints_c.splice(t,1);for(let e=0;e<cuepoints_m.cues.length;e++){if(cuepoints_m.cues[e].endTime===global_vid_duration){m_index=e;break}}-1!==m_index&&(console.log("removing end trim with index:"+m_index+"  from curepoints_m"),cuepoints_m.removeCue(cuepoints_m.cues[m_index]));let i=$(".send_json_button");i.prop("disabled",!1),i.css("opacity","1")}},begin_cut:function(){let e=Math.round(getVideo().currentTime);if(debug&&(info.innerHTML="Cut period "+cuts_counter+"begin: "+e),0===e)return alert(language.e20),!1;if(e===global_vid_duration)return alert(language.e8),!1;for(let t=0;t<cuepoints_c.length;t++)if(cuepoints_c[t]/1e3<=e&&cut_end_in_sec[cuepoints_c[t]]>=e)return alert(language.e11),!1;begin_cut_times[cuts_counter]=e,cuepoints_c.push(1e3*begin_cut_times[cuts_counter]),addToTrimsClipsSelection(begin_cut_times[cuts_counter],"999999999"),markStartOfCutOnTimeline(begin_cut_times[cuts_counter]);let t=$(".begin_cut_button");t.prop("disabled",!0),t.css("opacity","0.4");let i=$(".end_cut_button");i.prop("disabled",!1),i.css("opacity","1");let n=$(".set_start_button");n.prop("disabled",!0),n.css("opacity","0.4");let o=$(".set_end_button");o.prop("disabled",!0),o.css("opacity","0.4");let c=$(".send_json_button");c.prop("disabled",!0),c.css("opacity","0.5")},end_cut:function(){let e=Math.round(getVideo().currentTime);if(debug&&(info.innerHTML="Cut period "+cuts_counter+"end: "+e),e===global_vid_duration)return alert(language.e23),!1;if(e<=begin_cut_times[cuts_counter])return alert(language.e10),!1;let t=[];for(let i=0;i<cuepoints_c.length;i++)if(i!==cuepoints_c.indexOf(1e3*begin_cut_times[cuts_counter])){if(cuepoints_c[i]/1e3<=e&&cut_end_in_sec[cuepoints_c[i]]>=e)return alert(language.e12),!1;cuepoints_c[i]/1e3>=begin_cut_times[cuts_counter]&&cut_end_in_sec[cuepoints_c[i]]<=e&&t.push(i)}let i=0;for(let e=0;e<t.length;e++){if(0===cuepoints_c[t[e-i]])continue;let n=begin_cut_times.indexOf(cuepoints_c[t[e-i]]/1e3);removeCutOnTimelineBar(cuepoints_c[t[e-i]]/1e3,cut_end_in_sec[cuepoints_c[t[e-i]]]),removeTrimClipSelection(cuepoints_c[t[e-i]]/1e3,cut_end_in_sec[cuepoints_c[t[e-i]]]),cut_end_in_sec[cuepoints_c[t[e-i]]]=null,begin_cut_times[n]=null,end_cut_times[n]=null,cuepoints_c.splice(t[e-i],1),i++}end_cut_times[cuts_counter]=e,cut_end_in_sec[1e3*begin_cut_times[cuts_counter]]=end_cut_times[cuts_counter],removeMarkStartOfCutOnTimeline(begin_cut_times[cuts_counter]),addCutOnTimelineBar(begin_cut_times[cuts_counter],end_cut_times[cuts_counter]),removeTrimClipSelection(begin_cut_times[cuts_counter],"999999999");let n,o=36e4,c=-1;for(let e=0;e<begin_cut_times.length;e++){let t=Math.abs(begin_cut_times[cuts_counter]-begin_cut_times[e]);t>0&&t<o&&null!=begin_cut_times[e]&&(o=t,c=e,n=begin_cut_times[cuts_counter]>begin_cut_times[e]?"after":"before")}debug&&(info.innerHTML="(ADD CUT) Start:"+begin_cut_times[cuts_counter]+"-> End:"+end_cut_times[cuts_counter]),cuepoints_m.addCue(new window.VTTCue(begin_cut_times[cuts_counter],end_cut_times[cuts_counter],"new cut:"+cuts_counter)),c>=0?addToTrimsClipsSelection(begin_cut_times[cuts_counter],end_cut_times[cuts_counter],"#trims_clips_"+begin_cut_times[c]+"_"+end_cut_times[c],n):addToTrimsClipsSelection(begin_cut_times[cuts_counter],end_cut_times[cuts_counter]);let s=$(".begin_cut_button");s.prop("disabled",!1),s.css("opacity","1");let _=$(".end_cut_button");_.prop("disabled",!0),_.css("opacity","0.4");let u=$(".set_start_button");u.prop("disabled",!1),u.css("opacity","1");let r=$(".set_end_button");r.prop("disabled",!1),r.css("opacity","1");let l=$(".send_json_button");l.prop("disabled",!1),l.css("opacity","1"),cuts_counter++},remove_cut_period:function(e){const t=cuepoints_c.indexOf(1e3*begin_cut_times[e]);if(-1!==t&&0!==cuepoints_c[t]){removeCutOnTimelineBar(cuepoints_c[t]/1e3,cut_end_in_sec[cuepoints_c[t]]),removeTrimClipSelection(cuepoints_c[t]/1e3,cut_end_in_sec[cuepoints_c[t]]),cut_end_in_sec[cuepoints_c[t]]=null,cuepoints_c.splice(t,1),console.log("remove period:"+e+" with start time:"+begin_cut_times[e]),console.log("cue BEFORE");for(let e=0;e<cuepoints_m.cues.length;e++){let t=cuepoints_m.cues[e];console.log(e+"   start:"+t.startTime+"  end:"+t.endTime)}let i=begin_cut_times[e],n=-1;for(let e=0;e<cuepoints_m.cues.length;e++){if(cuepoints_m.cues[e].startTime===i){n=e;break}}-1!==n&&(console.log("removing index:"+n+"  from curepoints_m"),cuepoints_m.removeCue(cuepoints_m.cues[n])),console.log("cue AFTER");for(let e=0;e<cuepoints_m.cues.length;e++){let t=cuepoints_m.cues[e];console.log(e+"   start:"+t.startTime+"  end:"+t.endTime)}begin_cut_times[e]=null,end_cut_times[e]=null;let o=$(".send_json_button");o.prop("disabled",!1),o.css("opacity","1")}},remove_incomplete_cut_period:function(e){const t=cuepoints_c.indexOf(1e3*begin_cut_times[e]);if(-1!==t){let i=$(".begin_cut_button");i.prop("disabled",!1),i.css("opacity","1");let n=$(".end_cut_button");n.prop("disabled",!0),n.css("opacity","0.4");let o=$(".set_start_button");o.prop("disabled",!1),o.css("opacity","1");let c=$(".set_end_button");c.prop("disabled",!1),c.css("opacity","1"),removeMarkStartOfCutOnTimeline(cuepoints_c[t]/1e3),removeTrimClipSelection(cuepoints_c[t]/1e3,"999999999"),cuepoints_c.splice(t,1),begin_cut_times[e]=null}},send_json:function(){let e=$(".send_json_button");e.prop("disabled",!0),e.css("opacity","0.5");let t=[],i=[],n=[],o=[];for(let e=0;e<cuepoints_c.length;e++)0===cuepoints_c[e]?(t.push(secondsTimeSpanToHMS(cuepoints_c[e]/1e3)),i.push(secondsTimeSpanToHMS(cut_end_in_sec[cuepoints_c[e]]))):cut_end_in_sec[cuepoints_c[e]]===global_vid_duration?(t.push(secondsTimeSpanToHMS(cuepoints_c[e]/1e3)),i.push(secondsTimeSpanToHMS(cut_end_in_sec[cuepoints_c[e]]))):(n.push(secondsTimeSpanToHMS(cuepoints_c[e]/1e3)),o.push(secondsTimeSpanToHMS(cut_end_in_sec[cuepoints_c[e]])));let c=JSON.stringify({trim_begin:t}),s=JSON.stringify({trim_end:i}),_=JSON.stringify({clip_begin:n}),u=JSON.stringify({clip_end:o}),r=c.concat(s),l=_.concat(u),a=r.concat(l),d=[];d.push(recalculate_real_duration()),a=a.concat(JSON.stringify({real_duration:d}));let p=[];p.push(secondsTimeSpanToHMS(global_vid_duration)),a=a.concat(JSON.stringify({initial_duration:p})),0===production_mode?info.innerHTML="JSON: "+a:$.ajax({url:cuts_file,type:"POST",contentType:"application/json; charset=utf-8",dataType:"html",crossDomain:crossDomain_option,data:a,cache:!1,processData:!1,success:function(t){"1"!==t?("4"===t?alert(language.e29):"5"===t?alert(language.e30):"2"===t?alert(language.e28):alert(language.e24),e.prop("disabled",!1),e.css("opacity","1")):(e.prop("disabled",!0),e.css("opacity","0.5"))},error:function(){alert(language.e24),e.prop("disabled",!1),e.css("opacity","1")}})},realedit:function(){let e=$(".send_json_button"),t=$(".realediting_btn"),i=$("#realediting_modal");!1===e.prop("disabled")||void 0===e.prop("disabled")?alert(language.e31):0===cuepoints_c.length?alert(language.e32):(t.prop("disabled",!0),t.css("opacity","0.4"),i.dialog({autoOpen:!1,modal:!0,resizable:!1,draggable:!1,closeOnEscape:!1,width:500,position:{my:"center",at:"top+200",of:window},beforeClose:function(e,i){t.prop("disabled",!1),t.css("opacity","1")},buttons:[{text:language.e33,click:function(){$.ajax({url:realediting_file,type:"POST",contentType:"application/json; charset=utf-8",dataType:"html",crossDomain:crossDomain_option,cache:!1,processData:!1,success:function(e){2===e?(i.dialog("close"),alert(language.e36)):1!==e?(i.dialog("close"),alert(language.e34)):(i.dialog("close"),window.location.href=webRoot+"/admin/cmanager/areg?rid="+vid_lecture_id)},error:function(){i.dialog("close"),alert(language.e35)}})}},{text:language.e22,click:function(){$(this).dialog("close")}}]}),i.dialog("open"))}}}function recalculate_real_duration(){let e=global_vid_duration;for(let t=0;t<cuepoints_c.length;t++)e-=cut_end_in_sec[cuepoints_c[t]]-parseInt((cuepoints_c[t]/1e3).toString(),10);return e<0&&(e=0),secondsTimeSpanToHMS(e)}function refresh_clips_duration(){$.ajax({type:"GET",url:clips_list_file,crossDomain:crossDomain_option,cache:!1,dataType:"xml",success:function(e){if(-1!==$(e).find("Cliplist").text()){let t="";$(e).find("clip").each(function(){let e=-1,i=-1;-1!==$(this).find("clip_starttime").text()&&(e=convert_hh_mm_ss_format($(this).find("clip_starttime").text())),-1!==$(this).find("clip_endtime").text()&&(i=convert_hh_mm_ss_format($(this).find("clip_endtime").text()));let n=$(this).find("id").text().replace("c_","").replace(".xml","");t=t.concat(calculate_clip_duration(e,i,n))}),$.ajax({url:clips_list_file,type:"POST",contentType:"application/json; charset=utf-8",dataType:"html",crossDomain:crossDomain_option,data:t,cache:!1,processData:!1,success:function(e){1!==e&&alert(language.e25)},error:function(){alert(language.e25)}})}}})}function calculate_clip_duration(e,t,i){let n;if(-1===t||-1===e)return n=[i,(-1).toString(),e.toString(),t.toString()],JSON.stringify({clip:n});let o=t-e;for(let i=0;i<cuepoints_c.length;i++){let n=(cuepoints_c[i]/1e3).toString();parseInt(n,10)<=e&&cut_end_in_sec[cuepoints_c[i]]<=e||parseInt(n,10)>=t||(parseInt(n,10)>=e&&cut_end_in_sec[cuepoints_c[i]]<=t?o-=cut_end_in_sec[cuepoints_c[i]]-parseInt(n,10):parseInt(n,10)<=e&&cut_end_in_sec[cuepoints_c[i]]>=t?o-=t-e:parseInt(n,10)<=e&&cut_end_in_sec[cuepoints_c[i]]>e&&cut_end_in_sec[cuepoints_c[i]]<=t?o-=cut_end_in_sec[cuepoints_c[i]]-e:parseInt(n,10)>e&&cut_end_in_sec[cuepoints_c[i]]>=t&&(o-=t-parseInt(n,10)))}return o<0&&(o=0),n=[i,secondsTimeSpanToHMS(o),secondsTimeSpanToHMS(e),secondsTimeSpanToHMS(t)],JSON.stringify({clip:n})}function read_cuts_XML(){$.ajax({type:"GET",url:cuts_file,crossDomain:crossDomain_option,cache:!1,dataType:"xml",success:function(e){const t=$(e).find("clips"),i=$(e).find("trims");i.find("start").each(function(){let e=$(this).find("begin").text(),t=$(this).find("end").text();e=convert_hh_mm_ss_format(e),t=convert_hh_mm_ss_format(t),cut_end_in_sec[1e3*e]=t,cuepoints_c.push(1e3*e),cuepoints_m.addCue(new window.VTTCue(e,t,"start")),addCutOnTimelineBar(e,t),addToTrimsClipsSelection(e,t)}),i.find("finish").each(function(){let e=$(this).find("begin").text(),t=$(this).find("end").text();e=convert_hh_mm_ss_format(e),t=convert_hh_mm_ss_format(t),cut_end_in_sec[1e3*e]=t,cuepoints_c.push(1e3*e),cuepoints_m.addCue(new window.VTTCue(e,t,"finish")),addCutOnTimelineBar(e,t),addToTrimsClipsSelection(e,t)}),t.find("cut").each(function(){let e=$(this).find("begin").text(),t=$(this).find("end").text();e=convert_hh_mm_ss_format(e),t=convert_hh_mm_ss_format(t),cut_end_in_sec[1e3*e]=t,cuepoints_c.push(1e3*e),cuepoints_m.addCue(new window.VTTCue(e,t,"cut no."+cuts_counter)),begin_cut_times[cuts_counter]=e,end_cut_times[cuts_counter]=t,addCutOnTimelineBar(begin_cut_times[cuts_counter],end_cut_times[cuts_counter]);let i,n=36e4,o=-1;for(let e=0;e<begin_cut_times.length;e++){let t=Math.abs(begin_cut_times[cuts_counter]-begin_cut_times[e]);t>0&&t<n&&(n=t,o=e,i=begin_cut_times[cuts_counter]>begin_cut_times[e]?"after":"before")}o>=0?addToTrimsClipsSelection(begin_cut_times[cuts_counter],end_cut_times[cuts_counter],"#trims_clips_"+begin_cut_times[o]+"_"+end_cut_times[o],i):addToTrimsClipsSelection(begin_cut_times[cuts_counter],end_cut_times[cuts_counter]),cuts_counter++})}})}function go_to_field_func(){let e=$(".go_to_field");e.click(function(){go_to_time_refresh=0}),e.focus(function(){go_to_time_refresh=0}),e.select(function(){go_to_time_refresh=0}),e.focusout(function(){go_to_time_refresh=1}),e.bind("keyup",function(e){13===e.keyCode?(actions.go_to_time(),go_to_time_refresh=1):go_to_time_refresh=27===e.keyCode?1:0})}function addCutOnTimelineBar(e,t){let i=Math.round(e/global_vid_duration*timeline_width),n=Math.round((t-e)/global_vid_duration*timeline_width);e-5>0?$('<div class="marked_area" id="timeline_bar_'+e+"_"+t+'" title="'+secondsTimeSpanToHMS(e)+" - "+secondsTimeSpanToHMS(t)+'"></div>').animate({left:i+"px",width:n+"px"}).appendTo($(".timeline")).click(function(){$f().seek(e-5)}).tooltip({position:"top center",effect:"slide"}):$('<div class="marked_area" id="timeline_bar_'+e+"_"+t+'" title="'+secondsTimeSpanToHMS(e)+" - "+secondsTimeSpanToHMS(t)+'"></div>').animate({left:i+"px",width:n+"px"}).appendTo($(".timeline")).click(function(){$f().seek(e)}).tooltip({position:"top center",effect:"slide"});let o=$("#timeline_bar_"+e+"_"+t);o.mouseenter(function(){$(this).addClass("showRegionOnTimeline")}),o.mouseleave(function(){$(this).removeClass("showRegionOnTimeline")})}function markStartOfCutOnTimeline(e){let t=Math.round(e/global_vid_duration*timeline_width);$('<div class="marked_area_position_cut" id="timeline_bar_'+e+'"></div>').html('<div class="timeline_start_cut_position">'+language.e26+"</div>").animate({left:t+"px"}).appendTo($(".timeline"))}function removeMarkStartOfCutOnTimeline(e){$("#timeline_bar_"+e).hide("slow",function(){$(this).remove()})}function removeCutOnTimelineBar(e,t){$("#timeline_bar_"+e+"_"+t).hide("slow",function(){$(this).remove()})}function convert_hh_mm_ss_format(e){let t;const i=e.split("."),n=(t=1===i.length?e:i[0]).split(":");let o=0,c=0,s=0;return 1===n.length&&(s=parseFloat(n[0])),2===n.length&&(c=parseFloat(n[0]),s=parseFloat(n[1])),3===n.length&&(o=parseFloat(n[0]),c=parseFloat(n[1]),s=parseFloat(n[2])),Math.round(s+60*c+3600*o)}function secondsTimeSpanToHMS(e){let t=Math.floor(e/3600);e-=3600*t;let i=Math.floor(e/60);return(t<10?"0"+t:t)+":"+(i<10?"0"+i:i)+":"+((e-=60*i)<10?"0"+e:e)}function getRootWebSitePath(){const e=document.location.toString(),t=e.indexOf("/",e.indexOf("://")+3),i=e.substring(0,t)+"/",n=e.indexOf("/",e.indexOf(i)+i.length);return e.substring(0,n)}$(document).ready(function(){webRoot=getRootWebSitePath(),$(".send_json_button").css("background","url("+webRoot+"/resources/richLecture_addons/css/images_editor/saveButton-"+language.selectedLang+".png) no-repeat"),presentation_file=webRoot+"/services/presentation/",cuts_file=webRoot+"/services/cuts/",clips_list_file=webRoot+"/services/cliplist/",realediting_file=webRoot+"/services/realediting/do/",$.ionSound({sounds:["glass"],path:webRoot+"/resources/richLecture_addons/js/ext_js/sounds/",volume:"1.0"}),timeline_width=$(".timeline").width(),info=document.getElementById("info"),define_actions(),1===production_mode&&(-1!==(vid_lecture_id=window.location.search.replace("?rid=","")).indexOf("&")&&(window.location.href=window.location.search.replace(window.location.href.substring(window.location.href.indexOf("&")),"")),presentation_file+=vid_lecture_id,cuts_file+=vid_lecture_id,clips_list_file+=vid_lecture_id,realediting_file+=vid_lecture_id),read_parameters_XML(),go_to_field_func();let e=$(".go_to_field");e.focus(function(){go_to_time_refresh=0}),e.focusout(function(){go_to_time_refresh=1,setTimeout(function(){return!1},100)}),$(window).bind("beforeunload",function(){if(!1===$(".send_json_button").prop("disabled"))return language.e27})});