var crossDomain_option=false;cuepoints_c=[];begin_cut_times=[];end_cut_times=[];cut_end_in_sec=[];var provider_type="";var video_url="";var cuts_period=0;var production_mode=1;var presentation_file="";var cuts_file="";var slides_file="";var clip_file="";var webRoot="";var info;var actions;var debug=0;var global_vid_duration=-1;var pp;var timeline_width=0;var cuts_counter=0;var time_now=0;var timeline_progress_bar_update_flag=1;var lock_flag=0;var go_to_time_refresh=1;var indicator_every_no_secs=900;var slides_counter=0;var basepath="";cuepointsx=[];slide_titles=[];slide_at=[];var edit_marker_on=0;var slide_to_be_loaded="";var cuts_loaded=0;var slides_loaded=0;var clip_loaded=0;var clip_duration=-1;var clip_start=-1
var clip_end=-1;function define_actions(){actions={mute:function(){if(pp.getStatus().muted){$('.player_mute').css('background','url('+webRoot+'/resources/richLecture_addons/css/images_editor/unmute-large.png) no-repeat');pp.unmute();pp.setVolume(50);}else{$('.player_mute').css('background','url('+webRoot+'/resources/richLecture_addons/css/images_editor/mute-large.png) no-repeat');pp.mute();}},voldown:function(){curr_vol=pp.getVolume();if(curr_vol-10<=0){pp.setVolume(0);}else
pp.setVolume(curr_vol-10);},volup:function(){curr_vol=pp.getVolume();if(curr_vol+10>100)
pp.setVolume(100);else
pp.setVolume(curr_vol+10);},play:function(){if(pp.toggle()){$('.player_play').css('background','url('+webRoot+'/resources/richLecture_addons/css/images_editor/pause-large.png) no-repeat');}else{$('.player_play').css('background','url('+webRoot+'/resources/richLecture_addons/css/images_editor/play-large.png) no-repeat');}},stop:function(){pp.stop();$('.player_play').css('background','url('+webRoot+'/resources/richLecture_addons/css/images_editor/play-large.png) no-repeat');},seek:function(clip_type){if(clip_type=='start'){second=clip_start;for(i=0;i<cuepoints_c.length;i++){if(parseInt(cuepoints_c[i]/1000,10)<=clip_start&&cut_end_in_sec[cuepoints_c[i]]>clip_start){second=cut_end_in_sec[cuepoints_c[i]];break;}}}else{second=clip_end;for(i=0;i<cuepoints_c.length;i++){if(parseInt(cuepoints_c[i]/1000,10)<clip_end&&cut_end_in_sec[cuepoints_c[i]]>=clip_end){second=parseInt(cuepoints_c[i]/1000,10);break;}}
if(second-5>0)
second=second-5;}
pp.seek(second);},fast_seek:function(direction){time_now=Math.round(pp.getTime());if(direction=='fwd'){if(time_now+5>=global_vid_duration)
pp.seek(global_vid_duration);else
pp.seek(time_now+5);}else{if(time_now-5<=0)
pp.seek(0);else
pp.seek(time_now-5);}},go_to_time:function(){var go_to_time=$(".go_to_field").val();var go_to_time_sec=convert_hh_mm_ss_format(go_to_time);var broken_time=go_to_time.split(':');if(go_to_time.length==8&&go_to_time_sec<global_vid_duration&&broken_time.length==3)
if(broken_time[0].length==2&&broken_time[1].length==2&&broken_time[2].length==2&&$.isNumeric(broken_time[0])&&$.isNumeric(broken_time[1])&&$.isNumeric(broken_time[2]))
if(broken_time[0]<60&&broken_time[1]<60&&broken_time[2]<60)
pp.seek(go_to_time_sec);},set_clip:function(clip_type,clip_time,initial_state){if(clip_time==null)
clip_time=Math.round(pp.getTime());if(clip_type=='start'&&clip_time==global_vid_duration){alert(language.c1);return false;}else if(clip_type=='end'&&clip_time==0){alert(language.c2);return false;}
if(clip_type=='start'&&clip_time>=clip_end&&clip_end!=-1){alert(language.c3);return false;}else if(clip_type=='end'&&clip_time<=clip_start&&clip_start!=-1){alert(language.c4);return false;}
if(clip_type=='start'){removeClipOnTimelineBar(0,clip_start);addClipOnTimelineBar(0,clip_time);clip_start=clip_time;$('#start_clip_value').val(secondsTimeSpanToHMS(clip_start));$("#remove_clip_start_btn").prop('disabled',false);$("#goto_clip_start_btn").prop('disabled',false);pp.getClip(0).onCuepoint(0,function(clip,point){if(clip_start!=-1){$.ionSound.play("glass");pp.seek(clip_start);}});if(clip_end==-1){clip_end=global_vid_duration;$('#end_clip_value').val(secondsTimeSpanToHMS(global_vid_duration));$("#remove_clip_end_btn").prop('disabled',false);$("#goto_clip_end_btn").prop('disabled',false);}}else{removeClipOnTimelineBar(clip_end,global_vid_duration);addClipOnTimelineBar(clip_time,global_vid_duration);clip_end=clip_time;$('#end_clip_value').val(secondsTimeSpanToHMS(clip_end));$("#remove_clip_end_btn").prop('disabled',false);$("#goto_clip_end_btn").prop('disabled',false);pp.getClip(0).onCuepoint(clip_time*1000,function(clip,point){if(parseInt(point/1000,10)==clip_end&&clip_end!=-1){$.ionSound.play("glass");pp.stop();}});if(clip_start==-1){clip_start=0;$('#start_clip_value').val(secondsTimeSpanToHMS(0));$("#remove_clip_start_btn").prop('disabled',false);$("#goto_clip_start_btn").prop('disabled',false);}}
refresh_clip_duration();if(initial_state!=true){$(".send_json_button").prop('disabled',false);$(".send_json_button").css('opacity','1');}
return true;},remove_clip:function(clip_remove_type){if(clip_remove_type=='start'){removeClipOnTimelineBar(0,clip_start);if(clip_end==-1){clip_start=-1;$('#start_clip_value').val('~');clip_duration=-1;$('#clip_duration_value').html('~');$("#remove_clip_start_btn").prop('disabled',true);$("#goto_clip_start_btn").prop('disabled',true);}else if(clip_end==global_vid_duration){clip_start=-1;$('#start_clip_value').val('~');clip_end=-1;$('#end_clip_value').val('~');clip_duration=-1;$('#clip_duration_value').html('~');$("#remove_clip_start_btn").prop('disabled',true);$("#goto_clip_start_btn").prop('disabled',true);}else{clip_start=0;$('#start_clip_value').val('00:00:00');}}else{removeClipOnTimelineBar(clip_end,global_vid_duration);if(clip_start==-1){clip_end=-1;$('#end_clip_value').val('~');clip_duration=-1;$('#clip_duration_value').html('~');$("#remove_clip_end_btn").prop('disabled',true);$("#goto_clip_end_btn").prop('disabled',true);}else if(clip_start==0){clip_end=-1;$('#end_clip_value').val('~');clip_start=-1;$('#start_clip_value').val('~');clip_duration=-1;$('#clip_duration_value').html('~');$("#remove_clip_end_btn").prop('disabled',true);$("#goto_clip_end_btn").prop('disabled',true);}else{clip_end=global_vid_duration;$('#end_clip_value').val(secondsTimeSpanToHMS(global_vid_duration));}}
refresh_clip_duration();$(".send_json_button").prop('disabled',false);$(".send_json_button").css('opacity','1');return true;},edit_clip:function(clip_type){edit_marker_on=1;var initial_state_of_save_btn=$(".send_json_button").prop('disabled');var initial_opacity_of_save_btn=$(".send_json_button").css('opacity');$(".send_json_button").prop('disabled',true);$(".send_json_button").css('opacity','0.5');$("button").prop('disabled',true);$("button").css('opacity','0.2');$('#'+clip_type+'_clip_value').prop('disabled',false);$('#'+clip_type+'_clip_value').addClass('borderEditTime');$('#'+clip_type+'_clip_value').focus();var initial_edit_time_hms=$('#'+clip_type+'_clip_value').val();var initial_edit_time=convert_hh_mm_ss_format(initial_edit_time_hms);$('#'+clip_type+'_clip_value').bind('keyup',function(e){if(e.keyCode==13){var save_edit_time=$('#'+clip_type+'_clip_value').val();var new_edit_time_sec=convert_hh_mm_ss_format(save_edit_time);var broken_time=save_edit_time.split(':');if(initial_edit_time!=new_edit_time_sec){if(save_edit_time.length==8&&new_edit_time_sec<global_vid_duration&&broken_time.length==3){if(broken_time[0].length==2&&broken_time[1].length==2&&broken_time[2].length==2&&$.isNumeric(broken_time[0])&&$.isNumeric(broken_time[1])&&$.isNumeric(broken_time[2])){if(broken_time[0]<60&&broken_time[1]<60&&broken_time[2]<60){if(actions.set_clip(clip_type,new_edit_time_sec)!=false){edit_marker_on=0;$('#'+clip_type+'_clip_value').removeClass('borderEditTime');$('#'+clip_type+'_clip_value').prop('disabled',true);$("button").prop('disabled',false);$("button").css('opacity','');$(".set_start_button").css('opacity','1');$(".set_end_button").css('opacity','1');$(".send_json_button").prop('disabled',false);$(".send_json_button").css('opacity','1');$('#'+clip_type+'_clip_value').unbind('keyup');if(new_edit_time_sec>Math.round(pp.getTime())&&clip_type=='start'||new_edit_time_sec<Math.round(pp.getTime())&&clip_type=='end')
actions.seek(clip_type);return false;}else
$('#'+clip_type+'_clip_value').val(initial_edit_time_hms);}else
$('#'+clip_type+'_clip_value').val(initial_edit_time_hms);}else
$('#'+clip_type+'_clip_value').val(initial_edit_time_hms);}else
$('#'+clip_type+'_clip_value').val(initial_edit_time_hms);}else
$('#'+clip_type+'_clip_value').val(initial_edit_time_hms);$('#'+clip_type+'_clip_value').prop('disabled',true);$('#'+clip_type+'_clip_value').removeClass('borderEditTime');edit_marker_on=0;$("button").prop('disabled',false);$("button").css('opacity','');$(".set_start_button").css('opacity','1');$(".set_end_button").css('opacity','1');$(".send_json_button").prop('disabled',initial_state_of_save_btn);$(".send_json_button").css('opacity',initial_opacity_of_save_btn);$('#'+clip_type+'_clip_value').unbind('keyup');}else if(e.keyCode==27){$('#'+clip_type+'_clip_value').val(initial_edit_time_hms);$('#'+clip_type+'_clip_value').prop('disabled',true);$('#'+clip_type+'_clip_value').removeClass('borderEditTime');edit_marker_on=0;$("button").prop('disabled',false);$("button").css('opacity','');$(".set_start_button").css('opacity','1');$(".set_end_button").css('opacity','1');$(".send_json_button").prop('disabled',initial_state_of_save_btn);$(".send_json_button").css('opacity',initial_opacity_of_save_btn);$('#'+clip_type+'_clip_value').unbind('keyup');}});},send_json:function(){$(".send_json_button").prop('disabled',true);$(".send_json_button").css('opacity','0.5');var total_json_content={clip_duration:secondsTimeSpanToHMS(clip_duration),clip_starttime:secondsTimeSpanToHMS(clip_start),clip_endtime:secondsTimeSpanToHMS(clip_end),initial_duration:secondsTimeSpanToHMS(global_vid_duration),};var total_json=JSON.stringify(total_json_content);console.log(total_json);if(production_mode==0){info.innerHTML="JSON: "+total_json;}else{$.ajax({url:clip_file,type:"POST",contentType:"application/json; charset=utf-8",dataType:"html",crossDomain:crossDomain_option,data:total_json,cache:false,processData:false,success:function(res){if(res!=1){if(res==4)
alert(language.c8);else if(res==5)
alert(language.c9);else if(res==2)
alert(language.c7);else
alert(language.c5);$(".send_json_button").prop('disabled',false);$(".send_json_button").css('opacity','1');}else{$(".send_json_button").prop('disabled',true);$(".send_json_button").css('opacity','0.5');}},error:function(){alert(language.c5);$(".send_json_button").prop('disabled',false);$(".send_json_button").css('opacity','1');}});}}}}
function refresh_clip_duration(){if(clip_end==-1||clip_start==-1){clip_duration=-1;$("#clip_duration_value").html('~');return;}
var clip_duration_tmp=clip_end-clip_start;for(i=0;i<cuepoints_c.length;i++){if((parseInt(cuepoints_c[i]/1000,10)<=clip_start&&cut_end_in_sec[cuepoints_c[i]]<=clip_start)||(parseInt(cuepoints_c[i]/1000,10)>=clip_end)){continue;}else if(parseInt(cuepoints_c[i]/1000,10)>=clip_start&&cut_end_in_sec[cuepoints_c[i]]<=clip_end){clip_duration_tmp-=cut_end_in_sec[cuepoints_c[i]]-parseInt(cuepoints_c[i]/1000,10);}else if(parseInt(cuepoints_c[i]/1000,10)<=clip_start&&cut_end_in_sec[cuepoints_c[i]]>=clip_end){clip_duration_tmp-=clip_end-clip_start;}else if(parseInt(cuepoints_c[i]/1000,10)<=clip_start&&cut_end_in_sec[cuepoints_c[i]]>clip_start&&cut_end_in_sec[cuepoints_c[i]]<=clip_end){clip_duration_tmp-=cut_end_in_sec[cuepoints_c[i]]-clip_start;}else if(parseInt(cuepoints_c[i]/1000,10)>clip_start&&cut_end_in_sec[cuepoints_c[i]]>=clip_end){clip_duration_tmp-=clip_end-parseInt(cuepoints_c[i]/1000,10);}}
if(clip_duration_tmp<0)
clip_duration_tmp=0;clip_duration=clip_duration_tmp;$("#clip_duration_value").html(secondsTimeSpanToHMS(clip_duration));}
function reformat_date(date_original){var date_splited=date_original.split("-");return(date_splited[2]+'-'+date_splited[1]+'-'+date_splited[0]);}
function read_parameters_XML(){$.ajax({type:"GET",url:presentation_file,dataType:"xml",crossDomain:crossDomain_option,cache:false,success:function(xml){logo=$(xml).find('logo').text();title=$(xml).find('title:first').text();$(document).attr('title',title);title=truncate(title,55,'...');date_txt=reformat_date($(xml).find('date').text());provider_type=$(xml).find('provider').text();video_url=$(xml).find('resource[format=MP4]').text();global_vid_duration=convert_hh_mm_ss_format($(xml).find('duration').text());$('<div class="header-item"><\/div>').html(title+' | '+date_txt).prependTo($('.header'));$('<div class="header-logo-item-separator"><\/div>').prependTo($('.header'));$('<div class="header-logo"><img src="'+logo+'"><\/img><\/div>').prependTo($('.header'));},complete:function(){load_player();timeline_progress_bar();read_cuts_XML();read_slides_XML();read_clip_XML();}});}
function load_player(){pp=$f("player",{src:webRoot+"/resources/richLecture_addons/js/ext_js/flowplayer/flowplayer-3.2.16.swf",wmode:"opaque"},{plugins:{audio:{url:webRoot+'/resources/richLecture_addons/js/ext_js/flowplayer/flowplayer.audio-3.2.11.swf'},pseudo:{url:webRoot+'/resources/richLecture_addons/js/ext_js/flowplayer/flowplayer.pseudostreaming-3.2.12.swf'},controls:null},clip:{coverImage:{url:webRoot+"/resources/richLecture_addons/css/images_editor/AudioOnly.jpg",scaling:'fit'},autoPlay:false,autoBuffering:true,provider:provider_type,url:video_url,scaling:'fit',onStart:function(){$('.player_play').css('background','url('+webRoot+'/resources/richLecture_addons/css/images_editor/pause-large.png) no-repeat');draggable_bar();},onPause:function(clip){$('.player_play').css('background','url('+webRoot+'/resources/richLecture_addons/css/images_editor/play-large.png) no-repeat');if(debug)
info.innerHTML="player paused at "+Math.round(this.getTime());},onSeek:function(){if(clip_duration==0)
$f().stop();curr_time=Math.round(this.getTime())*1000;curr_time+=1;if(debug)info.innerHTML="onSeek"+curr_time;time_to_go=curr_time;for(i=0;i<cuepoints_c.length;i++){if(cuepoints_c[i]<=curr_time){var end_c=cut_end_in_sec[cuepoints_c[i]]*1000;var diff=curr_time-end_c;if(diff<=0){if(debug)info.innerHTML="on Seek of end-cut current time at "+curr_time+" cut_period "+i+":"+cuepoints_c[i]+" - "+end_c;if((end_c/1000)<global_vid_duration){$f().seek(end_c/1000.0);time_to_go=end_c;}else{$f().stop();time_to_go=global_vid_duration*1000;}
break;}else{if(debug)info.innerHTML="no cuts:"+i+" "+cuepoints_c[i]+" "+end_c+" |curr: "+curr_time+" dif: "+diff;}}}
if(parseInt(time_to_go/1000,10)<=clip_start&&clip_start!=-1){$f().seek(clip_start);time_to_go=clip_start*1000;}else if(parseInt(time_to_go/1000,10)>=clip_end&&clip_end!=-1){$f().stop();time_to_go=global_vid_duration*1000;}
total_num_of_slides=cuepointsx.length;var k=-1;for(var i=0;i<total_num_of_slides;i++){if(time_to_go>=cuepointsx[total_num_of_slides-1]){k=total_num_of_slides-1;break;}else if(cuepointsx[i]<=time_to_go&&time_to_go<cuepointsx[i+1]){k=i;break;}}
slide_to_be_loaded=$(".scroll-content-item").index($('#scroll-content-item-'+cuepointsx[k]/1000));set_active_img($('#scroll-content-item-'+cuepointsx[k]/1000).find("img"));},onResume:function(){$('.player_play').css('background','url('+webRoot+'/resources/richLecture_addons/css/images_editor/pause-large.png) no-repeat');if(debug)info.innerHTML="player resumed";}},onLoad:function(){if(debug)info.innerHTML="player loaded";},onVolume:function(level){if(debug)info.innerHTML="volume level is: "+Math.round(level);},onFinish:function(){$('.player_play').css('background','url('+webRoot+'/resources/richLecture_addons/css/images_editor/play-large.png) no-repeat');if(debug)info.innerHTML='player unloaded upon onFinish()';}});}
function read_slides_XML(){var increament=0;var slides_xml_exists=0;var refreshIntervalIdForCuts=setInterval(function(){if(cuts_loaded==1){clearInterval(refreshIntervalIdForCuts);$.ajax({type:"GET",url:slides_file,crossDomain:true,dataType:"xml",cache:false,success:function(xml){basepath=$(xml).find('basepath').text();$(xml).find('slide').each(function(){slides_xml_exists=1;var url=$(this).find('url').text();url=basepath+url;var time=$(this).find('time').text();var slide_title=$(this).find('title').text();if(!slide_title.length)
slide_title=language.s4;if(time!=-1){times=time.split(',');for(times_iteration=0;times_iteration<times.length;times_iteration++){time=convert_hh_mm_ss_format(times[times_iteration]);if(time<global_vid_duration){cuepointsx.push(time*1000);slide_at[time*1000]=url;slide_titles[time*1000]=slide_title;pp.getClip(0).onCuepoint(time*1000,function(clip,point){if(cuepointsx.indexOf(time*1000)!=-1){slide_to_be_loaded=$(".scroll-content-item").index($('#scroll-content-item-'+point/1000));set_active_img($('#scroll-content-item-'+point/1000).find("img"));}});increament++;}}}});if(slides_xml_exists==0||increament==0){$(".scroll_wrapper").remove();return false;}
cuepointsx=cuepointsx.sort(function(a,b){return a-b;});for(counter_x=0;counter_x<cuepointsx.length;counter_x++){for(counter_c=0;counter_c<cuepoints_c.length;counter_c++){if(counter_x==cuepointsx.length-1){if(cuepointsx[counter_x]>=cuepoints_c[counter_c]&&global_vid_duration==cut_end_in_sec[cuepoints_c[counter_c]]){cuepointsx.splice(counter_x,1);increament--;counter_x--;}}else if(cuepointsx[counter_x]>=cuepoints_c[counter_c]&&cuepointsx[counter_x+1]<=cut_end_in_sec[cuepoints_c[counter_c]]*1000){cuepointsx.splice(counter_x,1);increament--;counter_x--;}}}
if(increament==0){$(".scroll_wrapper").remove();slides_loaded=1;return false;}else if(increament<=4){$(".scroll-bwd").remove();$(".scroll-fwd").remove();}
$('.scroll_wrapper').disableSelection();for(j=0;j<cuepointsx.length;j++){var last_slash_pos=slide_at[cuepointsx[j]].lastIndexOf('/');url_for_scroll_bar=slide_at[cuepointsx[j]].substr(0,last_slash_pos+1)+"small/"+slide_at[cuepointsx[j]].substr(last_slash_pos+1);$('<div class="scroll-content-item" id="scroll-content-item-'+cuepointsx[j]/1000+'"><\/div>').html('<img src="'+url_for_scroll_bar+'" title="'+(j+1)+' '+slide_titles[cuepointsx[j]]+'" ><div class="scroll-content-img-number">'+(j+1)+'<\/div><div class="scroll-content-img-title">'+slide_titles[cuepointsx[j]]+'<\/div>').appendTo($('.scroll-content'));};var img_div;img_div=$(".scroll-content-item");total_img_width=img_div.width();total_img_width+=2*parseInt(img_div.css("paddingRight"),10);total_img_width+=2*parseInt(img_div.css("marginRight"),10);scroll_area_img_width=total_img_width*increament;scroll_area_img_width+=4;scroll_area_img_width-=2*parseInt(img_div.css("marginRight"),10);$('.scroll-content').disableSelection();$(".scroll-content").css("width",scroll_area_img_width+"px");if(debug)info.innerHTML="Scroll are for thumbenails has width "+scroll_area_img_width+"px";$(".scroll-content-item").click(function(){var url=$(this).find("img").attr("src");url=url.replace("small/","");if(edit_marker_on==0){if($.inArray(url,slide_at)>=0){slide_to_be_loaded=$(".scroll-content-item").index(this);set_active_img($(this).find("img"));var current_slide_time=$(this).attr("id").replace("scroll-content-item-","");pp.seek(current_slide_time);}}});slides_loaded=1;}});}},200);}
function read_clip_XML(){var refreshIntervalIdForSlides=setInterval(function(){if(slides_loaded==1){clearInterval(refreshIntervalIdForSlides);$.ajax({type:"GET",url:clip_file,dataType:"xml",crossDomain:crossDomain_option,cache:false,success:function(xml){title=$(xml).find('title').text();description=$(xml).find('description').text();$(document).attr('title',title);title=truncate(title,55,'...');$('.header-item').html(title+' | '+date_txt);if($(xml).find('clip_starttime').text()!=-1){actions.set_clip('start',convert_hh_mm_ss_format($(xml).find('clip_starttime').text()),true);}
if($(xml).find('clip_endtime').text()!=-1){actions.set_clip('end',convert_hh_mm_ss_format($(xml).find('clip_endtime').text()),true);}
refresh_clip_duration();clip_loaded=1;}});}},200);}
function set_active_img(img){var go_slider_to=(slide_to_be_loaded*total_img_width)-total_img_width;$(".scroll-content-item").removeClass("active");$(img).parent().addClass("active");$(".scroll-content-img-number").removeClass("active_number_slide");$(img).parent().find(".scroll-content-img-number").addClass("active_number_slide");setTimeout(function(){$(".scroll-pane").animate({scrollLeft:go_slider_to});},500);}
function truncate(str,maxLength,suffix)
{if(str.length>maxLength)
{str=str.substring(0,maxLength+1);str=str.substring(0,Math.min(str.length,str.lastIndexOf(" ")));str=str+suffix;}
return str;}
function read_cuts_XML(){$.ajax({type:"GET",url:cuts_file,crossDomain:crossDomain_option,cache:false,dataType:"xml",success:function(xml_for_trims_cuts){var xml_clips=$(xml_for_trims_cuts).find("clips");var xml_trims=$(xml_for_trims_cuts).find("trims");xml_trims.find("start").each(function(){begin_sec=$(this).find('begin').text();end_sec=$(this).find('end').text();begin_sec=convert_hh_mm_ss_format(begin_sec);end_sec=convert_hh_mm_ss_format(end_sec);cut_end_in_sec[begin_sec*1000]=end_sec;cuepoints_c.push(begin_sec*1000);addCutOnTimelineBar(begin_sec,end_sec);pp.getClip(0).onCuepoint(begin_sec*1000,function(clip,point){$.ionSound.play("glass");var new_time=cut_end_in_sec[point];if(debug)info.innerHTML="onCuepoint cut cuepoint: "+point+" "+" | "+new_time;pp.seek(new_time);});});xml_trims.find("finish").each(function(){begin_sec=$(this).find('begin').text();end_sec=$(this).find('end').text();begin_sec=convert_hh_mm_ss_format(begin_sec);end_sec=convert_hh_mm_ss_format(end_sec);cut_end_in_sec[begin_sec*1000]=end_sec;cuepoints_c.push(begin_sec*1000);addCutOnTimelineBar(begin_sec,end_sec);pp.getClip(0).onCuepoint(begin_sec*1000,function(clip,point){$.ionSound.play("glass");var new_time=cut_end_in_sec[point];if(debug)info.innerHTML="onCuepoint cut cuepoint: "+point+" "+" | "+new_time;pp.stop();});});xml_clips.find("cut").each(function(){begin_sec=$(this).find('begin').text();end_sec=$(this).find('end').text();begin_sec=convert_hh_mm_ss_format(begin_sec);end_sec=convert_hh_mm_ss_format(end_sec);cut_end_in_sec[begin_sec*1000]=end_sec;cuepoints_c.push(begin_sec*1000);begin_cut_times[cuts_counter]=begin_sec;end_cut_times[cuts_counter]=end_sec;addCutOnTimelineBar(begin_cut_times[cuts_counter],end_cut_times[cuts_counter]);pp.getClip(0).onCuepoint(begin_sec*1000,function(clip,point){$.ionSound.play("glass");var new_time=cut_end_in_sec[point];if(debug)info.innerHTML="onCuepoint cut cuepoint: "+point+" "+" | "+new_time;pp.seek(new_time);});cuts_counter++;});cuts_loaded=1;}});}
function addCutOnTimelineBar(begin_sec,until_video_time){timeline_bar_start=Math.round(((begin_sec)/global_vid_duration)*timeline_width);timeline_bar_width=Math.round(((until_video_time-begin_sec)/global_vid_duration)*timeline_width);$('<div class="marked_area" id="timeline_bar_'+begin_sec+'_'+until_video_time+'" title="'+secondsTimeSpanToHMS(begin_sec)+' - '+secondsTimeSpanToHMS(until_video_time)+'"><\/div>').animate({'left':timeline_bar_start+"px",'width':timeline_bar_width+"px"}).appendTo($('.timeline'));}
function addClipOnTimelineBar(begin_sec,until_video_time){timeline_bar_start=Math.round(((begin_sec)/global_vid_duration)*timeline_width);timeline_bar_width=Math.round(((until_video_time-begin_sec)/global_vid_duration)*timeline_width);$('<div class="marked_area_clip" id="timeline_bar_clip_'+begin_sec+'_'+until_video_time+'" title="'+secondsTimeSpanToHMS(begin_sec)+' - '+secondsTimeSpanToHMS(until_video_time)+'"><\/div>').animate({'left':timeline_bar_start+"px",'width':timeline_bar_width+"px"}).appendTo($('.timeline'));}
function removeClipOnTimelineBar(begin_sec,until_video_time){$('#timeline_bar_clip_'+begin_sec+'_'+until_video_time).remove();}
function go_to_field_func(){$(".go_to_field").click(function(){go_to_time_refresh=0;});$(".go_to_field").focus(function(){go_to_time_refresh=0;});$(".go_to_field").select(function(){go_to_time_refresh=0;});$(".go_to_field").focusout(function(){go_to_time_refresh=1;});$('.go_to_field').bind('keyup',function(e){if(e.keyCode==13){actions.go_to_time();go_to_time_refresh=1;}else if(e.keyCode==27){go_to_time_refresh=1;}else{go_to_time_refresh=0;}});}
function convert_hh_mm_ss_format(input_time){var broken_time=input_time.split(':');var hours=0;var minutes=0;var seconds=0;if(broken_time.length==1)seconds=parseFloat(broken_time[0]);if(broken_time.length==2){minutes=parseFloat(broken_time[0]);seconds=parseFloat(broken_time[1]);}
if(broken_time.length==3){hours=parseFloat(broken_time[0]);minutes=parseFloat(broken_time[1]);seconds=parseFloat(broken_time[2]);}
return Math.round(seconds+60*minutes+3600*hours);}
function secondsTimeSpanToHMS(s){if(s==-1)return-1;var h=Math.floor(s/3600);s-=h*3600;var m=Math.floor(s/60);s-=m*60;return(h<10?'0'+h:h)+":"+(m<10?'0'+m:m)+":"+(s<10?'0'+s:s);}
function timeline_progress_bar(){var quarter_period=parseInt(global_vid_duration/indicator_every_no_secs);var minute_period=parseInt(global_vid_duration/60);for(i=0;i<=minute_period;i++){left_pos=Math.round((i*60/global_vid_duration)*timeline_width);if(i%5)
$('<div class="minute_period"><\/div>').css({'left':+left_pos+'px'}).appendTo($('.timeline'));else
$('<div class="five_minute_period"><\/div>').css({'left':+left_pos+'px'}).appendTo($('.timeline'));}
for(i=0;i<=quarter_period;i++){left_pos=Math.round((i*indicator_every_no_secs/global_vid_duration)*timeline_width);$('<div class="quarter_period"><\/div>').html('<div class="quarter_period_time">'+secondsTimeSpanToHMS(i*indicator_every_no_secs)+'<\/div>').css({'left':+left_pos+'px'}).appendTo($('.timeline'));if(i==quarter_period&&(timeline_width-left_pos)<25){$(".quarter_period_time").html('');}}
$('<div class="quarter_period"><\/div>').html('<div class="quarter_period_time">'+secondsTimeSpanToHMS(global_vid_duration)+'<\/div>').css({'left':+(timeline_width-1)+'px'}).appendTo($('.timeline'));setInterval(function(){if(timeline_progress_bar_update_flag==1){lock_flag=1;time_now=pp.getTime();position_on_timeline_bar=Math.round((time_now/global_vid_duration)*timeline_width);$(".timeline_progress_position_time").html(secondsTimeSpanToHMS(Math.round(time_now)));$(".timeline_progress_position").animate({'left':position_on_timeline_bar+"px"},{duration:100,queue:false});if(go_to_time_refresh==1){$(".go_to_field").val(secondsTimeSpanToHMS(Math.round(time_now)));}
setTimeout(function(){return false;},100);lock_flag=0;}},1000);}
function draggable_bar(){$('.timeline_progress_position').draggable({axis:"x",containment:'parent',start:function(){while(lock_flag==1){setTimeout(function(){return false;},100);};timeline_progress_bar_update_flag=0;},stop:function(){var cursor_pos=$(this).css('left');cursor_pos=cursor_pos.substring(0,cursor_pos.length-2);cursor_sec=Math.round((cursor_pos/timeline_width)*global_vid_duration);pp.seek(cursor_sec);timeline_progress_bar_update_flag=1;},drag:function(){var cursor_pos=$(this).css('left');cursor_pos=Math.round(cursor_pos.substring(0,cursor_pos.length-2));cursor_sec=Math.round((cursor_pos/timeline_width)*global_vid_duration);$(".timeline_progress_position_time").html(secondsTimeSpanToHMS(Math.round(cursor_sec)));$(".go_to_field").val(secondsTimeSpanToHMS(Math.round(cursor_sec)));}});}
function getRootWebSitePath()
{var _location=document.location.toString();var applicationNameIndex=_location.indexOf('/',_location.indexOf('://')+3);var applicationName=_location.substring(0,applicationNameIndex)+'/';var webFolderIndex=_location.indexOf('/',_location.indexOf(applicationName)+applicationName.length);var webFolderFullPath=_location.substring(0,webFolderIndex);return webFolderFullPath;}
function scroll(){$(".scroll-pane").mousewheel(function(e,delta){this.scrollLeft-=(delta*total_img_width);e.preventDefault();});$(".scroll-fwd").on("click",function(){var go_slider_to;var move_width=parseInt($('.scroll-pane').width()/total_img_width,10);move_width*=total_img_width;var curr_scroll_position=$('.scroll-pane').scrollLeft();go_slider_to=curr_scroll_position+move_width;$(".scroll-pane").stop();$(".scroll-pane").animate({scrollLeft:go_slider_to});});$(".scroll-bwd").on("click",function(){var go_slider_to;var move_width=parseInt($('.scroll-pane').width()/total_img_width,10);move_width*=total_img_width;var curr_scroll_position=$('.scroll-pane').scrollLeft();go_slider_to=curr_scroll_position-move_width;$(".scroll-pane").stop();$(".scroll-pane").animate({scrollLeft:go_slider_to});});}
$(document).ready(function(){webRoot=getRootWebSitePath();$(".send_json_button").css('background','url('+webRoot+'/resources/richLecture_addons/css/images_editor/saveButton-'+language.selectedLang+'.png) no-repeat');presentation_file=webRoot+"/services/presentation/";cuts_file=webRoot+"/services/cuts/";slides_file=webRoot+"/services/slides/";clip_file=webRoot+"/services/clip/";$.ionSound({sounds:["glass"],path:webRoot+"/resources/richLecture_addons/js/ext_js/sounds/",volume:"1.0"});timeline_width=$(".timeline").width();info=document.getElementById("info");define_actions();scroll();if(production_mode==1){vid_lecture_params=window.location.search.replace("?","");vid_lecture_id_args=vid_lecture_params.split('&');vid_lecture_id=vid_lecture_id_args[0].replace("rid=","");presentation_file=presentation_file+vid_lecture_id;cuts_file=cuts_file+vid_lecture_id;slides_file=slides_file+vid_lecture_id;clip_lecture_id=vid_lecture_id_args[1].replace("clip=","");clip_file=clip_file+clip_lecture_id;}
read_parameters_XML();var refreshIntervalIdEverythingReady=setInterval(function(){if(clip_loaded==1){clearInterval(refreshIntervalIdEverythingReady);$("#dvLoading").hide();}},200);go_to_field_func();$('#contentwrapper').disableSelection();$(window).bind('beforeunload',function(){if($(".send_json_button").prop('disabled')==false)
return language.c6;});});