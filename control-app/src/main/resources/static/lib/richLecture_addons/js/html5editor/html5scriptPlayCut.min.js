let myPlayer,tt;const media_events=[];media_events.loadstart=0,media_events.progress=0,media_events.suspend=0,media_events.abort=0,media_events.error=0,media_events.emptied=0,media_events.stalled=0,media_events.loadedmetadata=0,media_events.loadeddata=0,media_events.canplay=0,media_events.canplaythrough=0,media_events.playing=0,media_events.waiting=0,media_events.seeking=0,media_events.seeked=0,media_events.ended=0,media_events.durationchange=0,media_events.timeupdate=0,media_events.play=0,media_events.pause=0,media_events.ratechange=0,media_events.resize=0,media_events.volumechange=0;const media_properties=["error","src","srcObject","currentSrc","crossOrigin","networkState","preload","buffered","readyState","seeking","currentTime","duration","paused","defaultPlaybackRate","playbackRate","played","seekable","ended","autoplay","loop","controls","volume","muted","defaultMuted","audioTracks","videoTracks","textTracks","width","height","videoWidth","videoHeight","poster"];let media_properties_elts=null,webm=null,track;function init_HTML5_modal(){document._video=document.getElementById("player_cut");const e=document.getElementById("mp4");e.parentNode;document._video.setAttribute("poster",webRoot+"/resources/richLecture_addons/css/images_editor/pause-large.png"),e.setAttribute("src",video_url),init_events("events",media_events)}function init_events(e,t){for(let e in t)document._video.addEventListener(e,capture,!1)}function capture(e){let t;media_events[e.type]++,"play"===e.type?(debug&&console.log("player resumed"),2===cuepoints_m.cues.length?getVideo().currentTime<cuepoints_m.cues[0].endTime?(getVideo().currentTime=cuepoints_m.cues[0].endTime,getVideo().pause()):getVideo().currentTime>=cuepoints_m.cues[1].startTime&&(getVideo().currentTime=cuepoints_m.cues[1].startTime,getVideo().pause()):1===cuepoints_m.cues.length&&getVideo().currentTime>cuepoints_m.cues[0].startTime&&(getVideo().currentTime=0,getVideo().pause())):"pause"===e.type?debug&&console.log("player resumed"):"seeked"===e.type?(t=Math.round(getVideo().currentTime),t+=1,debug&&console.log("onSeek"+t),1===cuepoints_m.cues.length&&getVideo().currentTime>cuepoints_m.cues[0].startTime&&(getVideo().currentTime=0,getVideo().pause()),2===cuepoints_m.cues.length&&(getVideo().currentTime<cuepoints_m.cues[0].endTime?(getVideo().currentTime=cuepoints_m.cues[0].endTime,getVideo().pause()):getVideo().currentTime>=cuepoints_m.cues[1].startTime&&(getVideo().currentTime=cuepoints_m.cues[1].startTime,getVideo().pause()))):"loadedmetadata"===e.type?(debug&&console.log("loaded"),cuepoints_m=getVideo().addTextTrack("metadata","English","en"),cuepoints_m.mode="showing",loadVideoWithCuttedParts(),getVideo().textTracks.addEventListener("addtrack",function(){let e=getVideo().textTracks,t=e.length;for(let i=0;i<t;i++)if("Timed Cue Point"===e[i].label){tt=e[i];break}const i=getVideo().textTracks.length-1;(tt=getVideo().textTracks[i]).addEventListener("cuechange",function(){void 0!==tt.activeCues[0]?2===cuepoints_m.cues.length?getVideo().currentTime<cuepoints_m.cues[0].endTime?(getVideo().currentTime=cuepoints_m.cues[0].endTime,getVideo().pause()):getVideo().currentTime>=cuepoints_m.cues[1].startTime&&(getVideo().currentTime=cuepoints_m.cues[1].startTime,getVideo().pause()):1===cuepoints_m.cues.length&&getVideo().currentTime>cuepoints_m.cues[0].startTime&&getVideo().pause():debug&&console.log("Cue point duration over<br/><br/>")})}),getVideo().volume=.5):"oncanplay"===e.type&&debug&&console.log("player ready")}function update_properties(){let td,i=0;for(let e in media_events){const t=document.getElementById("e_"+e);t&&(t.textContent=media_events[e],media_events[e]>0&&(t.className="true"))}for(let key in media_properties){let val=eval("document._video."+media_properties[key]);media_properties_elts[i++].textContent=val}if(void 0!==document._video.audioTracks)try{td=document.getElementById("m_audiotracks"),td.textContent=document._video.audioTracks.length.toString(),td.className="true"}catch(e){}if(void 0!==document._video.videoTracks)try{td=document.getElementById("m_videotracks"),td.textContent=document._video.videoTracks.length.toString(),td.className="true"}catch(e){}if(void 0!==document._video.textTracks)try{td=document.getElementById("m_texttracks"),td.textContent=document._video.textTracks.length.toString(),td.className="true"}catch(e){}}function resize(){document._video.width=document._video.videoWidth+10,document._video.height=document._video.videoHeight+10}function getVideo(){return document._video}function draggable_bar_HTML5(){$(".timeline_progress_position").draggable({axis:"x",containment:"parent",start:function(){for(;1===lock_flag;)setTimeout(function(){return!1},100);timeline_progress_bar_update_flag=0},stop:function(){let e=$(this).css("left");e=e.substring(0,e.length-2);let t=Math.round(e/timeline_width*global_vid_duration);getVideo().currentTime=t,timeline_progress_bar_update_flag=1},drag:function(){let e=$(this).css("left");e=Math.round(e.substring(0,e.length-2));let t=Math.round(e/timeline_width*global_vid_duration);$(".timeline_progress_position_time").html(secondsTimeSpanToHMS(Math.round(t))),$(".go_to_field").val(secondsTimeSpanToHMS(Math.round(t)))}})}function timeline_progress_bar_HTML5(){const e=parseInt((global_vid_duration/indicator_every_no_secs).toString()),t=parseInt((global_vid_duration/60).toString());let i,o,n,d=$(".timeline");for(let e=0;e<=t;e++)i=Math.round(60*e/global_vid_duration*timeline_width),e%5?$('<div class="minute_period"></div>').css({left:+i+"px"}).appendTo(d):$('<div class="five_minute_period"></div>').css({left:+i+"px"}).appendTo(d);for(let t=0;t<=e;t++)i=Math.round(t*indicator_every_no_secs/global_vid_duration*timeline_width),$('<div class="quarter_period"></div>').html('<div class="quarter_period_time">'+secondsTimeSpanToHMS(t*indicator_every_no_secs)+"</div>").css({left:+i+"px"}).appendTo(d),t===e&&timeline_width-i<25&&$(".quarter_period_time").html("");$('<div class="quarter_period"></div>').html('<div class="quarter_period_time">'+secondsTimeSpanToHMS(global_vid_duration)+"</div>").css({left:+(timeline_width-1)+"px"}).appendTo(d),setInterval(function(){1===timeline_progress_bar_update_flag&&(o=1,time_now=getVideo().currentTime,n=Math.round(time_now/global_vid_duration*timeline_width),$(".timeline_progress_position_time").html(secondsTimeSpanToHMS(Math.round(time_now))),$(".timeline_progress_position").animate({left:n+"px"},{duration:100,queue:!1}),1===go_to_time_refresh&&$(".go_to_field").val(secondsTimeSpanToHMS(Math.round(time_now))),setTimeout(function(){return!1},100),o=0)},1e3)}function toggle_mute(){getVideo().muted?(debug&&console.log("un-mute"),$(".player_mute").css("background","url("+webRoot+"/resources/richLecture_addons/css/images_editor/unmute-large.png) no-repeat"),getVideo().muted=!1,getVideo().volume=.5):(debug&&console.log("mute"),$(".player_mute").css("background","url("+webRoot+"/resources/richLecture_addons/css/images_editor/mute-large.png) no-repeat"),getVideo().muted=!0)}function volume_down(){getVideo().volume>=.2?getVideo().volume-=.1:getVideo().volume=0,debug&&console.log("volume down:"+getVideo().volume)}function volume_up(){getVideo().volume<=.9?getVideo().volume+=.1:getVideo().volume=1,debug&&console.log("volume up:"+getVideo().volume)}function toggle_play(){!1===document._video.paused?(getVideo().pause(),$(".player_play").css("background","url("+webRoot+"/resources/richLecture_addons/css/images_editor/play-large.png) no-repeat"),debug&&console.log("video paused")):(getVideo().play(),$(".player_play").css("background","url("+webRoot+"/resources/richLecture_addons/css/images_editor/pause-large.png) no-repeat"),debug&&console.log("video resumed"))}