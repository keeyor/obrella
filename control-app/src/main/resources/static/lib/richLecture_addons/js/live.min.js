var crossDomain_option=false;var movie_h=0;var active_slide_h=0;var movie_sec_h=0;var go_to_slide_refresh=1;cuepointsx=[];slide_at=[];slide_titles=[];var info,actions;var debug=0;var video_url_primary="";var video_url_ipcamera="";var video_url_camcast="";var video_url_screencast="";var multi_ip_streams_check=0;var current_resource_playing="";var videobutton_main_already_exists=0;var secondary_resource="";var basepath="";var number_of_total_slides=0;var slide_to_be_loaded="";var playlist_array=[];var webRoot="";var presentation_file="";var slides_file="";var player_primary_image="";var player_sec_image="";var slides_loaded=0;function showSelectedView(active){if(!active)active='main';activebutton='#videobutton-'+active;$('[id^=videobutton-]').removeClass('btn-video-active');$(activebutton).addClass('btn-video-active');$('[id^=videobutton-]').unbind("click");$('#videobutton-main').bind('click',function(){showSelectedView('main');jwplayer("player").remove();load_player_primary("");});$('#videobutton-board').bind('click',function(){showSelectedView('board');jwplayer("player").remove();load_player_primary("_board");});$('#videobutton-projector').bind('click',function(){showSelectedView('projector');jwplayer("player").remove();load_player_primary("_projector");});$(activebutton).off("click");$(activebutton).blur();};function reformat_datetime(datetime_original){var datetime_splited=datetime_original.split(" ");var date_splited=datetime_splited[0].split("-");return(date_splited[2]+'-'+date_splited[1]+'-'+date_splited[0]+' '+datetime_splited[1]);}
function read_parameters_XML(){$.ajax({type:"GET",url:presentation_file,dataType:"xml",crossDomain:crossDomain_option,cache:false,success:function(xml){var timeleft=$(xml).find('real_duration').text();if($(xml).find('header').text().substring(0,6)!="event:"){var refreshIntervalTimeLeft=setInterval(function(){timeleft=timeleft-1;if(timeleft<=0){clearInterval(refreshIntervalTimeLeft);$('#contentwrapper').html('<img id="stream_ended" alt="The live stream has finished" src="'+webRoot+'/resources/richLecture_addons/css/images_player/live_ended-'+language.selectedLang+'.jpg"><\/img>');$("#stream_ended").css("marginTop",parseInt(($("#contentwrapper").css("height").replace("px",'')/2)-($("#stream_ended").css("height").replace("px",'')/2),10));$('[id^=videobutton-]').hide();}},1000);}else{var refreshIntervalTimeLeft=setInterval(function(){timeleft=timeleft-1;if(timeleft<=0){$.ajax({type:"GET",url:presentation_file,dataType:"xml",crossDomain:crossDomain_option,cache:false,success:function(xml_final_check){timeleft=$(xml_final_check).find('real_duration').text();if(timeleft<=0){clearInterval(refreshIntervalTimeLeft);$('#contentwrapper').html('<img id="stream_ended" alt="The live stream has finished" src="'+webRoot+'/resources/richLecture_addons/css/images_player/live_ended-'+language.selectedLang+'.jpg"><\/img>');$("#stream_ended").css("marginTop",parseInt(($("#contentwrapper").css("height").replace("px",'')/2)-($("#stream_ended").css("height").replace("px",'')/2),10));$('[id^=videobutton-]').hide();}}});}},1000);}
logo=$(xml).find('logo').text();date_txt=reformat_datetime($(xml).find('date').text());duration=$(xml).find('duration').text();description=$(xml).find('description:first').text();video_url_ipcamera=$(xml).find('resource[format=ipcamera]').text();video_url_camcast=$(xml).find('resource[format=camcast]').text();if(video_url_ipcamera==-1)
video_url_primary=video_url_camcast
else
video_url_primary=video_url_ipcamera
video_url_screencast=$(xml).find('resource[format=screencast]').text();slides_uploaded=$(xml).find('slide');if(!slides_uploaded.length&&video_url_screencast==-1)
secondary_resource="none";else if(slides_uploaded.length)
secondary_resource="slides";else if(video_url_screencast!=-1)
secondary_resource="screencast";else
secondary_resource="none";if(secondary_resource!="slides"){$("#active_slide").remove();$(".right_sidebar").remove();$(".main_content").width("100%");$("#slides_exist").remove();}
if(secondary_resource=="none")
$("#resize_icon").remove();lecture_header=$(xml).find('header').text();if(lecture_header.substring(0,6)=="event:"){lecture_header=lecture_header.substring(6,lecture_header.length);$('#lecture_department').html(language.p1+"<span><\/span>");$('#lecture_serie').html(language.p2+"<span><\/span>");}
lecture_serie=$(xml).find('serie').text();$(document).attr('title',lecture_serie);lecture_presenter=$(xml).find('presenter').text();$('<div class="header-item"><\/div>').html(lecture_serie+' | '+date_txt).prependTo($('.header'));$('<div class="header-logo"><img alt="Institution logo" src="'+logo+'"><\/img><\/div>').prependTo($('.header'));$(".header-item").css("width",$(".header").width()-700);$("#show_lecture_info").dialog({autoOpen:false,modal:true,width:'500',resizable:false,draggable:false,position:{my:"center",at:"center",of:window},buttons:{Close:function(){$(this).dialog("close");}}});$(".ui-dialog-titlebar-close").remove();$('#lecture_date span').html(date_txt);$('#lecture_duration span').html(duration);$('#lecture_description span').html(description);$('#lecture_department span').html(lecture_header);$('#lecture_serie span').html(lecture_serie);if(lecture_presenter==-1)
$('#lecture_presenter').remove();else
$('#lecture_presenter span').html(lecture_presenter);$(".icon-info").parent().click(function(){$('#show_lecture_info').dialog("open");});},complete:function(){load_player_primary("");var refreshIntervalIdForPlayer=setInterval(function(){if(jwplayer("player").getState()=='IDLE'||jwplayer("player").getState()=='BUFFERING'||jwplayer("player").getState()=='PLAYING'||jwplayer("player").getState()=='PAUSED'){clearInterval(refreshIntervalIdForPlayer);if(secondary_resource=="slides"){read_slides_XML();}else if(secondary_resource=="screencast"){$("#movie_sec").css('display','table-cell');load_player_secondary();}else{slides_loaded=1;}}},200);var refreshIntervalIdEverythingReady=setInterval(function(){if(jwplayer("player_sec").getState()=='IDLE'||jwplayer("player_sec").getState()=='BUFFERING'||jwplayer("player_sec").getState()=='PLAYING'||jwplayer("player_sec").getState()=='PAUSED'||slides_loaded==1){clearInterval(refreshIntervalIdEverythingReady);scroll_bar_mousewheel();make_main_content_resizable();make_components_responsive();$("#dvLoading").hide();}},200);}});}
function load_player_secondary(){player_sec_image=webRoot+"/resources/richLecture_addons/css/images_player/waiting_to_start_live-"+language.selectedLang+".jpg";jwplayer("player_sec").setup({width:"100%",aspectratio:"16:9",autostart:true,mute:true,file:video_url_screencast.substring(video_url_screencast.lastIndexOf("/")+1,video_url_screencast.length),streamer:video_url_screencast.substring(0,video_url_screencast.lastIndexOf("/")),type:"rtmp",stagevideo:false,skin:webRoot+"/resources/richLecture_addons/js/ext_js/jwplayer/screencast.xml",image:player_sec_image});jwplayer("player_sec").onPlay(function(){player_sec_image=webRoot+"/resources/richLecture_addons/css/images_player/network_error-"+language.selectedLang+".jpg";});jwplayer("player_sec").onError(function(){setTimeout(function(){jwplayer("player_sec").load({file:video_url_screencast.substring(video_url_screencast.lastIndexOf("/")+1,video_url_screencast.length),streamer:video_url_screencast.substring(0,video_url_screencast.lastIndexOf("/")),type:"rtmp",image:player_sec_image});},5000);});}
function load_player_primary(suffix){current_resource_playing=suffix;player_primary_image=webRoot+"/resources/richLecture_addons/css/images_player/waiting_to_start_live-"+language.selectedLang+".jpg";jwplayer("player").setup({width:"100%",aspectratio:"16:9",autostart:true,file:video_url_primary.substring(video_url_primary.lastIndexOf("/")+1,video_url_primary.length)+current_resource_playing,streamer:video_url_primary.substring(0,video_url_primary.lastIndexOf("/")),type:"rtmp",image:player_primary_image});jwplayer("player").onPlay(function(){player_primary_image=webRoot+"/resources/richLecture_addons/css/images_player/network_error-"+language.selectedLang+".jpg";if(video_url_ipcamera!=-1&&multi_ip_streams_check==0){multi_ip_streams_check=1;jwplayer("player_board").setup({width:"100%",aspectratio:"16:9",autostart:true,file:video_url_primary.substring(video_url_primary.lastIndexOf("/")+1,video_url_primary.length)+"_board",streamer:video_url_primary.substring(0,video_url_primary.lastIndexOf("/")),type:"rtmp"});jwplayer("player_board").onPlay(function(){if(videobutton_main_already_exists==0){videobutton_main_already_exists=1;$('#video_group_btn').append('<img alt="Drag for resizing" id="videobutton-separator" src="'+webRoot+'/resources/richLecture_addons/css/images_player/seperator.png" style="margin-left:10px;margin-right:12px;" width="10" height="50"\/>');$('#video_group_btn').append('<button id="videobutton-main" type="button" class="btn btn-default btn-video"><span class="icon-live-camera-wvidew" style="font-size:33px; vertical-align:middle;"></span></button>');}
$('#video_group_btn').append('<button id="videobutton-board" type="button" class="btn btn-default btn-video"><span class="icon-live-camera-wboard" style="font-size:33px; vertical-align:middle;"></span></button>');jwplayer("player_board").remove();showSelectedView();});jwplayer("player_board").onError(function(){jwplayer("player_board").remove();});jwplayer("player_projector").setup({width:"100%",aspectratio:"16:9",autostart:true,file:video_url_primary.substring(video_url_primary.lastIndexOf("/")+1,video_url_primary.length)+"_projector",streamer:video_url_primary.substring(0,video_url_primary.lastIndexOf("/")),type:"rtmp"});jwplayer("player_projector").onPlay(function(){if(videobutton_main_already_exists==0){videobutton_main_already_exists=1;$('#video_group_btn').append('<img alt="Drag for resizing" id="videobutton-separator" src="'+webRoot+'/resources/richLecture_addons/css/images_player/seperator.png" style="margin-left:10px;margin-right:12px;" width="10" height="50"\/>');$('#video_group_btn').append('<button id="videobutton-main" type="button" class="btn btn-default btn-video"><span class="icon-live-camera-wvidew" style="font-size:33px; vertical-align:middle;"></span></button>');}
$('#video_group_btn').append('<button id="videobutton-projector" type="button" class="btn btn-default btn-video"><span class="icon-live-camera-present" style="font-size:33px; vertical-align:middle;"></span></button>');jwplayer("player_projector").remove();showSelectedView();});jwplayer("player_projector").onError(function(){jwplayer("player_projector").remove();});}
$('[id^=videobutton-]').show();});jwplayer("player").onError(function(){$('[id^=videobutton-]').hide();setTimeout(function(){jwplayer("player").load({file:video_url_primary.substring(video_url_primary.lastIndexOf("/")+1,video_url_primary.length)+current_resource_playing,streamer:video_url_primary.substring(0,video_url_primary.lastIndexOf("/")),type:"rtmp",image:player_primary_image});},5000);});}
function read_slides_XML(){var increament=0;$.ajax({type:"GET",url:slides_file,crossDomain:crossDomain_option,dataType:"xml",cache:false,success:function(xml){basepath=$(xml).find('basepath').text();$(xml).find('slide').each(function(){var url=$(this).find('url').text();url=basepath+url;var slide_title=$(this).find('title').text();if(!slide_title.length)
slide_title=language.s4;cuepointsx.push(increament*1000);slide_at[increament*1000]=url;slide_titles[increament*1000]=slide_title;increament++;});for(j=0;j<cuepointsx.length;j++){var last_slash_pos=slide_at[cuepointsx[j]].lastIndexOf('/');url_for_scroll_bar=slide_at[cuepointsx[j]].substr(0,last_slash_pos+1)+"small/"+slide_at[cuepointsx[j]].substr(last_slash_pos+1);$('<div class="scroll-content-item" id="scroll-content-item-'+cuepointsx[j]/1000+'"><\/div>').html('<img alt="'+(j+1)+' '+slide_titles[cuepointsx[j]]+'" src="'+url_for_scroll_bar+'" title="'+(j+1)+' '+slide_titles[cuepointsx[j]]+'" ><div class="scroll-content-img-number">'+(j+1)+'<\/div><div class="scroll-content-img-title">'+slide_titles[cuepointsx[j]]+'<\/div>').appendTo($('.scroll-content'));};$('.scroll-content').disableSelection();number_of_total_slides=increament;$(".scroll-pane").animate({scrollTop:0});$(".go_to_slide").val("00");$('#num_of_slides').html(number_of_total_slides);scroll_area_img_height=0;$(".scroll-content").children().each(function(){scroll_area_img_height=scroll_area_img_height+$(this).outerHeight();});$(".scroll-content").css("height",scroll_area_img_height+"px");$(".scroll-content-item").click(function(){var url=$(this).find("img").attr("src");url=url.replace("small/","");var wrap=$("#active_slide img");if(wrap.attr("src")!=url){wrap.css("opacity",0.3);wrap.attr("src",url).fadeTo("normal",1);slide_to_be_loaded=$(".scroll-content-item").index(this);set_active_img($(this));}}).filter(":first").click();slides_loaded=1;}});}
function set_active_img(item){if(go_to_slide_refresh==1)
$(".go_to_slide").val($(item).find($('.scroll-content-img-number')).html());go_slider_to=$(".scroll-pane").scrollTop()+$(item).offset().top-($(".header").height()+parseInt($("#contentwrapper").css("marginTop").replace("px",''),10)+parseInt($(item).css("marginBottom").replace("px",''),10)+2*parseInt($(item).css("marginTop").replace("px",''))+item.prev().height());$(".scroll-content-item").removeClass("active");$(item).addClass("active");$(".scroll-pane").animate({scrollTop:go_slider_to});}
function convert_hh_mm_ss_format(input_time){broken_time=input_time.split(':');hours=minutes=seconds=0;switch(broken_time.length){case 1:seconds=parseFloat(broken_time[0]);break;case 2:minutes=parseFloat(broken_time[0]);seconds=parseFloat(broken_time[1]);break;case 3:hours=parseFloat(broken_time[0]);minutes=parseFloat(broken_time[1]);seconds=parseFloat(broken_time[2]);break;}
return Math.round(seconds+60*minutes+3600*hours);}
function secondsTimeSpanToHMS(s){var h=Math.floor(s/3600);s-=h*3600;var m=Math.floor(s/60);s-=m*60;return(h<10?'0'+h:h)+":"+(m<10?'0'+m:m)+":"+(s<10?'0'+s:s);}
function make_main_content_resizable(){if(secondary_resource=="slides"){$("#active_slide").resizable({handles:{"e":$('#resize_icon')},aspectRatio:true,alsoResizeReverse:'#movie',maxWidth:800,minWidth:200,start:function(){movie_h=$('#movie').css("height");active_slide_h=$('#active_slide').css("height");},resize:function(){$('#movie').css("height",movie_h);$('#active_slide').css("height",active_slide_h);$("#next_slide").css("left",($("#active_slide").width()-45)+"px");}});}else if(secondary_resource=="screencast"){$("#movie_sec").resizable({handles:{"e":$('#resize_icon')},aspectRatio:true,alsoResizeReverse:'#movie',maxWidth:720,minWidth:200,start:function(){movie_h=$('#movie').css("height");movie_sec_h=$('#movie_sec').css("height");},resize:function(){$('#movie').css("height",movie_h);$('#movie_sec').css("height",movie_sec_h);}});}
$("#movie").resizable({handles:{"e":'',"w":''},aspectRatio:true,maxWidth:720,minWidth:200});}
function make_components_responsive(){if(secondary_resource=="slides"){$("#next_slide").css("left",($("#active_slide").width()-45)+"px");}else if(secondary_resource=="screencast"){$("#contentwrapper").css("maxWidth","1490px");}
if($("#contentwrapper").css("width").replace("px",'')==$("#contentwrapper").css("maxWidth").replace("px",'')){$("#contentwrapper").addClass("contentwrapper_max");var dynamic_left_distance=$(window).width()-$("#contentwrapper").css("maxWidth").replace("px",'');$("#contentwrapper").css('left',dynamic_left_distance/2-15);}else{$("#contentwrapper").removeClass("contentwrapper_max");$("#contentwrapper").css('left',0);}
$(window).resize(function(){var resizeTimer;if(resizeTimer){clearTimeout(resizeTimer);}
resizeTimer=setTimeout(function(){resizeTimer=null;$('#movie').css("height","100%");if(secondary_resource=="slides"){$('#active_slide').css("height","100%");$("#next_slide").css("left",($("#active_slide").width()-45)+"px");scroll_area_img_height=0;$(".scroll-content").children().each(function(){scroll_area_img_height=scroll_area_img_height+$(this).outerHeight();});$(".scroll-content").height(scroll_area_img_height);}else if(secondary_resource=="screencast"){$('#movie_sec').css("height","100%");}
$(".header-item").css("width",$(".header").width()-700);if($("#contentwrapper").css("width").replace("px",'')==$("#contentwrapper").css("maxWidth").replace("px",'')){$("#contentwrapper").addClass("contentwrapper_max");var dynamic_left_distance=$(window).width()-$("#contentwrapper").css("maxWidth").replace("px",'');$("#contentwrapper").css('left',dynamic_left_distance/2-15);}else{$("#contentwrapper").removeClass("contentwrapper_max");$("#contentwrapper").css('left',0);}},500);});}
function scroll_bar_mousewheel(){$(".scroll-pane").mousewheel();}
function load_menu_events(){$('#slidesButton').click(function(){$(this).addClass('btn-primary');$("#titlesButton").removeClass('btn-primary');$("#titlesButton").addClass('btn-default');$(".scroll-content-item img").show();$(".scroll-content-img-title").hide();scroll_area_img_height=0;$(".scroll-content").children().each(function(){scroll_area_img_height=scroll_area_img_height+$(this).outerHeight();});$(".scroll-content").height(scroll_area_img_height);set_active_img($("#"+$(".scroll-content-item").filter(".active").attr("id")));});$('#titlesButton').click(function(){$(this).addClass('btn-primary');$("#slidesButton").removeClass('btn-primary');$("#slidesButton").addClass('btn-default');$(".scroll-content-item img").hide();$(".scroll-content-img-title").show();scroll_area_img_height=0;$(".scroll-content").children().each(function(){scroll_area_img_height=scroll_area_img_height+$(this).outerHeight();});$(".scroll-content").height(scroll_area_img_height);set_active_img($("#"+$(".scroll-content-item").filter(".active").attr("id")));});$("#active_slide").disableSelection();$('#previous_slide').disableSelection();$('#next_slide').disableSelection();$("#active_slide").mouseenter(function(){$('#previous_slide').show();$('#next_slide').show();});$("#active_slide").mouseleave(function(){$('#previous_slide').hide();$('#next_slide').hide();});$('#previous_slide').click(function(){$(".scroll-content-item").filter(".active").prev().click();});$('#next_slide').click(function(){$(".scroll-content-item").filter(".active").next().click();});}
function define_actions(){actions={go_to_slide:function(){initial_slide_num=$('.scroll-content-item.active').children('.scroll-content-img-number').html();var go_to_slide=$(".go_to_slide").val();if($.isNumeric(go_to_slide)){if(go_to_slide>0&&go_to_slide<=number_of_total_slides){$(".scroll-content-item").eq(go_to_slide-1).click();}else{$(".go_to_slide").val(initial_slide_num);}}else{$(".go_to_slide").val(initial_slide_num);}}}}
function go_to_slide_func(){$(".go_to_slide").click(function(){go_to_slide_refresh=0;});$(".go_to_slide").focus(function(){go_to_slide_refresh=0;});$(".go_to_slide").select(function(){go_to_slide_refresh=0;});$(".go_to_slide").focusout(function(){go_to_slide_refresh=1;initial_slide_num=$('.scroll-content-item.active').children('.scroll-content-img-number').html();$(".go_to_slide").val(initial_slide_num);});$('.go_to_slide').bind('keyup',function(e){if(e.keyCode==13){actions.go_to_slide();go_to_slide_refresh=1;}else if(e.keyCode==27){go_to_slide_refresh=1;initial_slide_num=$('.scroll-content-item.active').children('.scroll-content-img-number').html();$(".go_to_slide").val(initial_slide_num);}else{go_to_slide_refresh=0;}});}
function getRootWebSitePath()
{var _location=document.location.toString();var applicationNameIndex=_location.indexOf('/',_location.indexOf('://')+3);var applicationName=_location.substring(0,applicationNameIndex)+'/';var webFolderIndex=_location.indexOf('/',_location.indexOf(applicationName)+applicationName.length);var webFolderFullPath=_location.substring(0,webFolderIndex);return webFolderFullPath;}
$(document).ready(function(){webRoot=getRootWebSitePath();presentation_file=webRoot+"/scheduler/service/presentation/";slides_file=webRoot+"/scheduler/service/slides/";load_menu_events();define_actions();go_to_slide_func();vid_lecture_id=window.location.search.replace("?id=","");presentation_file=presentation_file+vid_lecture_id;slides_file=slides_file+vid_lecture_id;$('#info_box_btn').click(function(){$.ajax({type:"GET",url:presentation_file,dataType:"xml",crossDomain:crossDomain_option,cache:false,success:function(xml_update_duration){$('#lecture_duration span').html($(xml_update_duration).find('duration').text());}});});read_parameters_XML();$(this).bind('contextmenu',function(e){return false;});});