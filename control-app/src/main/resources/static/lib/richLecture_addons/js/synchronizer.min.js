var crossDomain_option=false;var info,actions,pp;var global_vid_duration=-1;var timeline_width=0;var slides_counter=0;var time_now=0;var timeline_progress_bar_update_flag=1;var lock_flag=0;var go_to_time_refresh=1;var indicator_every_no_secs=900;var provider_type="";var video_url="";var basepath="";var number_of_total_slides=0;var width_of_presentation_of_synced_slides=0;cuepointsx=[];slide_at=[];seek_time=[];slide_order=[];var debug=0;var production_mode=1;var mode="edit";var edit_marker_on=0;var webRoot="";var presentation_file="";var slides_file="";var num_of_slides=0;var slides_loaded=0;function addToMarkerListSelection(begin_sec,title_on_load,next_to_div,div_order){div_txt='<div class="marker_selections" id="marker_selection_'+begin_sec+'"><\/div>';var active_slide_title_div;if(title_on_load!==null){title_on_load_tooltip=title_on_load;title_on_load=truncate(title_on_load,25,'...');active_slide_title_div='<div class="active_slide_title_div" id="active_slide_title_div_'+begin_sec+'" title="'+title_on_load_tooltip+'">'+title_on_load+'<\/div>';}else{title_on_load_tooltip=title_on_load;title_on_load=truncate($(".active img").attr("title"),25,'...');active_slide_title_div='<div class="active_slide_title_div" id="active_slide_title_div_'+begin_sec+'" title="'+title_on_load_tooltip+'">'+title_on_load+'<\/div>';}
var active_slide_time_div='<input type="text" id="active_slide_time_div_'+begin_sec+'" disabled value="'+secondsTimeSpanToHMS(begin_sec)+'" class="active_slide_time_div"><\/input>';button_for_edit='<button type="button" title="'+language.s1+'" id="edit_row_from_marker_list_'+begin_sec+'" class="edit_row_from_marker_list" onclick="actions.edit_slide_period('+begin_sec+',event)"></button>';button_for_goto='<button type="button" title="'+language.s2+'" id="goto_row_from_marker_list_'+begin_sec+'" class="goto_row_from_marker_list" onclick="actions.seek('+begin_sec+')"></button>';button_for_delete='<button type="button" title="'+language.s3+'" id="remove_row_from_marker_list_'+begin_sec+'" class="remove_row_from_marker_list" onclick="actions.remove_slide_period('+begin_sec+')"></button>';if(begin_sec>=global_vid_duration)
buttons_marker_div='<div class="buttons_marker_div">'+button_for_edit+'<button type="button" class="goto_row_from_marker_list_inactive"></button>'+button_for_delete+'<\/div>';else
buttons_marker_div='<div class="buttons_marker_div">'+button_for_edit+button_for_goto+button_for_delete+'<\/div>';if(div_order=='after'){$(div_txt).html(active_slide_title_div+active_slide_time_div+buttons_marker_div+'<div style="clear:both"><\/div>').hide().insertAfter($(next_to_div)).show('slow');}else if(div_order=='before'){$(div_txt).html(active_slide_title_div+active_slide_time_div+buttons_marker_div+'<div style="clear:both"><\/div>').hide().insertBefore($(next_to_div)).show('slow');}else{$(div_txt).html(active_slide_title_div+active_slide_time_div+buttons_marker_div+'<div style="clear:both"><\/div>').hide().appendTo($('#marker_list_content')).show('slow');}
$(".edit_row_from_marker_list").hover(function(){$(this).css('opacity',1);},function(){$(this).css('opacity',0.4);});$(".goto_row_from_marker_list").hover(function(){$(this).css('opacity',1);},function(){$(this).css('opacity',0.4);});$(".remove_row_from_marker_list").hover(function(){$(this).css('opacity',1);},function(){$(this).css('opacity',0.4);});if(begin_sec>=global_vid_duration){$('#marker_selection_'+begin_sec).addClass('marker_selection_outside');$("#marker_selection_"+begin_sec).mouseenter(function(){$(this).addClass("marker_selection_outside_highlight");});$("#marker_selection_"+begin_sec).mouseleave(function(){$(".marker_selections").removeClass("marker_selection_outside_highlight");});}else{$("#marker_selection_"+begin_sec).mouseenter(function(){timeline_bar_mention_start=Math.round(((begin_sec)/global_vid_duration)*timeline_width);if(cuepointsx.indexOf(begin_sec*1000)==cuepointsx.length-1||(cuepointsx.indexOf(begin_sec*1000)<cuepointsx.length-1&&cuepointsx[cuepointsx.indexOf(begin_sec*1000)+1]>=global_vid_duration*1000))
timeline_bar_mention_end=timeline_width;else
timeline_bar_mention_end=Math.round(((parseInt(cuepointsx[cuepointsx.indexOf(begin_sec*1000)+1]/1000))/global_vid_duration)*timeline_width);new_width=timeline_bar_mention_end-timeline_bar_mention_start;$(".marker_selections").removeClass("highlight_marker_row");$('.marked_area').width("2px");$('#timeline_bar_'+begin_sec).width(new_width+"px");$(this).addClass("highlight_marker_row");});$("#marker_selection_"+begin_sec).mouseleave(function(){$(".marker_selections").removeClass("highlight_marker_row");$('.marked_area').width("2px");});}}
function removeMarkerListSelection(begin_sec){$('#marker_selection_'+begin_sec).fadeOut('slow',function(){$(this).remove();});}
function addSlideOnTimelineBar(begin_sec){if(begin_sec>global_vid_duration)
return false;timeline_bar_start=Math.round(((begin_sec)/global_vid_duration)*timeline_width);if(begin_sec-5>0)
$('<div class="marked_area" id="timeline_bar_'+begin_sec+'" title="'+secondsTimeSpanToHMS(begin_sec)+'"><\/div>').animate({'left':timeline_bar_start+"px",'width':"2px"}).appendTo($('.timeline'));else
$('<div class="marked_area" id="timeline_bar_'+begin_sec+'" title="'+secondsTimeSpanToHMS(begin_sec)+'"><\/div>').animate({'left':timeline_bar_start+"px",'width':"2px"}).appendTo($('.timeline'));}
function removeSlideOnTimelineBar(begin_sec){if(begin_sec>global_vid_duration)
return false;$('#timeline_bar_'+begin_sec).hide('slow',function(){$(this).remove();});}
function read_slides_XML(){var increament=0;$.ajax({type:"GET",url:slides_file,dataType:"xml",crossDomain:crossDomain_option,cache:false,success:function(xml){basepath=$(xml).find('basepath').text();$(xml).find('slide').each(function(){var url=$(this).find('url').text();url=basepath+url;var last_slash_pos=url.lastIndexOf('/');url_for_scroll_bar=url.substr(0,last_slash_pos+1)+"small/"+url.substr(last_slash_pos+1);var time=$(this).find('time').text();var slide_title=$(this).find('title').text();if(!slide_title.length)
slide_title=language.s4;$('<div class="scroll-content-item"><\/div>').html('<img src="'+url_for_scroll_bar+'" title="'+(increament+1)+' '+slide_title+'" ><div class="scroll-content-img-number">'+(increament+1)+'<\/div>').appendTo($('.scroll-content'));slide_order[increament]=url;times=time.split(',');for(times_iteration=0;times_iteration<times.length;times_iteration++){time=convert_hh_mm_ss_format(times[times_iteration]);if(time!=-1){cuepointsx.push(time*1000);if(seek_time[url]>=0){if(seek_time[url]>time*1000){seek_time[url]=time*1000;}}else
seek_time[url]=time*1000;slide_at[time*1000]=url;min_diff=36000000;min_diff_index=-1;time_to_inverstigate=time*1000;for(i=0;i<cuepointsx.length;i++){cut_diff=Math.abs(time_to_inverstigate-cuepointsx[i]);if(cut_diff>0&&cut_diff<min_diff){min_diff=cut_diff;min_diff_index=i;if(time_to_inverstigate>cuepointsx[i])
min_diff_order='after';else
min_diff_order='before';}}
if(min_diff_index>=0)
addToMarkerListSelection(time,(increament+1)+' '+slide_title,'#marker_selection_'+parseInt(cuepointsx[min_diff_index]/1000,10),min_diff_order);else
addToMarkerListSelection(time,(increament+1)+' '+slide_title);addSlideOnTimelineBar(time);cuepointsx=cuepointsx.sort(function(a,b){return a-b;});$('.scroll-content-img-number:eq('+increament+')').addClass("slide_synced");pp.getClip(0).onCuepoint(time*1000,function(clip,point){if(cuepointsx.indexOf(point)!==-1&&mode=="preview"){if(debug)info.innerHTML="onCuepoint: "+point;var url=slide_at[point];var wrap=$("#active_slide img");wrap.css("opacity",0.3);wrap.attr("src",url).fadeTo("normal",1);slide_to_be_loaded=slide_order.indexOf(url);set_active_img($(".scroll-content-item img:eq("+slide_to_be_loaded+")"));}});}}
increament++;num_of_slides++;});width_of_presentation_of_synced_slides=$(".presentation_of_work_done").width()+parseInt($(".presentation_of_work_done").css("paddingLeft"),10)+parseInt($(".presentation_of_work_done").css("paddingRight"),10);;number_of_total_slides=increament;$(".number_of_total_slides").html(number_of_total_slides);refresh_presentation_of_synced_slides();var img_div;img_div=$(".scroll-content-item");total_img_width=img_div.width();total_img_width+=parseInt(img_div.css("paddingLeft"),10)+parseInt(img_div.css("paddingRight"),10);total_img_width+=parseInt(img_div.css("marginLeft"),10)+parseInt(img_div.css("marginRight"),10);scroll_area_img_width=total_img_width*num_of_slides;scroll_area_img_width+=4;$(".scroll-content").css("width",scroll_area_img_width+"px");if(debug)
info.innerHTML="Scroll are for thumbenails has width "+scroll_area_img_width+"px";$(".scroll-content-item img").click(function(){var url=$(this).attr("src");url=url.replace("small/","");if(edit_marker_on==0){if(mode=="edit"){var wrap=$("#active_slide img");wrap.css("opacity",0.3);wrap.attr("src",url).fadeTo("normal",1);slide_to_be_loaded=$(".scroll-content-item img").index(this);set_active_img($(this));}else{if($.inArray(url,slide_at)>=0){slide_to_be_loaded=$(".scroll-content-item img").index(this);set_active_img($(this));var current_slide=$(this).attr("src");current_slide=current_slide.replace("small/","");var new_time=seek_time[current_slide]/1000.0;pp.seek(new_time);}}}}).filter(":first").click();$(".scroll-content-item img").dblclick(function(){var url=$(this).attr("src");url=url.replace("small/","");if(edit_marker_on==0&&mode=="edit"){var wrap=$("#active_slide img");wrap.css("opacity",0.3);wrap.attr("src",url).fadeTo("normal",1);slide_to_be_loaded=$(".scroll-content-item img").index(this);set_active_img($(this));actions.synchronize();}});slides_loaded=1;}});}
function refresh_presentation_of_synced_slides(){setTimeout(function(){num_of_syncs=$(".slide_synced").size();$(".number_of_synced_slides").html(num_of_syncs);var width_bar_of_synced_slides=parseInt((num_of_syncs/number_of_total_slides)*width_of_presentation_of_synced_slides,10);$(".presentation_of_work_done_background").width(width_bar_of_synced_slides);num_of_syncs_outside_vid=$(".marker_selection_outside").size();if(num_of_syncs_outside_vid>0)
$(".number_of_synced_slides_outside_vid").html('(<img src="'+webRoot+'/resources/richLecture_addons/css/images_synchronizer/AttentionIcon.png'+'" class="outside_slides_attention_mark"></img>'+num_of_syncs_outside_vid+')');else
$(".number_of_synced_slides_outside_vid").html('');},1000);}
function truncate(str,maxLength,suffix)
{if(str.length>maxLength)
{str=str.substring(0,maxLength+1);str=str.substring(0,Math.min(str.length,str.lastIndexOf(" ")));str=str+suffix;}
return str;}
function reformat_date(date_original){var date_splited=date_original.split("-");return(date_splited[2]+'-'+date_splited[1]+'-'+date_splited[0]);}
function read_parameters_XML(){$(".scroll-region").hide();$.ajax({type:"GET",url:presentation_file,dataType:"xml",crossDomain:crossDomain_option,cache:false,success:function(xml){logo=$(xml).find('logo').text();title=$(xml).find('title:first').text();$(document).attr('title',title);title=truncate(title,55,'...');date_txt=reformat_date($(xml).find('date').text());provider_type=$(xml).find('provider').text();video_url=$(xml).find('resource[format=MP4]').text();global_vid_duration=convert_hh_mm_ss_format($(xml).find('duration').text());$('<div class="header-item"><\/div>').html(title+' | '+date_txt).prependTo($('.header'));$('<div class="header-logo-item-separator"><\/div>').prependTo($('.header'));$('<div class="header-logo"><img src="'+logo+'"><\/img><\/div>').prependTo($('.header'));},complete:function(){load_player();timeline_progress_bar();read_slides_XML();var refreshIntervalIdEverythingReady=setInterval(function(){if(slides_loaded==1){clearInterval(refreshIntervalIdEverythingReady);$(".scroll-region").show();$("#dvLoading").hide();}},200);}});}
function load_player(){pp=$f("player_synchronizer",{src:webRoot+"/resources/richLecture_addons/js/ext_js/flowplayer/flowplayer-3.2.16.swf",wmode:"opaque"},{plugins:{audio:{url:webRoot+'/resources/richLecture_addons/js/ext_js/flowplayer/flowplayer.audio-3.2.11.swf'},pseudo:{url:webRoot+'/resources/richLecture_addons/js/ext_js/flowplayer/flowplayer.pseudostreaming-3.2.12.swf'},controls:null},clip:{coverImage:{url:webRoot+"/resources/richLecture_addons/css/images_synchronizer/AudioOnly.jpg",scaling:'fit'},autoPlay:false,autoBuffering:true,provider:provider_type,url:video_url,scaling:'fit',onStart:function(){$('.player_play').css('background','url('+webRoot+'/resources/richLecture_addons/css/images_synchronizer/pause-large.png) no-repeat');draggable_bar();},onPause:function(clip){$('.player_play').css('background','url('+webRoot+'/resources/richLecture_addons/css/images_synchronizer/play-large.png) no-repeat');if(debug)
info.innerHTML="player paused at "+Math.round(this.getTime());},onSeek:function(){if(mode=="preview"){curr_time=Math.round(this.getTime())*1000;curr_time+=1;if(debug)info.innerHTML="onSeek"+curr_time;total_num_of_slides=cuepointsx.length;for(var i=0;i<total_num_of_slides;i++){if(curr_time>=cuepointsx[total_num_of_slides-1]){slide_to_be_loaded=slide_order.indexOf(slide_at[cuepointsx[total_num_of_slides-1]]);break;}else if(cuepointsx[i]<=curr_time&&curr_time<cuepointsx[i+1]){slide_to_be_loaded=slide_order.indexOf(slide_at[cuepointsx[i]]);break;}}
if(debug)
info.innerHTML="onSeek: "+" current time at "+Math.round(this.getTime())+" slide "+slide_to_be_loaded+" "+slide_order[slide_to_be_loaded];var url=slide_order[slide_to_be_loaded];var wrap=$("#active_slide img");wrap.css("opacity",0.3);wrap.attr("src",url).fadeTo("normal",1);set_active_img($(".scroll-content-item img:eq("+slide_to_be_loaded+")"));}},onResume:function(){$('.player_play').css('background','url('+webRoot+'/resources/richLecture_addons/css/images_synchronizer/pause-large.png) no-repeat');if(debug)info.innerHTML="player resumed";}},onLoad:function(){if(debug)info.innerHTML="player loaded";},onVolume:function(level){if(debug)info.innerHTML="volume level is: "+Math.round(level);},onFinish:function(){$('.player_play').css('background','url('+webRoot+'/resources/richLecture_addons/css/images_synchronizer/play-large.png) no-repeat');if(debug)info.innerHTML='player unloaded upon onFinish()';}});}
function scroll(){$(".scroll-fwd").on("click",function(){var go_slider_to;var move_width=parseInt($('.scroll-pane').width()/total_img_width,10);move_width*=total_img_width;var curr_scroll_position=$('.scroll-pane').scrollLeft();go_slider_to=curr_scroll_position+move_width;$(".scroll-pane").stop();$(".scroll-pane").animate({scrollLeft:go_slider_to});});$(".scroll-bwd").on("click",function(){var go_slider_to;var move_width=parseInt($('.scroll-pane').width()/total_img_width,10);move_width*=total_img_width;var curr_scroll_position=$('.scroll-pane').scrollLeft();go_slider_to=curr_scroll_position-move_width;$(".scroll-pane").stop();$(".scroll-pane").animate({scrollLeft:go_slider_to});});}
function set_active_img(img){var go_slider_to=(slide_to_be_loaded*total_img_width)-total_img_width;$(".scroll-content-item").removeClass("active");$(img).parent().addClass("active");setTimeout(function(){$(".scroll-pane").animate({scrollLeft:go_slider_to});},500);}
function define_actions(){actions={mute:function(){if(pp.getStatus().muted){$('.player_mute').css('background','url('+webRoot+'/resources/richLecture_addons/css/images_synchronizer/unmute-large.png) no-repeat');pp.unmute();pp.setVolume(50);}else{$('.player_mute').css('background','url('+webRoot+'/resources/richLecture_addons/css/images_synchronizer/mute-large.png) no-repeat');pp.mute();}},voldown:function(){curr_vol=pp.getVolume();if(curr_vol-10<=0){pp.setVolume(0);}else
pp.setVolume(curr_vol-10);},volup:function(){curr_vol=pp.getVolume();if(curr_vol+10>100)
pp.setVolume(100);else
pp.setVolume(curr_vol+10);},play:function(){if(pp.toggle()){$('.player_play').css('background','url('+webRoot+'/resources/richLecture_addons/css/images_synchronizer/pause-large.png) no-repeat');}else{$('.player_play').css('background','url('+webRoot+'/resources/richLecture_addons/css/images_synchronizer/play-large.png) no-repeat');}},stop:function(){pp.stop();$('.player_play').css('background','url('+webRoot+'/resources/richLecture_addons/css/images_synchronizer/play-large.png) no-repeat');},seek:function(second){if(mode=="edit"){var url=slide_at[second*1000];slide_to_be_loaded=slide_order.indexOf(url);$(".scroll-content-item img:eq("+slide_to_be_loaded+")").click();}
if(second-5>0)
pp.seek(second-5);else
pp.seek(second);},go_to_time:function(){var go_to_time=$(".go_to_field").val();var go_to_time_sec=convert_hh_mm_ss_format(go_to_time);var broken_time=go_to_time.split(':');if(go_to_time.length==8&&go_to_time_sec<global_vid_duration&&broken_time.length==3)
if(broken_time[0].length==2&&broken_time[1].length==2&&broken_time[2].length==2&&$.isNumeric(broken_time[0])&&$.isNumeric(broken_time[1])&&$.isNumeric(broken_time[2]))
if(broken_time[0]<60&&broken_time[1]<60&&broken_time[2]<60)
pp.seek(go_to_time_sec);},synchronize:function(begin_sec){var new_sync_based_on_video_time=0;if(begin_sec==null){begin_sec=Math.round(pp.getTime());new_sync_based_on_video_time=1;}
time_to_inverstigate=begin_sec*1000;if(cuepointsx.indexOf(begin_sec*1000)!=-1){alert(language.s5);return false;}
var value_on_slide_order_array=$('.active .scroll-content-img-number').html()-1;var active_slide_url=slide_order[value_on_slide_order_array];cuepointsx.push(begin_sec*1000);if(seek_time[active_slide_url]>=0&&seek_time[active_slide_url]!=null){if(seek_time[active_slide_url]>begin_sec*1000){seek_time[active_slide_url]=begin_sec*1000;}}else
seek_time[active_slide_url]=begin_sec*1000;slide_at[begin_sec*1000]=active_slide_url;cuepointsx=cuepointsx.sort(function(a,b){return a-b;});updated_index_time_to_investigate=cuepointsx.indexOf(time_to_inverstigate);if(cuepointsx.length>=updated_index_time_to_investigate+1){if(slide_at[cuepointsx[updated_index_time_to_investigate]]==slide_at[cuepointsx[updated_index_time_to_investigate+1]]){actions.remove_slide_period(parseInt(cuepointsx[updated_index_time_to_investigate+1]/1000));}}
if(updated_index_time_to_investigate-1>=0){if(slide_at[cuepointsx[updated_index_time_to_investigate]]==slide_at[cuepointsx[updated_index_time_to_investigate-1]]){cuepointsx.splice(updated_index_time_to_investigate,1);slide_at[time_to_inverstigate]=null;return false;}}
min_diff=36000000;min_diff_index=-1;for(i=0;i<cuepointsx.length;i++){cut_diff=Math.abs(time_to_inverstigate-cuepointsx[i]);if(cut_diff>0&&cut_diff<min_diff){min_diff=cut_diff;min_diff_index=i;if(time_to_inverstigate>cuepointsx[i])
min_diff_order='after';else
min_diff_order='before';}}
if(min_diff_index>=0)
addToMarkerListSelection(begin_sec,null,'#marker_selection_'+parseInt(cuepointsx[min_diff_index]/1000,10),min_diff_order);else
addToMarkerListSelection(begin_sec,null);$("#marker_list_content").stop();if($("#marker_selection_"+begin_sec).offset().top>$("#marker_list_content").offset().top+$("#marker_list_content").scrollTop()&&new_sync_based_on_video_time==0){$("#marker_list_content").animate({scrollTop:$("#marker_selection_"+begin_sec).offset().top-$("#marker_list_content").offset().top+$("#marker_list_content").scrollTop()-23});}else{$("#marker_list_content").animate({scrollTop:$("#marker_selection_"+begin_sec).offset().top-$("#marker_list_content").offset().top+$("#marker_list_content").scrollTop()});}
addSlideOnTimelineBar(begin_sec);$('.scroll-content-img-number:eq('+value_on_slide_order_array+')').addClass("slide_synced");pp.getClip(0).onCuepoint(begin_sec*1000,function(clip,point){if(cuepointsx.indexOf(point)!==-1&&mode=="preview"){if(debug)info.innerHTML="onCuepoint: "+point;var url=slide_at[point];var wrap=$("#active_slide img");wrap.css("opacity",0.3);wrap.attr("src",url).fadeTo("normal",1);slide_to_be_loaded=slide_order.indexOf(url);set_active_img($(".scroll-content-item img:eq("+slide_to_be_loaded+")"));}});refresh_presentation_of_synced_slides();$(".save_btn").prop('disabled',false);$(".save_btn").css('opacity','1');},synchronize_and_go:function(){var sync_failed=actions.synchronize();var value_on_slide_order_array=$('.active .scroll-content-img-number').html();if(slide_order.length>value_on_slide_order_array&&sync_failed!=false){$('.scroll-content-img-number:eq('+value_on_slide_order_array+')').parent().find("img").click();}},go_to_unsynced_slide:function(){$(".scroll-content-img-number:not(.slide_synced):first").parent().find("img").click();},edit_slide_period:function(second,event_sh){if(mode=="edit"){var url=slide_at[second*1000];slide_to_be_loaded=slide_order.indexOf(url);$(".scroll-content-item img:eq("+slide_to_be_loaded+")").click();}
if(event_sh.shiftKey){pp.pause();$('#slide_selected_for_shifting').html($(".scroll-content-item img:eq("+slide_to_be_loaded+")").parent().find("div").html());var time_bf_popup_shift=Math.round(pp.getTime());var initial_diff_edit_time=time_bf_popup_shift-second;$('#shift_time_diff').val(initial_diff_edit_time);$('#shift_time_start').val(secondsTimeSpanToHMS(time_bf_popup_shift));$('#shift_time_diff').on('change input keyup propertychange',function(){if($.isNumeric($(this).val())&&parseInt(second+parseInt($(this).val(),10),10)>=0&&parseInt(second+parseInt($(this).val(),10),10)<global_vid_duration){$(this).removeClass('shift_time_validation');$('#shift_time_start').removeClass('shift_time_validation');$('#shift_time_start').val(secondsTimeSpanToHMS(parseInt(second+parseInt($(this).val(),10),10)));$("#shift_attention").hide();if($('#shift_time_diff').val()<0){for(var i=0;i<cuepointsx.length;i++){if(cuepointsx[i]>=parseInt(second,10)*1000)
break;if(cuepointsx[i]>=(parseInt(second+parseInt($(this).val(),10),10))*1000&&cuepointsx[i]<parseInt(second,10)*1000){$("#shift_attention").show();}}}}else{$(this).addClass('shift_time_validation');$('#shift_time_start').addClass('shift_time_validation');$('#shift_time_start').val('~');$("#shift_attention").hide();}});$('#shift_time_start').on('change input keyup propertychange',function(){var broken_shift_start_time_original=$(this).val();var broken_shift_start_time=$(this).val().split(':');if(broken_shift_start_time_original.length==8&&broken_shift_start_time.length==3&&convert_hh_mm_ss_format(broken_shift_start_time_original)>=0&&convert_hh_mm_ss_format(broken_shift_start_time_original)<global_vid_duration&&broken_shift_start_time[0].length==2&&broken_shift_start_time[1].length==2&&broken_shift_start_time[2].length==2&&$.isNumeric(broken_shift_start_time[0])&&$.isNumeric(broken_shift_start_time[1])&&$.isNumeric(broken_shift_start_time[2])&&broken_shift_start_time[0]<60&&broken_shift_start_time[1]<60&&broken_shift_start_time[2]<60){$(this).removeClass('shift_time_validation');$('#shift_time_diff').removeClass('shift_time_validation');$('#shift_time_diff').val(parseInt(convert_hh_mm_ss_format($(this).val())-second,10));$("#shift_attention").hide();if($('#shift_time_diff').val()<0){for(var i=0;i<cuepointsx.length;i++){if(cuepointsx[i]>=parseInt(second,10)*1000)
break;if(cuepointsx[i]>=(parseInt(second+parseInt($('#shift_time_diff').val(),10),10))*1000&&cuepointsx[i]<parseInt(second,10)*1000){$("#shift_attention").show();}}}}else{$(this).addClass('shift_time_validation');$('#shift_time_diff').addClass('shift_time_validation');$('#shift_time_diff').val('~');$("#shift_attention").hide();}});$("#shift_slides").dialog({autoOpen:false,height:200,width:700,resizable:false,modal:true,resizable:false,draggable:true,position:{my:"center",at:"top+200",of:window},buttons:[{text:language.s8,click:function(){var save_shift_time_diff=$('#shift_time_diff').val();var save_shift_time_start=$('#shift_time_start').val();if(save_shift_time_diff=='~'||save_shift_time_start=='~'){alert(language.s10);return false;}else if(save_shift_time_diff==0){$(this).dialog("close");return false;}else if(save_shift_time_diff<0){for(var i=0;i<cuepointsx.length;i++){if(cuepointsx[i]>=parseInt(second,10)*1000)
break;if(cuepointsx[i]>=(parseInt(parseInt(second,10)+parseInt(save_shift_time_diff,10),10))*1000&&cuepointsx[i]<parseInt(second,10)*1000){actions.remove_slide_period(cuepointsx[i]/1000);i--;}}}
var rows_to_shift=[];var rows_to_shift_url=[];rows_to_shift.push(second);rows_to_shift_url.push(slide_order.indexOf(slide_at[second*1000]));$("#marker_selection_"+second).nextAll(".marker_selections").each(function(){var row_to_shift_tmp=parseInt($(this).attr('id').replace('marker_selection_',''),10);rows_to_shift.push(row_to_shift_tmp);rows_to_shift_url.push(slide_order.indexOf(slide_at[row_to_shift_tmp*1000]));});actions.remove_slide_period(second);$("#marker_selection_"+second).nextAll(".marker_selections").each(function(){var row_to_shift_tmp=parseInt($(this).attr('id').replace('marker_selection_',''),10);actions.remove_slide_period(row_to_shift_tmp);});for(var i=rows_to_shift.length-1;i>=0;i--){$(".scroll-content-item").removeClass("active");$(".scroll-content-item img:eq("+rows_to_shift_url[i]+")").parent().addClass("active");actions.synchronize(parseInt(rows_to_shift[i],10)+parseInt(save_shift_time_diff,10));}
$(".scroll-content-item").removeClass("active");$(".scroll-content-item img:eq("+rows_to_shift_url[0]+")").parent().addClass("active");$(this).dialog("close");}},{text:language.s9,click:function(){$(this).dialog("close");}}],close:function(){$(this).dialog("close");}});$("#shift_slides").dialog("open");return false;}
edit_marker_on=1;var initial_state_of_save_btn=$(".save_btn").prop('disabled');var initial_opacity_of_save_btn=$(".save_btn").css('opacity');$(".save_btn").prop('disabled',true);$(".save_btn").css('opacity','0.5');$("button").prop('disabled',true);$("button").css('opacity','0.2');$('#active_slide_time_div_'+second).prop('disabled',false);$('#active_slide_time_div_'+second).addClass('borderEditTime');$('#active_slide_time_div_'+second).focus();var initial_edit_time_hms=$('#active_slide_time_div_'+second).val();var initial_edit_time=convert_hh_mm_ss_format(initial_edit_time_hms);$('#active_slide_time_div_'+second).bind('keyup',function(e){if(e.keyCode==13){var save_edit_time=$('#active_slide_time_div_'+second).val();var new_edit_time_sec=convert_hh_mm_ss_format(save_edit_time);var broken_time=save_edit_time.split(':');if(initial_edit_time!=new_edit_time_sec){if(save_edit_time.length==8&&new_edit_time_sec<global_vid_duration&&broken_time.length==3){if(broken_time[0].length==2&&broken_time[1].length==2&&broken_time[2].length==2&&$.isNumeric(broken_time[0])&&$.isNumeric(broken_time[1])&&$.isNumeric(broken_time[2])){if(broken_time[0]<60&&broken_time[1]<60&&broken_time[2]<60){if(cuepointsx.indexOf(new_edit_time_sec*1000)>=0){alert(language.s5);$('#active_slide_time_div_'+second).val(initial_edit_time_hms);}else{actions.remove_slide_period(second);actions.synchronize(new_edit_time_sec);refresh_presentation_of_synced_slides();edit_marker_on=0;$('#active_slide_time_div_'+second).removeClass('borderEditTime');$("button").prop('disabled',false);$("button").css('opacity','0.4');$(".go_to_unsynced_slide").prop('disabled',false);$(".go_to_unsynced_slide").css('opacity','1');$(".sync_button").prop('disabled',false);$(".sync_button").css('opacity','1');$(".sync_and_go_button").prop('disabled',false);$(".sync_and_go_button").css('opacity','1');$(".edit_mode_btn").css('opacity','1');$(".preview_mode_btn").css('opacity','1');$(".save_btn").prop('disabled',false);$(".save_btn").css('opacity','1');$('#active_slide_time_div_'+second).unbind('keyup');return false;}}else
$('#active_slide_time_div_'+second).val(initial_edit_time_hms);}else
$('#active_slide_time_div_'+second).val(initial_edit_time_hms);}else
$('#active_slide_time_div_'+second).val(initial_edit_time_hms);}else
$('#active_slide_time_div_'+second).val(initial_edit_time_hms);$('#active_slide_time_div_'+second).prop('disabled',true);$('#active_slide_time_div_'+second).removeClass('borderEditTime');edit_marker_on=0;$("button").prop('disabled',false);$("button").css('opacity','0.4');$(".go_to_unsynced_slide").prop('disabled',false);$(".go_to_unsynced_slide").css('opacity','1');$(".sync_button").prop('disabled',false);$(".sync_button").css('opacity','1');$(".sync_and_go_button").prop('disabled',false);$(".sync_and_go_button").css('opacity','1');$(".edit_mode_btn").css('opacity','1');$(".preview_mode_btn").css('opacity','1');$(".save_btn").prop('disabled',initial_state_of_save_btn);$(".save_btn").css('opacity',initial_opacity_of_save_btn);$('#active_slide_time_div_'+second).unbind('keyup');}else if(e.keyCode==27){$('#active_slide_time_div_'+second).val(initial_edit_time_hms);$('#active_slide_time_div_'+second).prop('disabled',true);$('#active_slide_time_div_'+second).removeClass('borderEditTime');edit_marker_on=0;$("button").prop('disabled',false);$("button").css('opacity','0.4');$(".go_to_unsynced_slide").prop('disabled',false);$(".go_to_unsynced_slide").css('opacity','1');$(".sync_button").prop('disabled',false);$(".sync_button").css('opacity','1');$(".sync_and_go_button").prop('disabled',false);$(".sync_and_go_button").css('opacity','1');$(".edit_mode_btn").css('opacity','1');$(".preview_mode_btn").css('opacity','1');$(".save_btn").prop('disabled',initial_state_of_save_btn);$(".save_btn").css('opacity',initial_opacity_of_save_btn);$('#active_slide_time_div_'+second).unbind('keyup');}});},remove_slide_period:function(second){second*=1000;cuepointsx_second_index=cuepointsx.indexOf(second);if(cuepointsx_second_index==-1)return false;cuepointsx.splice(cuepointsx_second_index,1);var url=slide_at[second];var index_of_slide_order=slide_order.indexOf(url);slide_at[second]=null;if(seek_time[url]==second){if(cuepointsx_second_index==cuepointsx.length)
seek_time[url]=null;else{for(i=cuepointsx_second_index;i<cuepointsx.length;i++){if(url==slide_at[cuepointsx[i]]){seek_time[url]=cuepointsx[i];break;}else
seek_time[url]=null;}}}
removeMarkerListSelection(parseInt(second/1000,10));removeSlideOnTimelineBar(parseInt(second/1000,10));if(seek_time[url]==null)
$('.scroll-content-img-number:eq('+index_of_slide_order+')').removeClass("slide_synced");if(cuepointsx_second_index>0&&cuepointsx_second_index<cuepointsx.length){if(slide_at[cuepointsx[cuepointsx_second_index]]==slide_at[cuepointsx[cuepointsx_second_index-1]]){actions.remove_slide_period(parseInt(cuepointsx[cuepointsx_second_index]/1000,10));}}
refresh_presentation_of_synced_slides();$(".save_btn").prop('disabled',false);$(".save_btn").css('opacity','1');},activate_preview_mode:function(){actions.seek(Math.round(pp.getTime()));pp.resume();$(".preview_mode_btn").prop('disabled',true);$(".preview_mode_btn").addClass('preview_mode_on');$(".edit_mode_btn").prop('disabled',false);$(".edit_mode_btn").removeClass('edit_mode_on');$(".go_to_unsynced_slide").prop('disabled',true);$(".go_to_unsynced_slide").css('opacity','0.5');$(".sync_button").prop('disabled',true);$(".sync_button").css('opacity','0.2');$(".sync_and_go_button").prop('disabled',true);$(".sync_and_go_button").css('opacity','0.2');$(".edit_row_from_marker_list").prop('disabled',true);$(".edit_row_from_marker_list").css('opacity','0.2');$(".remove_row_from_marker_list").prop('disabled',true);$(".remove_row_from_marker_list").css('opacity','0.2');mode="preview";},activate_edit_mode:function(){$(".preview_mode_btn").prop('disabled',false);$(".preview_mode_btn").removeClass('preview_mode_on');$(".edit_mode_btn").prop('disabled',true);$(".edit_mode_btn").addClass('edit_mode_on');$(".go_to_unsynced_slide").prop('disabled',false);$(".go_to_unsynced_slide").css('opacity','1');$(".sync_button").prop('disabled',false);$(".sync_button").css('opacity','1');$(".sync_and_go_button").prop('disabled',false);$(".sync_and_go_button").css('opacity','1');$(".edit_row_from_marker_list").prop('disabled',false);$(".edit_row_from_marker_list").css('opacity','0.4');$(".remove_row_from_marker_list").prop('disabled',false);$(".remove_row_from_marker_list").css('opacity','0.4');mode="edit";},fast_seek:function(direction){time_now=Math.round(pp.getTime());if(direction=='fwd'){if(time_now+5>=global_vid_duration)
pp.seek(global_vid_duration);else
pp.seek(time_now+5);}else{if(time_now-5<=0)
pp.seek(0);else
pp.seek(time_now-5);}},send_json:function(){var urls_array=[];var times_array=[];for(i=0;i<slide_order.length;i++){flag_slide_no_found=0;for(j=0;j<cuepointsx.length;j++){cuepointsx_time_save=cuepointsx[j];if(slide_order[i]==slide_at[cuepointsx_time_save]){urls_array.push(slide_order[i]);times_array.push(secondsTimeSpanToHMS(parseInt(cuepointsx_time_save/1000,10)));flag_slide_no_found=1;}}
if(flag_slide_no_found==0){urls_array.push(slide_order[i]);times_array.push(-1);}}
for(i=0;i<urls_array.length;i++){urls_array[i]=urls_array[i].replace(basepath,'');}
for(i=0;i<urls_array.length-1;i++){if(urls_array[i]==urls_array[i+1]){times_array[i]=times_array[i]+','+times_array[i+1];urls_array.splice(i+1,1);times_array.splice(i+1,1);i--;}}
urls_json=JSON.stringify({urls:urls_array});times_json=JSON.stringify({times:times_array});initial_duration_json=JSON.stringify({initial_duration:secondsTimeSpanToHMS(global_vid_duration)});total_json=urls_json.concat(times_json);total_json=total_json.replace('}{',',');total_json=total_json.concat(initial_duration_json);total_json=total_json.replace('}{',',');if(production_mode==0){console.log(total_json);$(".save_btn").prop('disabled',true);$(".save_btn").css('opacity','0.5');}else{$(".save_btn").prop('disabled',true);$(".save_btn").css('opacity','0.5');$.ajax({url:slides_file,type:"POST",contentType:"application/json; charset=utf-8",dataType:"html",crossDomain:crossDomain_option,data:total_json,cache:false,processData:false,success:function(res){if(res!=1){if(res==4)
alert(language.s14);else if(res==5)
alert(language.s15);else if(res==2)
alert(language.s11);else if(res==3)
alert(language.s12);else if(res==23)
alert(language.s13);else
alert(language.s6);$(".save_btn").prop('disabled',false);$(".save_btn").css('opacity','1');}else{$(".save_btn").prop('disabled',true);$(".save_btn").css('opacity','0.5');}},error:function(){alert(language.s6);$(".save_btn").prop('disabled',false);$(".save_btn").css('opacity','1');}});}},zoom_active_slide:function(){$('.enlarged_active_slide').html('<div class="b-close">Close<\/div>');active_slide_src=$('#active_slide img').attr('src');$('.enlarged_active_slide').bPopup({content:'image',contentContainer:'.enlarged_active_slide',loadUrl:active_slide_src,closeClass:'.b-close'});}}}
function convert_hh_mm_ss_format(input_time){var _input_time;var ms_time = input_time.split('.');if (ms_time.length == 1) _input_time = input_time;else _input_time=ms_time[0];var broken_time=_input_time.split(':');var hours=0;var minutes=0;var seconds=0;if(broken_time.length==1)seconds=parseFloat(broken_time[0]);if(broken_time.length==2){minutes=parseFloat(broken_time[0]);seconds=parseFloat(broken_time[1]);}
if(broken_time.length==3){hours=parseFloat(broken_time[0]);minutes=parseFloat(broken_time[1]);seconds=parseFloat(broken_time[2]);}
return Math.round(seconds+60*minutes+3600*hours);}
function secondsTimeSpanToHMS(s){var h=Math.floor(s/3600);s-=h*3600;var m=Math.floor(s/60);s-=m*60;return(h<10?'0'+h:h)+":"+(m<10?'0'+m:m)+":"+(s<10?'0'+s:s);}
function secondsTimeSpanToHM(s){var h=Math.floor(s/3600);s-=h*3600;var m=Math.floor(s/60);s-=m*60;return(h+'h')+(m+'m')+((s>0)?(s+'s'):'');}
function timeline_progress_bar(){var quarter_period=parseInt(global_vid_duration/indicator_every_no_secs);var minute_period=parseInt(global_vid_duration/60);for(i=0;i<=minute_period;i++){left_pos=Math.round((i*60/global_vid_duration)*timeline_width);if(i%5)
$('<div class="minute_period"><\/div>').css({'left':+left_pos+'px'}).appendTo($('.timeline'));else
$('<div class="five_minute_period"><\/div>').css({'left':+left_pos+'px'}).appendTo($('.timeline'));}
for(i=0;i<=quarter_period;i++){left_pos=Math.round((i*indicator_every_no_secs/global_vid_duration)*timeline_width);$('<div class="quarter_period"><\/div>').html('<div class="quarter_period_time">'+secondsTimeSpanToHMS(i*indicator_every_no_secs)+'<\/div>').css({'left':+left_pos+'px'}).appendTo($('.timeline'));if(i==quarter_period&&(timeline_width-left_pos)<60){$(".quarter_period_time").html('');}}
$('<div class="quarter_period"><\/div>').html('<div class="quarter_period_time">'+secondsTimeSpanToHMS(global_vid_duration)+'<\/div>').css({'left':+(timeline_width-1)+'px'}).appendTo($('.timeline'));setInterval(function(){if(timeline_progress_bar_update_flag==1){lock_flag=1;time_now=pp.getTime();position_on_timeline_bar=Math.round((time_now/global_vid_duration)*timeline_width);$(".timeline_progress_position_time").html(secondsTimeSpanToHMS(Math.round(time_now)));$(".timeline_progress_position").animate({'left':position_on_timeline_bar+"px"},{duration:100,queue:false});if(go_to_time_refresh==1){$(".go_to_field").val(secondsTimeSpanToHMS(Math.round(time_now)));}
setTimeout(function(){return false;},100);lock_flag=0;}},1000);}
function draggable_bar(){$('.timeline_progress_position').draggable({axis:"x",containment:'parent',start:function(){while(lock_flag==1){setTimeout(function(){return false;},100);};timeline_progress_bar_update_flag=0;},stop:function(){var cursor_pos=$(this).css('left');cursor_pos=cursor_pos.substring(0,cursor_pos.length-2);cursor_sec=Math.round((cursor_pos/timeline_width)*global_vid_duration);pp.seek(cursor_sec);timeline_progress_bar_update_flag=1;},drag:function(){var cursor_pos=$(this).css('left');cursor_pos=Math.round(cursor_pos.substring(0,cursor_pos.length-2));cursor_sec=Math.round((cursor_pos/timeline_width)*global_vid_duration);$(".timeline_progress_position_time").html(secondsTimeSpanToHMS(Math.round(cursor_sec)));$(".go_to_field").val(secondsTimeSpanToHMS(Math.round(cursor_sec)));}});}
function go_to_field_func(){$(".go_to_field").click(function(){go_to_time_refresh=0;});$(".go_to_field").focus(function(){go_to_time_refresh=0;});$(".go_to_field").select(function(){go_to_time_refresh=0;});$(".go_to_field").focusout(function(){go_to_time_refresh=1;});$('.go_to_field').bind('keyup',function(e){if(e.keyCode==13){actions.go_to_time();go_to_time_refresh=1;}else if(e.keyCode==27){go_to_time_refresh=1;}else{go_to_time_refresh=0;}});}
function getRootWebSitePath()
{var _location=document.location.toString();var applicationNameIndex=_location.indexOf('/',_location.indexOf('://')+3);var applicationName=_location.substring(0,applicationNameIndex)+'/';var webFolderIndex=_location.indexOf('/',_location.indexOf(applicationName)+applicationName.length);var webFolderFullPath=_location.substring(0,webFolderIndex);return webFolderFullPath;}
$(document).ready(function(){webRoot=getRootWebSitePath();$(".save_btn").css('background','url('+webRoot+'/resources/richLecture_addons/css/images_synchronizer/saveButton-'+language.selectedLang+'.png) no-repeat');presentation_file=webRoot+"/services/presentation/";slides_file=webRoot+"/services/slides/";timeline_width=1210;info=document.getElementById("info");define_actions();scroll();if(production_mode==1){vid_lecture_id=window.location.search.replace("?rid=","");if(vid_lecture_id.indexOf('&')!=-1)
window.location.href=window.location.search.replace(window.location.href.substring(window.location.href.indexOf('&')),"");presentation_file=presentation_file+vid_lecture_id;slides_file=slides_file+vid_lecture_id;}
read_parameters_XML();$("#marker_list_content").mouseleave(function(){$(".marker_selections").removeClass("highlight_marker_row");$('.marked_area').width("2px");});go_to_field_func();$(window).bind('beforeunload',function(){if($(".save_btn").prop('disabled')==false)
return language.s7;});$(".scroll-pane").mousewheel(function(e,delta){this.scrollLeft-=(delta*total_img_width);e.preventDefault();});});