var crossDomain_option=false;cuepoints_c=[];begin_cut_times=[];end_cut_times=[];cut_end_in_sec=[];var provider_type="";var video_url="";var cuts_period=0;var production_mode=1;var presentation_file="";var cuts_file="";var clips_list_file="";var realediting_file="";var vid_lecture_id="";var webRoot="";var info;var actions;var debug=0;var global_vid_duration=-1;var pp;var timeline_width=0;var cuts_counter=0;var time_now=0;var timeline_progress_bar_update_flag=1;var lock_flag=0;var go_to_time_refresh=1;var indicator_every_no_secs=900;function reformat_date(date_original){var date_splited=date_original.split("-");return(date_splited[2]+'-'+date_splited[1]+'-'+date_splited[0]);}
function read_parameters_XML(){$.ajax({type:"GET",url:presentation_file,dataType:"xml",crossDomain:crossDomain_option,cache:false,success:function(xml){logo=$(xml).find('logo').text();title=$(xml).find('title:first').text();$(document).attr('title',title);title=truncate(title,55,'...');date_txt=reformat_date($(xml).find('date').text());provider_type=$(xml).find('provider').text();video_url=$(xml).find('resource[format=MP4]').text();global_vid_duration=convert_hh_mm_ss_format($(xml).find('duration').text());$('<div class="header-item"><\/div>').html(title+' | '+date_txt).prependTo($('.header'));$('<div class="header-logo-item-separator"><\/div>').prependTo($('.header'));$('<div class="header-logo"><img src="'+logo+'" ><\/img><\/div>').prependTo($('.header'));},complete:function(){load_player();timeline_progress_bar();read_cuts_XML();}});}
function load_player(){pp=$f("player",{src:webRoot+"/resources/richLecture_addons/js/ext_js/flowplayer/flowplayer-3.2.16.swf",wmode:"opaque"},{plugins:{audio:{url:webRoot+'/resources/richLecture_addons/js/ext_js/flowplayer/flowplayer.audio-3.2.11.swf'},pseudo:{url:webRoot+'/resources/richLecture_addons/js/ext_js/flowplayer/flowplayer.pseudostreaming-3.2.12.swf'},controls:null},clip:{coverImage:{url:webRoot+"/resources/richLecture_addons/css/images_editor/AudioOnly.jpg",scaling:'fit'},autoPlay:false,autoBuffering:true,provider:provider_type,url:video_url,scaling:'fit',markers:[],onStart:function(){$('.player_play').css('background','url('+webRoot+'/resources/richLecture_addons/css/images_editor/pause-large.png) no-repeat');draggable_bar();},onPause:function(clip){$('.player_play').css('background','url('+webRoot+'/resources/richLecture_addons/css/images_editor/play-large.png) no-repeat');if(debug)
info.innerHTML="player paused at "+Math.round(this.getTime());},onSeek:function(){curr_time=Math.round(this.getTime())*1000;curr_time+=1;if(debug)info.innerHTML="onSeek"+curr_time;for(i=0;i<cuepoints_c.length;i++){if(cuepoints_c[i]<=curr_time){var end_c=cut_end_in_sec[cuepoints_c[i]]*1000;var diff=curr_time-end_c;if(diff<=0){if(debug)info.innerHTML="on Seek of end-cut current time at "+curr_time+" cut_period "+i+":"+cuepoints_c[i]+" - "+end_c;if((end_c/1000)<global_vid_duration){$f().seek(end_c/1000.0);}else{$f().play();}
break;}else{if(debug)info.innerHTML="no cuts:"+i+" "+cuepoints_c[i]+" "+end_c+" |curr: "+curr_time+" dif: "+diff;}}}},onResume:function(){$('.player_play').css('background','url('+webRoot+'/resources/richLecture_addons/css/images_editor/pause-large.png) no-repeat');if(debug)info.innerHTML="player resumed";}},onLoad:function(){if(debug)info.innerHTML="player loaded";},onVolume:function(level){if(debug)info.innerHTML="volume level is: "+Math.round(level);},onFinish:function(){$('.player_play').css('background','url('+webRoot+'/resources/richLecture_addons/css/images_editor/play-large.png) no-repeat');if(debug)info.innerHTML='player unloaded upon onFinish()';}});}
function addToTrimsClipsSelection(begin_sec,until_video_time,next_to_div,div_order,cuts_counter_specific_index){cuts_counter_tmp=cuts_counter;if(cuts_counter_specific_index!=null)
cuts_counter=cuts_counter_specific_index;div_txt='<div class="trims_clips_presentation" id="trims_clips_'+begin_sec+'_'+until_video_time+'"><\/div>';button_for_edit='<button type="button" title="'+language.e1+'" id="edit_row_from_trims_clips_presentation_'+begin_sec+'_'+until_video_time+'" class="edit_row_from_trims_clips_presentation" onclick="actions.edit_cut('+begin_sec+','+until_video_time+')"></button>';button_for_play_cut='<button type="button" title="'+language.e2+'" id="play_row_from_trims_clips_presentation_'+begin_sec+'_'+until_video_time+'" class="play_row_from_trims_clips_presentation" onclick="actions.play_cut('+begin_sec+','+until_video_time+')"></button>';button_for_check='<button type="button" title="'+language.e3+'" id="check_row_from_trims_clips_presentation_'+begin_sec+'_'+until_video_time+'" class="check_row_from_trims_clips_presentation" onclick="actions.seek('+begin_sec+')"></button>';if(begin_sec==0)
button_for_delete='<button type="button" title="'+language.e4+'" id="remove_row_from_trims_clips_presentation_'+begin_sec+'_'+until_video_time+'" class="remove_row_from_trims_clips_presentation" onclick="actions.remove_start_video()"></button>';else if(until_video_time==global_vid_duration)
button_for_delete='<button type="button" title="'+language.e4+'" id="remove_row_from_trims_clips_presentation_'+begin_sec+'_'+until_video_time+'" class="remove_row_from_trims_clips_presentation" onclick="actions.remove_end_video()"></button>';else if(until_video_time!='999999999'){button_for_delete='<button type="button" title="'+language.e4+'" id="remove_row_from_trims_clips_presentation_'+begin_sec+'_'+until_video_time+'" class="remove_row_from_trims_clips_presentation" onclick="actions.remove_cut_period('+cuts_counter+')"></button>';}else
button_for_delete='<button type="button" title="'+language.e4+'" class="remove_row_from_trims_clips_presentation" onclick="actions.remove_incomplete_cut_period('+cuts_counter+')"></button>';if(begin_sec==0)
$(div_txt).html(secondsTimeSpanToHMS(begin_sec)+' - '+secondsTimeSpanToHMS(until_video_time)+button_for_edit+button_for_play_cut+button_for_check+button_for_delete).hide().prependTo($('.userTrimInputs')).fadeIn("slow");else if(until_video_time==global_vid_duration)
$(div_txt).html(secondsTimeSpanToHMS(begin_sec)+' - '+secondsTimeSpanToHMS(until_video_time)+button_for_edit+button_for_play_cut+button_for_check+button_for_delete).hide().appendTo($('.userTrimInputs')).fadeIn("slow");else if(until_video_time!='999999999'){if(div_order=='after'){$(div_txt).html(secondsTimeSpanToHMS(begin_sec)+' - '+secondsTimeSpanToHMS(until_video_time)+button_for_edit+button_for_play_cut+button_for_check+button_for_delete).hide().insertAfter($(next_to_div)).show('slow');}else if(div_order=='before'){$(div_txt).html(secondsTimeSpanToHMS(begin_sec)+' - '+secondsTimeSpanToHMS(until_video_time)+button_for_edit+button_for_play_cut+button_for_check+button_for_delete).hide().insertBefore($(next_to_div)).show('slow');}else{$(div_txt).html(secondsTimeSpanToHMS(begin_sec)+' - '+secondsTimeSpanToHMS(until_video_time)+button_for_edit+button_for_play_cut+button_for_check+button_for_delete).hide().appendTo($('.userClipInputs')).show('slow');}}else
$(div_txt).html(language.e5+secondsTimeSpanToHMS(begin_sec)+' - ... '+button_for_delete).hide().prependTo($('.userClipInputs')).show('slow');cuts_counter=cuts_counter_tmp;$('#trims_clips_'+begin_sec+'_'+until_video_time).mouseenter(function(){$('#timeline_bar_'+begin_sec+'_'+until_video_time).addClass("showRegionOnTimeline");$(this).addClass('trims_clips_presentation_highlight');});$('#trims_clips_'+begin_sec+'_'+until_video_time).mouseleave(function(){$('#timeline_bar_'+begin_sec+'_'+until_video_time).removeClass("showRegionOnTimeline");$(this).removeClass('trims_clips_presentation_highlight');});}
function removeTrimClipSelection(begin_sec,until_video_time){$('#trims_clips_'+begin_sec+'_'+until_video_time).fadeOut('slow',function(){$(this).remove();});}
function truncate(str,maxLength,suffix)
{if(str.length>maxLength)
{str=str.substring(0,maxLength+1);str=str.substring(0,Math.min(str.length,str.lastIndexOf(" ")));str=str+suffix;}
return str;}
function define_actions(){actions={mute:function(){if(pp.getStatus().muted){$('.player_mute').css('background','url('+webRoot+'/resources/richLecture_addons/css/images_editor/unmute-large.png) no-repeat');pp.unmute();pp.setVolume(50);}else{$('.player_mute').css('background','url('+webRoot+'/resources/richLecture_addons/css/images_editor/mute-large.png) no-repeat');pp.mute();}},voldown:function(){curr_vol=pp.getVolume();if(curr_vol-10<=0){pp.setVolume(0);}else
pp.setVolume(curr_vol-10);},volup:function(){curr_vol=pp.getVolume();if(curr_vol+10>100)
pp.setVolume(100);else
pp.setVolume(curr_vol+10);},play:function(){if(pp.toggle()){$('.player_play').css('background','url('+webRoot+'/resources/richLecture_addons/css/images_editor/pause-large.png) no-repeat');}else{$('.player_play').css('background','url('+webRoot+'/resources/richLecture_addons/css/images_editor/play-large.png) no-repeat');}},stop:function(){pp.stop();$('.player_play').css('background','url('+webRoot+'/resources/richLecture_addons/css/images_editor/play-large.png) no-repeat');},seek:function(second){if(second-5>0)
pp.seek(second-5);else
pp.seek(second);},fast_seek:function(direction){time_now=Math.round(pp.getTime());if(direction=='fwd'){if(time_now+5>=global_vid_duration)
pp.seek(global_vid_duration);else
pp.seek(time_now+5);}else{if(time_now-5<=0)
pp.seek(0);else
pp.seek(time_now-5);}},edit_cut:function(begin_sec,end_sec){var initial_start_edit_time=secondsTimeSpanToHMS(begin_sec);var initial_end_edit_time=secondsTimeSpanToHMS(end_sec);$("#edit_selected_period").dialog({autoOpen:false,resizable:false,modal:true,resizable:false,draggable:false,position:{my:"center",at:"top+200",of:window},buttons:[{text:language.e21,click:function(){var bValid=false;var save_start_edit_time=$('#edit_start_time').val();var save_end_edit_time=$('#edit_end_time').val();var broken_start_time=save_start_edit_time.split(':');var broken_end_time=save_end_edit_time.split(':');if(begin_sec==convert_hh_mm_ss_format(save_start_edit_time)&&end_sec==convert_hh_mm_ss_format(save_end_edit_time)){$(this).dialog("close");return false;}
if(save_start_edit_time.length==8&&convert_hh_mm_ss_format(save_start_edit_time)<global_vid_duration&&broken_start_time.length==3&&save_end_edit_time.length==8&&convert_hh_mm_ss_format(save_end_edit_time)<=global_vid_duration&&broken_end_time.length==3&&broken_start_time[0].length==2&&broken_start_time[1].length==2&&broken_start_time[2].length==2&&$.isNumeric(broken_start_time[0])&&$.isNumeric(broken_start_time[1])&&$.isNumeric(broken_start_time[2])&&broken_end_time[0].length==2&&broken_end_time[1].length==2&&broken_end_time[2].length==2&&$.isNumeric(broken_end_time[0])&&$.isNumeric(broken_end_time[1])&&$.isNumeric(broken_end_time[2])&&broken_start_time[0]<60&&broken_start_time[1]<60&&broken_start_time[2]<60&&broken_end_time[0]<60&&broken_end_time[1]<60&&broken_end_time[2]<60){bValid=true;}
if(bValid){if(begin_sec==0)
bValid=actions.set_start_video(convert_hh_mm_ss_format(save_end_edit_time));else if(end_sec==global_vid_duration)
bValid=actions.set_end_video(convert_hh_mm_ss_format(save_start_edit_time));else{bValid=actions.edit_cut_times(begin_cut_times.indexOf(begin_sec),begin_sec,end_sec,convert_hh_mm_ss_format(save_start_edit_time),convert_hh_mm_ss_format(save_end_edit_time));}
if(bValid){$(this).dialog("close");pp.seek(convert_hh_mm_ss_format(save_end_edit_time));}}else{alert(language.e6);}}},{text:language.e22,click:function(){$(this).dialog("close");}}],close:function(){$(this).dialog("close");}});$('#edit_start_time').val(initial_start_edit_time);$('#edit_end_time').val(initial_end_edit_time);if(begin_sec==0)
$("#edit_start_time").prop('disabled',true);else
$("#edit_start_time").prop('disabled',false);if(end_sec==global_vid_duration)
$("#edit_end_time").prop('disabled',true);else
$("#edit_end_time").prop('disabled',false);$("#edit_selected_period").dialog("open");},edit_cut_times:function(cuts_counter_specific_index,begin_cut_time_orig,end_cut_time_orig,begin_cut_time_curr,end_cut_time_curr){if(begin_cut_time_curr==0){alert(language.e7);return false;}
if(begin_cut_time_curr==global_vid_duration){alert(language.e8);return false;}
if(end_cut_time_curr==global_vid_duration){alert(language.e9);return false;}
if(end_cut_time_curr<=begin_cut_time_curr){alert(language.e10);return false;}
remove_index=[];for(l=0;l<cuepoints_c.length;l++){if(l==cuepoints_c.indexOf(begin_cut_times[cuts_counter_specific_index]*1000))
continue;else{if(cuepoints_c[l]/1000<=begin_cut_time_curr&&cut_end_in_sec[cuepoints_c[l]]>=begin_cut_time_curr){alert(language.e11);return false;}
if(cuepoints_c[l]/1000<=end_cut_time_curr&&cut_end_in_sec[cuepoints_c[l]]>=end_cut_time_curr){alert(language.e12);return false;}
if(cuepoints_c[l]/1000>=begin_cut_time_curr&&cut_end_in_sec[cuepoints_c[l]]<=end_cut_time_curr){remove_index.push(l);}}}
begin_cut_times[cuts_counter_specific_index]=begin_cut_time_curr;cuepoints_c[cuepoints_c.indexOf(begin_cut_time_orig*1000)]=begin_cut_time_curr*1000;end_cut_times[cuts_counter_specific_index]=end_cut_time_curr;cut_end_in_sec[begin_cut_time_orig*1000]=null;cut_end_in_sec[begin_cut_times[cuts_counter_specific_index]*1000]=end_cut_time_curr;removeCutOnTimelineBar(begin_cut_time_orig,end_cut_time_orig);removeTrimClipSelection(begin_cut_time_orig,end_cut_time_orig);consider_no_removed_items=0;for(i=0;i<remove_index.length;i++){if(cuepoints_c[remove_index[i-consider_no_removed_items]]==0)
continue;index_of_begin_cut_time=begin_cut_times.indexOf(cuepoints_c[remove_index[i-consider_no_removed_items]]/1000);removeCutOnTimelineBar(cuepoints_c[remove_index[i-consider_no_removed_items]]/1000,cut_end_in_sec[cuepoints_c[remove_index[i-consider_no_removed_items]]]);removeTrimClipSelection(cuepoints_c[remove_index[i-consider_no_removed_items]]/1000,cut_end_in_sec[cuepoints_c[remove_index[i-consider_no_removed_items]]]);cut_end_in_sec[cuepoints_c[remove_index[i-consider_no_removed_items]]]=null;begin_cut_times[index_of_begin_cut_time]=null;end_cut_times[index_of_begin_cut_time]=null;cuepoints_c.splice(remove_index[i-consider_no_removed_items],1);consider_no_removed_items++;}
addCutOnTimelineBar(begin_cut_times[cuts_counter_specific_index],end_cut_times[cuts_counter_specific_index]);min_diff=360000;min_diff_index=-1;for(i=0;i<begin_cut_times.length;i++){cut_diff=Math.abs(begin_cut_times[cuts_counter_specific_index]-begin_cut_times[i]);if(cut_diff>0&&cut_diff<min_diff&&begin_cut_times[i]!=null){min_diff=cut_diff;min_diff_index=i;if(begin_cut_times[cuts_counter_specific_index]>begin_cut_times[i])
min_diff_order='after';else
min_diff_order='before';}}
if(min_diff_index>=0)
addToTrimsClipsSelection(begin_cut_times[cuts_counter_specific_index],end_cut_times[cuts_counter_specific_index],'#trims_clips_'+begin_cut_times[min_diff_index]+'_'+end_cut_times[min_diff_index],min_diff_order,cuts_counter_specific_index);else
addToTrimsClipsSelection(begin_cut_times[cuts_counter_specific_index],end_cut_times[cuts_counter_specific_index],null,null,cuts_counter_specific_index);pp.getClip(0).onCuepoint(begin_cut_times[cuts_counter_specific_index]*1000,function(clip,point){if(cuepoints_c.indexOf(point)!==-1){$.ionSound.play("glass");var new_time=cut_end_in_sec[point];if(debug)info.innerHTML="onCuepoint cut cuepoint: "+point+" "+" | "+new_time;pp.seek(new_time);}});$(".send_json_button").prop('disabled',false);$(".send_json_button").css('opacity','1');return true;},play_cut:function(begin_sec,end_sec){pp.pause();$('.play_cut_section').html('<div class="b-close">Close<\/div>');active_slide_src=$('#active_slide img').attr('src');$('.play_cut_section').bPopup({content:'iframe',iframeAttr:'width="616px" height="390px"',contentContainer:'.play_cut_section',loadUrl:'editor_play_cut.html?id='+video_url+'&duration='+global_vid_duration+'&start='+begin_sec+'&end='+end_sec+'&provider='+provider_type,closeClass:'.b-close'});},go_to_time:function(){var go_to_time=$(".go_to_field").val();var go_to_time_sec=convert_hh_mm_ss_format(go_to_time);var broken_time=go_to_time.split(':');if(go_to_time.length==8&&go_to_time_sec<global_vid_duration&&broken_time.length==3)
if(broken_time[0].length==2&&broken_time[1].length==2&&broken_time[2].length==2&&$.isNumeric(broken_time[0])&&$.isNumeric(broken_time[1])&&$.isNumeric(broken_time[2]))
if(broken_time[0]<60&&broken_time[1]<60&&broken_time[2]<60)
pp.seek(go_to_time_sec);},set_start_video:function(start_video_time){if(start_video_time==null)
start_video_time=Math.round(pp.getTime());var start_trim_index=cuepoints_c.indexOf(0);if(start_video_time==0){alert(language.e13);return false;}
if(start_video_time==global_vid_duration){alert(language.e14);return false;}
for(l=0;l<cuepoints_c.length;l++){if(l==start_trim_index){if(cut_end_in_sec[0]==start_video_time)
return false;else
continue;}else{if(cuepoints_c[l]/1000<=start_video_time){alert(language.e15);return false;}}}
$(".set_start_button").prop('disabled',true);$(".set_start_button").css('opacity','0.4');$(".send_json_button").prop('disabled',false);$(".send_json_button").css('opacity','1');begin_sec=0;if(start_trim_index!==-1){removeCutOnTimelineBar(cuepoints_c[start_trim_index],cut_end_in_sec[begin_sec*1000]);removeTrimClipSelection(cuepoints_c[start_trim_index],cut_end_in_sec[begin_sec*1000]);cut_end_in_sec[begin_sec*1000]=start_video_time;cuepoints_c[start_trim_index]=begin_sec*1000;}else{cut_end_in_sec[begin_sec*1000]=start_video_time;cuepoints_c.push(begin_sec*1000);}
addCutOnTimelineBar(begin_sec,start_video_time);addToTrimsClipsSelection(begin_sec,start_video_time);pp.getClip(0).onCuepoint(begin_sec*1000,function(clip,point){if(cuepoints_c.indexOf(point)!==-1){$.ionSound.play("glass");var new_time=cut_end_in_sec[point];if(debug)info.innerHTML="onCuepoint cut cuepoint: "+point+" "+" | "+new_time;pp.seek(new_time);}});$(".set_start_button").prop('disabled',false);$(".set_start_button").css('opacity','1');return true},remove_start_video:function(){var start_trim_index=cuepoints_c.indexOf(0);if(start_trim_index!==-1){removeCutOnTimelineBar(cuepoints_c[start_trim_index],cut_end_in_sec[cuepoints_c[start_trim_index]*1000]);removeTrimClipSelection(cuepoints_c[start_trim_index],cut_end_in_sec[cuepoints_c[start_trim_index]*1000]);cut_end_in_sec[cuepoints_c[start_trim_index]*1000]=null;cuepoints_c.splice(start_trim_index,1);$(".send_json_button").prop('disabled',false);$(".send_json_button").css('opacity','1');}},set_end_video:function(end_video_time){if(end_video_time==null)
end_video_time=Math.round(pp.getTime());var video_duration=global_vid_duration;var end_trim_cut_end_index=cut_end_in_sec.indexOf(video_duration);if(end_video_time==global_vid_duration){alert(language.e16);return false;}
if(end_video_time==0){alert(language.e17);return false;}
if(end_trim_cut_end_index/1000==end_video_time)
return false;for(l=0;l<cuepoints_c.length;l++){if(l==cuepoints_c.indexOf(end_trim_cut_end_index)){continue;}else{if(cuepoints_c[l]/1000>=end_video_time){alert(language.e18);return false;}
if(cuepoints_c[l]/1000<=end_video_time&&cut_end_in_sec[cuepoints_c[l]]>=end_video_time){alert(language.e19);return false;}}}
$(".set_end_button").prop('disabled',true);$(".set_end_button").css('opacity','0.4');$(".send_json_button").prop('disabled',false);$(".send_json_button").css('opacity','1');begin_sec=end_video_time;if(end_trim_cut_end_index!==-1){var end_trim_cut_begin_index=Math.round(cuepoints_c.indexOf(end_trim_cut_end_index));removeCutOnTimelineBar(cuepoints_c[end_trim_cut_begin_index]/1000,cut_end_in_sec[end_trim_cut_end_index]);removeTrimClipSelection(cuepoints_c[end_trim_cut_begin_index]/1000,cut_end_in_sec[end_trim_cut_end_index]);cut_end_in_sec[end_trim_cut_end_index]=null;cuepoints_c.splice(end_trim_cut_begin_index,1);}
cut_end_in_sec[begin_sec*1000]=video_duration;cuepoints_c.push(begin_sec*1000);addCutOnTimelineBar(begin_sec,video_duration);addToTrimsClipsSelection(begin_sec,video_duration);pp.getClip(0).onCuepoint(begin_sec*1000,function(clip,point){if(cuepoints_c.indexOf(point)!==-1){$.ionSound.play("glass");var new_time=global_vid_duration;if(debug)info.innerHTML="onCuepoint cut cuepoint: "+point+" "+" | "+new_time;pp.play();}});$(".set_end_button").prop('disabled',false);$(".set_end_button").css('opacity','1');return true;},remove_end_video:function(){var video_duration=global_vid_duration;var end_trim_cut_end_index=cut_end_in_sec.indexOf(video_duration);if(end_trim_cut_end_index!==-1){var end_trim_cut_begin_index=Math.round(cuepoints_c.indexOf(end_trim_cut_end_index));removeCutOnTimelineBar(cuepoints_c[end_trim_cut_begin_index]/1000,cut_end_in_sec[end_trim_cut_end_index]);removeTrimClipSelection(cuepoints_c[end_trim_cut_begin_index]/1000,cut_end_in_sec[end_trim_cut_end_index]);cut_end_in_sec[end_trim_cut_end_index]=null;cuepoints_c.splice(end_trim_cut_begin_index,1);$(".send_json_button").prop('disabled',false);$(".send_json_button").css('opacity','1');}},begin_cut:function(){begin_cut_time_curr=Math.round(pp.getTime());if(debug)info.innerHTML="Cut period "+cuts_counter+"begin: "+begin_cut_time_curr;if(begin_cut_time_curr==0){alert(language.e20);return false;}
if(begin_cut_time_curr==global_vid_duration){alert(language.e8);return false;}
for(l=0;l<cuepoints_c.length;l++){if(cuepoints_c[l]/1000<=begin_cut_time_curr&&cut_end_in_sec[cuepoints_c[l]]>=begin_cut_time_curr){alert(language.e11);return false;}}
begin_cut_times[cuts_counter]=begin_cut_time_curr;cuepoints_c.push(begin_cut_times[cuts_counter]*1000);addToTrimsClipsSelection(begin_cut_times[cuts_counter],'999999999');markStartOfCutOnTimeline(begin_cut_times[cuts_counter]);$(".begin_cut_button").prop('disabled',true);$(".begin_cut_button").css('opacity','0.4');$(".end_cut_button").prop('disabled',false);$(".end_cut_button").css('opacity','1');$(".set_start_button").prop('disabled',true);$(".set_start_button").css('opacity','0.4');$(".set_end_button").prop('disabled',true);$(".set_end_button").css('opacity','0.4');$(".send_json_button").prop('disabled',true);$(".send_json_button").css('opacity','0.5');},end_cut:function(){end_cut_time_curr=Math.round(pp.getTime());if(debug)info.innerHTML="Cut period "+cuts_counter+"end: "+end_cut_time_curr;if(end_cut_time_curr==global_vid_duration){alert(language.e23);return false;}
if(end_cut_time_curr<=begin_cut_times[cuts_counter]){alert(language.e10);return false;}
remove_index=[];for(l=0;l<cuepoints_c.length;l++){if(l==cuepoints_c.indexOf(begin_cut_times[cuts_counter]*1000))
continue;else{if(cuepoints_c[l]/1000<=end_cut_time_curr&&cut_end_in_sec[cuepoints_c[l]]>=end_cut_time_curr){alert(language.e12);return false;}
if(cuepoints_c[l]/1000>=begin_cut_times[cuts_counter]&&cut_end_in_sec[cuepoints_c[l]]<=end_cut_time_curr){remove_index.push(l);}}}
consider_no_removed_items=0;for(i=0;i<remove_index.length;i++){if(cuepoints_c[remove_index[i-consider_no_removed_items]]==0)
continue;index_of_begin_cut_time=begin_cut_times.indexOf(cuepoints_c[remove_index[i-consider_no_removed_items]]/1000);removeCutOnTimelineBar(cuepoints_c[remove_index[i-consider_no_removed_items]]/1000,cut_end_in_sec[cuepoints_c[remove_index[i-consider_no_removed_items]]]);removeTrimClipSelection(cuepoints_c[remove_index[i-consider_no_removed_items]]/1000,cut_end_in_sec[cuepoints_c[remove_index[i-consider_no_removed_items]]]);cut_end_in_sec[cuepoints_c[remove_index[i-consider_no_removed_items]]]=null;begin_cut_times[index_of_begin_cut_time]=null;end_cut_times[index_of_begin_cut_time]=null;cuepoints_c.splice(remove_index[i-consider_no_removed_items],1);consider_no_removed_items++;}
end_cut_times[cuts_counter]=end_cut_time_curr;cut_end_in_sec[begin_cut_times[cuts_counter]*1000]=end_cut_times[cuts_counter];removeMarkStartOfCutOnTimeline(begin_cut_times[cuts_counter]);addCutOnTimelineBar(begin_cut_times[cuts_counter],end_cut_times[cuts_counter]);removeTrimClipSelection(begin_cut_times[cuts_counter],'999999999');min_diff=360000;min_diff_index=-1;for(i=0;i<begin_cut_times.length;i++){cut_diff=Math.abs(begin_cut_times[cuts_counter]-begin_cut_times[i]);if(cut_diff>0&&cut_diff<min_diff&&begin_cut_times[i]!=null){min_diff=cut_diff;min_diff_index=i;if(begin_cut_times[cuts_counter]>begin_cut_times[i])
min_diff_order='after';else
min_diff_order='before';}}
if(min_diff_index>=0)
addToTrimsClipsSelection(begin_cut_times[cuts_counter],end_cut_times[cuts_counter],'#trims_clips_'+begin_cut_times[min_diff_index]+'_'+end_cut_times[min_diff_index],min_diff_order);else
addToTrimsClipsSelection(begin_cut_times[cuts_counter],end_cut_times[cuts_counter]);pp.getClip(0).onCuepoint(begin_cut_times[cuts_counter]*1000,function(clip,point){if(cuepoints_c.indexOf(point)!==-1){$.ionSound.play("glass");var new_time=cut_end_in_sec[point];if(debug)info.innerHTML="onCuepoint cut cuepoint: "+point+" "+" | "+new_time;pp.seek(new_time);}});$(".begin_cut_button").prop('disabled',false);$(".begin_cut_button").css('opacity','1');$(".end_cut_button").prop('disabled',true);$(".end_cut_button").css('opacity','0.4');$(".set_start_button").prop('disabled',false);$(".set_start_button").css('opacity','1');$(".set_end_button").prop('disabled',false);$(".set_end_button").css('opacity','1');$(".send_json_button").prop('disabled',false);$(".send_json_button").css('opacity','1');cuts_counter++;},remove_cut_period:function(period){var start_trim_index=cuepoints_c.indexOf(begin_cut_times[period]*1000);if(start_trim_index!==-1&&cuepoints_c[start_trim_index]!=0){removeCutOnTimelineBar(cuepoints_c[start_trim_index]/1000,cut_end_in_sec[cuepoints_c[start_trim_index]]);removeTrimClipSelection(cuepoints_c[start_trim_index]/1000,cut_end_in_sec[cuepoints_c[start_trim_index]]);cut_end_in_sec[cuepoints_c[start_trim_index]]=null;cuepoints_c.splice(start_trim_index,1);begin_cut_times[period]=null;end_cut_times[period]=null;$(".send_json_button").prop('disabled',false);$(".send_json_button").css('opacity','1');}},remove_incomplete_cut_period:function(period){var start_trim_index=cuepoints_c.indexOf(begin_cut_times[period]*1000);if(start_trim_index!==-1){$(".begin_cut_button").prop('disabled',false);$(".begin_cut_button").css('opacity','1');$(".end_cut_button").prop('disabled',true);$(".end_cut_button").css('opacity','0.4');$(".set_start_button").prop('disabled',false);$(".set_start_button").css('opacity','1');$(".set_end_button").prop('disabled',false);$(".set_end_button").css('opacity','1');removeMarkStartOfCutOnTimeline(cuepoints_c[start_trim_index]/1000);removeTrimClipSelection(cuepoints_c[start_trim_index]/1000,'999999999');cuepoints_c.splice(start_trim_index,1);begin_cut_times[period]=null;}},send_json:function(){$(".send_json_button").prop('disabled',true);$(".send_json_button").css('opacity','0.5');final_trim_begin=[];final_trim_end=[];final_clip_begin=[];final_clip_end=[];for(var k=0;k<cuepoints_c.length;k++){if(cuepoints_c[k]==0){final_trim_begin.push(secondsTimeSpanToHMS(cuepoints_c[k]/1000));final_trim_end.push(secondsTimeSpanToHMS(cut_end_in_sec[cuepoints_c[k]]));}else if(cut_end_in_sec[cuepoints_c[k]]==global_vid_duration){final_trim_begin.push(secondsTimeSpanToHMS(cuepoints_c[k]/1000));final_trim_end.push(secondsTimeSpanToHMS(cut_end_in_sec[cuepoints_c[k]]));}else{final_clip_begin.push(secondsTimeSpanToHMS(cuepoints_c[k]/1000));final_clip_end.push(secondsTimeSpanToHMS(cut_end_in_sec[cuepoints_c[k]]));}}
trim_begin_json=JSON.stringify({trim_begin:final_trim_begin});trim_end_json=JSON.stringify({trim_end:final_trim_end});clip_begin_json=JSON.stringify({clip_begin:final_clip_begin});clip_end_json=JSON.stringify({clip_end:final_clip_end});var total_trims_json=trim_begin_json.concat(trim_end_json);var total_clips_json=clip_begin_json.concat(clip_end_json);var total_json=total_trims_json.concat(total_clips_json);real_duration_value=[];real_duration_value.push(recalculate_real_duration());var total_json=total_json.concat(JSON.stringify({real_duration:real_duration_value}));initial_duration_value=[];initial_duration_value.push(secondsTimeSpanToHMS(global_vid_duration));total_json=total_json.concat(JSON.stringify({initial_duration:initial_duration_value}));if(production_mode==0){info.innerHTML="JSON: "+total_json;}else{$.ajax({url:cuts_file,type:"POST",contentType:"application/json; charset=utf-8",dataType:"html",crossDomain:crossDomain_option,data:total_json,cache:false,processData:false,success:function(res){if(res!=1){if(res==4)
alert(language.e29);else if(res==5)
alert(language.e30);else if(res==2)
alert(language.e28);else
alert(language.e24);$(".send_json_button").prop('disabled',false);$(".send_json_button").css('opacity','1');}else{refresh_clips_duration();$(".send_json_button").prop('disabled',true);$(".send_json_button").css('opacity','0.5');}},error:function(){alert(language.e24);$(".send_json_button").prop('disabled',false);$(".send_json_button").css('opacity','1');}});}},realedit:function(){if($(".send_json_button").prop('disabled')==false||(typeof $(".send_json_button").prop('disabled')==='undefined')){alert(language.e31)}else if(cuepoints_c.length==0){alert(language.e32)}else{$(".realediting_btn").prop('disabled',true);$(".realediting_btn").css('opacity','0.4');$("#realediting_modal").dialog({autoOpen:false,resizable:false,modal:true,resizable:false,draggable:false,closeOnEscape:false,width:500,position:{my:"center",at:"top+200",of:window},beforeClose:function(event,ui){$(".realediting_btn").prop('disabled',false);$(".realediting_btn").css('opacity','1');},buttons:[{text:language.e33,click:function(){$.ajax({url:realediting_file,type:"POST",contentType:"application/json; charset=utf-8",dataType:"html",crossDomain:crossDomain_option,cache:false,processData:false,success:function(res){if(res==2){$("#realediting_modal").dialog("close");alert(language.e36);}else if(res!=1){$("#realediting_modal").dialog("close");alert(language.e34);}else{$("#realediting_modal").dialog("close");window.location.href=webRoot+"/admin/cmanager/areg?rid="+vid_lecture_id;}},error:function(){$("#realediting_modal").dialog("close");alert(language.e35);}});}},{text:language.e22,click:function(){$(this).dialog("close");}}]});$("#realediting_modal").dialog("open");}}}}
function recalculate_real_duration(){real_duration=global_vid_duration;for(i=0;i<cuepoints_c.length;i++){real_duration-=cut_end_in_sec[cuepoints_c[i]]-parseInt(cuepoints_c[i]/1000,10);}
if(real_duration<0)
real_duration=0;return secondsTimeSpanToHMS(real_duration);}
function refresh_clips_duration(){$.ajax({type:"GET",url:clips_list_file,crossDomain:crossDomain_option,cache:false,dataType:"xml",success:function(res){var xml_clips_list=$(res).find("Cliplist").text();if(xml_clips_list!=-1){var total_json_content_clip_final="";$(res).find('clip').each(function(){var clip_start=-1;var clip_end=-1;if($(this).find('clip_starttime').text()!=-1){clip_start=convert_hh_mm_ss_format($(this).find('clip_starttime').text());}
if($(this).find('clip_endtime').text()!=-1){clip_end=convert_hh_mm_ss_format($(this).find('clip_endtime').text());}
clip_item_id=$(this).find('id').text().replace("c_","").replace(".xml","");total_json_content_clip_final=total_json_content_clip_final.concat(calculate_clip_duration(clip_start,clip_end,clip_item_id));});$.ajax({url:clips_list_file,type:"POST",contentType:"application/json; charset=utf-8",dataType:"html",crossDomain:crossDomain_option,data:total_json_content_clip_final,cache:false,processData:false,success:function(res){if(res!=1){alert(language.e25);}},error:function(){alert(language.e25);}});}}});}
function calculate_clip_duration(clip_start,clip_end,clip_item_id){var total_json_content_clip=[];if(clip_end==-1||clip_start==-1){total_json_content_clip=[clip_item_id,(-1).toString(),clip_start.toString(),clip_end.toString()];return JSON.stringify({clip:total_json_content_clip});}
var clip_duration_tmp=clip_end-clip_start;for(i=0;i<cuepoints_c.length;i++){if((parseInt(cuepoints_c[i]/1000,10)<=clip_start&&cut_end_in_sec[cuepoints_c[i]]<=clip_start)||(parseInt(cuepoints_c[i]/1000,10)>=clip_end)){continue;}else if(parseInt(cuepoints_c[i]/1000,10)>=clip_start&&cut_end_in_sec[cuepoints_c[i]]<=clip_end){clip_duration_tmp-=cut_end_in_sec[cuepoints_c[i]]-parseInt(cuepoints_c[i]/1000,10);}else if(parseInt(cuepoints_c[i]/1000,10)<=clip_start&&cut_end_in_sec[cuepoints_c[i]]>=clip_end){clip_duration_tmp-=clip_end-clip_start;}else if(parseInt(cuepoints_c[i]/1000,10)<=clip_start&&cut_end_in_sec[cuepoints_c[i]]>clip_start&&cut_end_in_sec[cuepoints_c[i]]<=clip_end){clip_duration_tmp-=cut_end_in_sec[cuepoints_c[i]]-clip_start;}else if(parseInt(cuepoints_c[i]/1000,10)>clip_start&&cut_end_in_sec[cuepoints_c[i]]>=clip_end){clip_duration_tmp-=clip_end-parseInt(cuepoints_c[i]/1000,10);}}
if(clip_duration_tmp<0)
clip_duration_tmp=0;total_json_content_clip=[clip_item_id,secondsTimeSpanToHMS(clip_duration_tmp),secondsTimeSpanToHMS(clip_start),secondsTimeSpanToHMS(clip_end)];return JSON.stringify({clip:total_json_content_clip});}
function update_timeline(){$(".timeline").width(timeline_width);$(".draggable_container").width(timeline_width);$(".minute_period").remove();$(".five_minute_period").remove();$(".quarter_period").remove();$(".quarter_period_time").remove();var quarter_period=parseInt(global_vid_duration/indicator_every_no_secs);var minute_period=parseInt(global_vid_duration/60);for(i=0;i<=minute_period;i++){left_pos=Math.round((i*60/global_vid_duration)*timeline_width);if(i%5)
$('<div class="minute_period"><\/div>').css({'left':+left_pos+'px'}).appendTo($('.timeline'));else
$('<div class="five_minute_period"><\/div>').css({'left':+left_pos+'px'}).appendTo($('.timeline'));}
for(i=0;i<=quarter_period;i++){left_pos=Math.round((i*indicator_every_no_secs/global_vid_duration)*timeline_width);$('<div class="quarter_period"><\/div>').html('<div class="quarter_period_time">'+secondsTimeSpanToHMS(i*indicator_every_no_secs)+'<\/div>').css({'left':+left_pos+'px'}).appendTo($('.timeline'));}
$('<div class="quarter_period"><\/div>').html('<div class="quarter_period_time">'+secondsTimeSpanToHMS(global_vid_duration)+'<\/div>').css({'left':+(timeline_width-1)+'px'}).appendTo($('.timeline'));}
function read_cuts_XML(){$.ajax({type:"GET",url:cuts_file,crossDomain:crossDomain_option,cache:false,dataType:"xml",success:function(xml_for_trims_cuts){var xml_clips=$(xml_for_trims_cuts).find("clips");var xml_trims=$(xml_for_trims_cuts).find("trims");xml_trims.find("start").each(function(){begin_sec=$(this).find('begin').text();end_sec=$(this).find('end').text();begin_sec=convert_hh_mm_ss_format(begin_sec);end_sec=convert_hh_mm_ss_format(end_sec);cut_end_in_sec[begin_sec*1000]=end_sec;cuepoints_c.push(begin_sec*1000);addCutOnTimelineBar(begin_sec,end_sec);addToTrimsClipsSelection(begin_sec,end_sec);pp.getClip(0).onCuepoint(begin_sec*1000,function(clip,point){if(cuepoints_c.indexOf(point)!==-1){$.ionSound.play("glass");var new_time=cut_end_in_sec[point];if(debug)info.innerHTML="onCuepoint cut cuepoint: "+point+" "+" | "+new_time;pp.seek(new_time);}});});xml_trims.find("finish").each(function(){begin_sec=$(this).find('begin').text();end_sec=$(this).find('end').text();begin_sec=convert_hh_mm_ss_format(begin_sec);end_sec=convert_hh_mm_ss_format(end_sec);cut_end_in_sec[begin_sec*1000]=end_sec;cuepoints_c.push(begin_sec*1000);addCutOnTimelineBar(begin_sec,end_sec);addToTrimsClipsSelection(begin_sec,end_sec);pp.getClip(0).onCuepoint(begin_sec*1000,function(clip,point){if(cuepoints_c.indexOf(point)!==-1){$.ionSound.play("glass");var new_time=cut_end_in_sec[point];if(debug)info.innerHTML="onCuepoint cut cuepoint: "+point+" "+" | "+new_time;pp.play();}});});xml_clips.find("cut").each(function(){begin_sec=$(this).find('begin').text();end_sec=$(this).find('end').text();begin_sec=convert_hh_mm_ss_format(begin_sec);end_sec=convert_hh_mm_ss_format(end_sec);cut_end_in_sec[begin_sec*1000]=end_sec;cuepoints_c.push(begin_sec*1000);begin_cut_times[cuts_counter]=begin_sec;end_cut_times[cuts_counter]=end_sec;addCutOnTimelineBar(begin_cut_times[cuts_counter],end_cut_times[cuts_counter]);min_diff=360000;min_diff_index=-1;for(i=0;i<begin_cut_times.length;i++){cut_diff=Math.abs(begin_cut_times[cuts_counter]-begin_cut_times[i]);if(cut_diff>0&&cut_diff<min_diff){min_diff=cut_diff;min_diff_index=i;if(begin_cut_times[cuts_counter]>begin_cut_times[i])
min_diff_order='after';else
min_diff_order='before';}}
if(min_diff_index>=0)
addToTrimsClipsSelection(begin_cut_times[cuts_counter],end_cut_times[cuts_counter],'#trims_clips_'+begin_cut_times[min_diff_index]+'_'+end_cut_times[min_diff_index],min_diff_order);else
addToTrimsClipsSelection(begin_cut_times[cuts_counter],end_cut_times[cuts_counter]);pp.getClip(0).onCuepoint(begin_sec*1000,function(clip,point){if(cuepoints_c.indexOf(point)!==-1){$.ionSound.play("glass");var new_time=cut_end_in_sec[point];if(debug)info.innerHTML="onCuepoint cut cuepoint: "+point+" "+" | "+new_time;pp.seek(new_time);}});cuts_counter++;});}});}
function go_to_field_func(){$(".go_to_field").click(function(){go_to_time_refresh=0;});$(".go_to_field").focus(function(){go_to_time_refresh=0;});$(".go_to_field").select(function(){go_to_time_refresh=0;});$(".go_to_field").focusout(function(){go_to_time_refresh=1;});$('.go_to_field').bind('keyup',function(e){if(e.keyCode==13){actions.go_to_time();go_to_time_refresh=1;}else if(e.keyCode==27){go_to_time_refresh=1;}else{go_to_time_refresh=0;}});}
function addCutOnTimelineBar(begin_sec,until_video_time){timeline_bar_start=Math.round(((begin_sec)/global_vid_duration)*timeline_width);timeline_bar_width=Math.round(((until_video_time-begin_sec)/global_vid_duration)*timeline_width);if(begin_sec-5>0)
$('<div class="marked_area" id="timeline_bar_'+begin_sec+'_'+until_video_time+'" title="'+secondsTimeSpanToHMS(begin_sec)+' - '+secondsTimeSpanToHMS(until_video_time)+'"><\/div>').animate({'left':timeline_bar_start+"px",'width':timeline_bar_width+"px"}).appendTo($('.timeline')).click(function(){$f().seek(begin_sec-5);}).tooltip({position:'top center',effect:'slide'});else
$('<div class="marked_area" id="timeline_bar_'+begin_sec+'_'+until_video_time+'" title="'+secondsTimeSpanToHMS(begin_sec)+' - '+secondsTimeSpanToHMS(until_video_time)+'"><\/div>').animate({'left':timeline_bar_start+"px",'width':timeline_bar_width+"px"}).appendTo($('.timeline')).click(function(){$f().seek(begin_sec);}).tooltip({position:'top center',effect:'slide'});$('#timeline_bar_'+begin_sec+'_'+until_video_time).mouseenter(function(){$(this).addClass("showRegionOnTimeline");});$('#timeline_bar_'+begin_sec+'_'+until_video_time).mouseleave(function(){$(this).removeClass("showRegionOnTimeline");});}
function markStartOfCutOnTimeline(begin_sec){timeline_bar_start=Math.round(((begin_sec)/global_vid_duration)*timeline_width);$('<div class="marked_area_position_cut" id="timeline_bar_'+begin_sec+'"><\/div>').html('<div class="timeline_start_cut_position">'+language.e26+'<\/div>').animate({'left':timeline_bar_start+"px"}).appendTo($('.timeline'));}
function removeMarkStartOfCutOnTimeline(begin_sec){$('#timeline_bar_'+begin_sec).hide('slow',function(){$(this).remove();});}
function removeCutOnTimelineBar(begin_sec,until_video_time){$('#timeline_bar_'+begin_sec+'_'+until_video_time).hide('slow',function(){$(this).remove();});}
function convert_hh_mm_ss_format(input_time){var _input_time;var ms_time = input_time.split('.');if (ms_time.length == 1) _input_time = input_time;else _input_time=ms_time[0];var broken_time=_input_time.split(':');var hours=0;var minutes=0;var seconds=0;if(broken_time.length==1)seconds=parseFloat(broken_time[0]);if(broken_time.length==2){minutes=parseFloat(broken_time[0]);seconds=parseFloat(broken_time[1]);}
if(broken_time.length==3){hours=parseFloat(broken_time[0]);minutes=parseFloat(broken_time[1]);seconds=parseFloat(broken_time[2]);}
return Math.round(seconds+60*minutes+3600*hours);}
function secondsTimeSpanToHMS(s){var h=Math.floor(s/3600);s-=h*3600;var m=Math.floor(s/60);s-=m*60;return(h<10?'0'+h:h)+":"+(m<10?'0'+m:m)+":"+(s<10?'0'+s:s);}
function secondsTimeSpanToHM(s){var h=Math.floor(s/3600);s-=h*3600;var m=Math.floor(s/60);s-=m*60;return(h+'h')+(m+'m')+((s>0)?(s+'s'):'');}
function timeline_progress_bar(){var quarter_period=parseInt(global_vid_duration/indicator_every_no_secs);var minute_period=parseInt(global_vid_duration/60);for(i=0;i<=minute_period;i++){left_pos=Math.round((i*60/global_vid_duration)*timeline_width);if(i%5)
$('<div class="minute_period"><\/div>').css({'left':+left_pos+'px'}).appendTo($('.timeline'));else
$('<div class="five_minute_period"><\/div>').css({'left':+left_pos+'px'}).appendTo($('.timeline'));}
for(i=0;i<=quarter_period;i++){left_pos=Math.round((i*indicator_every_no_secs/global_vid_duration)*timeline_width);$('<div class="quarter_period"><\/div>').html('<div class="quarter_period_time">'+secondsTimeSpanToHMS(i*indicator_every_no_secs)+'<\/div>').css({'left':+left_pos+'px'}).appendTo($('.timeline'));if(i==quarter_period&&(timeline_width-left_pos)<25){$(".quarter_period_time").html('');}}
$('<div class="quarter_period"><\/div>').html('<div class="quarter_period_time">'+secondsTimeSpanToHMS(global_vid_duration)+'<\/div>').css({'left':+(timeline_width-1)+'px'}).appendTo($('.timeline'));setInterval(function(){if(timeline_progress_bar_update_flag==1){lock_flag=1;time_now=pp.getTime();position_on_timeline_bar=Math.round((time_now/global_vid_duration)*timeline_width);$(".timeline_progress_position_time").html(secondsTimeSpanToHMS(Math.round(time_now)));$(".timeline_progress_position").animate({'left':position_on_timeline_bar+"px"},{duration:100,queue:false});if(go_to_time_refresh==1){$(".go_to_field").val(secondsTimeSpanToHMS(Math.round(time_now)));}
setTimeout(function(){return false;},100);lock_flag=0;}},1000);}
function draggable_bar(){$('.timeline_progress_position').draggable({axis:"x",containment:'parent',start:function(){while(lock_flag==1){setTimeout(function(){return false;},100);};timeline_progress_bar_update_flag=0;},stop:function(){var cursor_pos=$(this).css('left');cursor_pos=cursor_pos.substring(0,cursor_pos.length-2);cursor_sec=Math.round((cursor_pos/timeline_width)*global_vid_duration);pp.seek(cursor_sec);timeline_progress_bar_update_flag=1;},drag:function(){var cursor_pos=$(this).css('left');cursor_pos=Math.round(cursor_pos.substring(0,cursor_pos.length-2));cursor_sec=Math.round((cursor_pos/timeline_width)*global_vid_duration);$(".timeline_progress_position_time").html(secondsTimeSpanToHMS(Math.round(cursor_sec)));$(".go_to_field").val(secondsTimeSpanToHMS(Math.round(cursor_sec)));}});}
function getRootWebSitePath()
{var _location=document.location.toString();var applicationNameIndex=_location.indexOf('/',_location.indexOf('://')+3);var applicationName=_location.substring(0,applicationNameIndex)+'/';var webFolderIndex=_location.indexOf('/',_location.indexOf(applicationName)+applicationName.length);var webFolderFullPath=_location.substring(0,webFolderIndex);return webFolderFullPath;}
$(document).ready(function(){webRoot=getRootWebSitePath();$(".send_json_button").css('background','url('+webRoot+'/resources/richLecture_addons/css/images_editor/saveButton-'+language.selectedLang+'.png) no-repeat');presentation_file=webRoot+"/services/presentation/";cuts_file=webRoot+"/services/cuts/";clips_list_file=webRoot+"/services/cliplist/";realediting_file=webRoot+"/services/realediting/do/";$.ionSound({sounds:["glass"],path:webRoot+"/resources/richLecture_addons/js/ext_js/sounds/",volume:"1.0"});timeline_width=$(".timeline").width();info=document.getElementById("info");define_actions();if(production_mode==1){vid_lecture_id=window.location.search.replace("?rid=","");if(vid_lecture_id.indexOf('&')!=-1)
window.location.href=window.location.search.replace(window.location.href.substring(window.location.href.indexOf('&')),"");presentation_file=presentation_file+vid_lecture_id;cuts_file=cuts_file+vid_lecture_id;clips_list_file=clips_list_file+vid_lecture_id;realediting_file=realediting_file+vid_lecture_id;}
read_parameters_XML();go_to_field_func();$(".go_to_field").focus(function(){go_to_time_refresh=0;});$(".go_to_field").focusout(function(){go_to_time_refresh=1;setTimeout(function(){return false;},100);});$(window).bind('beforeunload',function(){if($(".send_json_button").prop('disabled')==false)
return language.e27;});});