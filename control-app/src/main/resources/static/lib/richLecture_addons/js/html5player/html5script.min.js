let tt,ts,playermetadataloaded=0;const media_events=[];media_events.loadstart=0,media_events.progress=0,media_events.suspend=0,media_events.abort=0,media_events.error=0,media_events.emptied=0,media_events.stalled=0,media_events.loadedmetadata=0,media_events.loadeddata=0,media_events.canplay=0,media_events.canplaythrough=0,media_events.playing=0,media_events.waiting=0,media_events.seeking=0,media_events.seeked=0,media_events.ended=0,media_events.durationchange=0,media_events.timeupdate=0,media_events.play=0,media_events.pause=0,media_events.ratechange=0,media_events.resize=0,media_events.volumechange=0;const media_properties=["error","src","srcObject","currentSrc","crossOrigin","networkState","preload","buffered","readyState","seeking","currentTime","duration","paused","defaultPlaybackRate","playbackRate","played","seekable","ended","autoplay","loop","controls","volume","muted","defaultMuted","audioTracks","videoTracks","textTracks","width","height","videoWidth","videoHeight","poster"];let track,media_properties_elts=null,webm=null;function init_HTML5(){document._video=document.getElementById("player");const e=document.getElementById("mp4"),t=e.parentNode,o=document.getElementById("webm");playlist_array[video_playing_index].sources.length>1&&"-1"!==playlist_array[video_playing_index].sources[1].file?(o.setAttribute("src",playlist_array[video_playing_index].sources[1].file),debug&&console.log("Now playing WEBM:"+playlist_array[video_playing_index].sources[1].file)):o&&t.removeChild(o),"-1"!==playlist_array[video_playing_index].sources[0].file&&(e.setAttribute("src",playlist_array[video_playing_index].sources[0].file+"#t=0.5"),debug&&console.log("Now playing MP4:"+playlist_array[video_playing_index].sources[0].file)),init_events("events",media_events),getVideo().load()}function init_events(e,t){for(let e in t)document._video.addEventListener(e,capture,!1)}function capture(e){let t;if(media_events[e.type]++,"play"===e.type)debug&&console.log("player resumed"),$("#playPauseVideoBt").html('<span class="glyphicon glyphicon-pause" aria-hidden="true"></span>');else if("pause"===e.type)debug&&console.log("player paused"),$("#playPauseVideoBt").html('<span class="glyphicon glyphicon-play" aria-hidden="true"></span>');else if("seeked"===e.type){if(!introPlaying()){debug&&console.log("intro not playing. Seeked"),t=1e3*Math.round(getVideo().currentTime),t+=1;for(let e=0;e<cuepoints_c.length;e++)if(cuepoints_c[e]<=t){const o=1e3*cut_end_in_sec[cuepoints_c[e]],n=t-o;if(n<=0){debug&&console.log("on Seek of end-cut current time at "+t+" cut_period "+e+":"+cuepoints_c[e]+" - "+o),o/1e3<global_vid_duration?getVideo().currentTime=o/1e3:getVideo().play();break}debug&&console.log("no cuts:"+e+" "+cuepoints_c[e]+" "+o+" |curr: "+t+" dif: "+n)}}}else"loadedmetadata"===e.type?($("#dvLoading").hide(),$("#myOverlay").hide(),debug&&console.log("loadedmetadata"),onPlay(),introPlaying()||(debug&&console.log("intro not playing. Add cues"),cuepoints_m=getVideo().addTextTrack("metadata","CutsAndTrims","en"),cuepoints_m.mode="showing",cuepointsx_m=getVideo().addTextTrack("metadata","SlideSync","en"),cuepointsx_m.mode="showing",getVideo().textTracks.addEventListener("addtrack",function(){let e=getVideo().textTracks,t=e.length;for(let o=0;o<t;o++)if("Timed Cue Point"===e[o].label){tt=e[o];break}let o=0;(tt=getVideo().textTracks[o]).addEventListener("cuechange",function(){void 0!==tt.activeCues[0]?(debug&&console.log(" Seeked to:"+tt.activeCues[0].endTime),getVideo().currentTime=tt.activeCues[0].endTime):debug&&console.log("Cue point duration over")}),o=1,(ts=getVideo().textTracks[o]).addEventListener("cuechange",function(){if(void 0!==ts.activeCues[0]){if(debug&&console.log(" Slide Cue Point"+ts.activeCues[0].startTime),"sync_on"===mode){jsonData=JSON.parse(ts.activeCues[0].text);let e=jsonData.url,t=$("#active_slide img");if(t.attr("src")!==e){t.css("opacity",.3),t.attr("src",e).fadeTo("normal",1);let o=jsonData.pos;slide_to_be_loaded=$(".scroll-content-item").index($("#scroll-content-item-"+cuepointsx[o]/1e3)),set_active_img($("#scroll-content-item-"+cuepointsx[o]/1e3))}}}else{debug&&console.log("Slide Cue point duration over"),$(".scroll-content-item").removeClass("active");let e=$("#active_slide img");e.css("opacity",.3),e.attr("src",webRoot+"/resources/richLecture_addons/css/images_player/blank.gif").fadeTo("normal",1),$(".scroll-pane").animate({scrollTop:0}),$(".go_to_slide").val("00")}})})),getVideo().volume=.5,$(".show_current_vol").html(Math.round(10*getVideo().volume)+""),playermetadataloaded=1):"oncanplay"===e.type?debug&&console.log("player ready"):"ended"===e.type?(debug&&console.log("ended"),introPlaying()&&(debug&&console.log("load menu events"),load_menu_events(),debug&&console.log("define_actions"),define_actions(),debug&&console.log("go_to_time_func"),go_to_time_func(),debug&&console.log("go_to_slide_func"),go_to_slide_func(),video_playing_index=1,slides_loaded=0,playermetadataloaded=1,read_parameters_XML())):"volumechange"===e.type&&(debug&&console.log("volumechange"),getVideo().muted?$(".player_mute").html('<span class="glyphicon glyphicon-volume-off" aria-hidden="true"></span>'):$(".player_mute").html('<span class="glyphicon glyphicon-volume-up" aria-hidden="true"></span>'))}function resize(){document._video.width=document._video.videoWidth+10,document._video.height=document._video.videoHeight+10}function getVideo(){return document._video}function toggle_mute(){getVideo().muted?(debug&&(info.innerHTML="un-mute"),$(".player_mute").html('<span class="glyphicon glyphicon-volume-up" aria-hidden="true"></span>'),getVideo().muted=!1,$(".show_current_vol").html(Math.round(10*getVideo().volume))):(debug&&(info.innerHTML="mute"),$(".player_mute").html('<span class="glyphicon glyphicon-volume-off" aria-hidden="true"></span>'),getVideo().muted=!0,$(".show_current_vol").html(Math.round(10*getVideo().volume)))}function volume_down(){$(".vup").attr("disabled",!1),getVideo().volume>=.2?(getVideo().volume-=.1,$(".vdown").attr("disabled",!1)):(getVideo().volume=0,getVideo().muted=!0,$(".vdown").attr("disabled",!0)),$(".show_current_vol").html(Math.round(10*getVideo().volume)),debug&&(info.innerHTML="volume down:"+getVideo().volume)}function volume_up(){getVideo().muted=!1,$(".vdown").attr("disabled",!1),getVideo().volume<=.9?(getVideo().volume+=.1,$(".vup").attr("disabled",!1)):(getVideo().volume=1,$(".vup").attr("disabled",!0)),$(".show_current_vol").html(Math.round(10*getVideo().volume)),debug&&(info.innerHTML="volume up:"+getVideo().volume),$(".player_mute").html('<span class="glyphicon glyphicon-volume-up" aria-hidden="true"></span>')}function toggle_play(){!1===document._video.paused?(getVideo().pause(),$("#myOverlay").show(),$(".player_play").css("background","url("+webRoot+"/resources/richLecture_addons/css/images_editor/play-large.png) no-repeat"),debug&&(info.innerHTML="video paused")):(getVideo().play(),$("#myOverlay").hide(),$(".player_play").css("background","url("+webRoot+"/resources/richLecture_addons/css/images_editor/pause-large.png) no-repeat"),debug&&(info.innerHTML="video resumed"))}function stop_play(){getVideo().pause(),getVideo().currentTime=0,$("#playPauseVideoBt").html('<span class="glyphicon glyphicon-play" aria-hidden="true"></span>')}function rewind_play(){getVideo().currentTime>=5?getVideo().currentTime-=5:getVideo().currentTime=0}function forward_play(){getVideo().currentTime+=5,(getVideo().currentTime>=global_vid_duration||document._video.paused)&&(getVideo().pause(),getVideo().currentTime=0)}function full_screen(){toggleFullScreen()}function toggleFullScreen(){var e=document.querySelector("#player");document.mozFullScreen||document.webkitIsFullScreen?document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen()}